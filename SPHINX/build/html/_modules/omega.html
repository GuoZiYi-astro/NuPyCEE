<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>omega &mdash; SYGMA DOC v1.0 documentation</title>
    
    <link rel="stylesheet" href="../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     'v1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="SYGMA DOC v1.0 documentation" href="../index.html" />
    <link rel="up" title="Module code" href="index.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">SYGMA DOC v1.0 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for omega</h1><div class="highlight"><pre>
<span class="sd">&#39;&#39;&#39;</span>

<span class="sd">GCE OMEGA (One-zone Model for the Evolution of Galaxies) module</span>


<span class="sd">Functionality</span>
<span class="sd">=============</span>

<span class="sd">This tool allows to simulate the chemical evolution of single-zone galaxies.</span>
<span class="sd">Having the star formation history as one of the input parameters, OMEGA can</span>
<span class="sd">target local galaxies by using observational data found in the literature.</span>


<span class="sd">Made by</span>
<span class="sd">=======</span>

<span class="sd">FEB2015: C. Ritter, B. Cote</span>

<span class="sd">MAY2015: B. Cote</span>

<span class="sd">The code inherits the chem_evol class, which contains common functions shared by</span>
<span class="sd">SYGMA and OMEGA.  The code in chem_evol have been developped by :</span>

<span class="sd">v0.1 NOV2013: C. Fryer, C. Ritter</span>

<span class="sd">v0.2 JAN2014: C. Ritter</span>

<span class="sd">v0.3 APR2014: C. Ritter, J. F. Navarro, F. Herwig, C. Fryer, E. Starkenburg,</span>
<span class="sd">              M. Pignatari, S. Jones, K. Venn1, P. A. Denissenkov &amp; </span>
<span class="sd">              the NuGrid collaboration</span>

<span class="sd">v0.4 FEB2015: C. Ritter, B. Cote</span>

<span class="sd">v0.5 MAR2015: B. Cote</span>


<span class="sd">Usage</span>
<span class="sd">=====</span>

<span class="sd">Import the module:</span>

<span class="sd">&gt;&gt;&gt; import omega as o</span>

<span class="sd">Get help:</span>

<span class="sd">&gt;&gt;&gt; help o</span>

<span class="sd">Get more information:</span>

<span class="sd">&gt;&gt;&gt; o.omega?</span>

<span class="sd">Create an costum galaxy (closed box):</span>

<span class="sd">&gt;&gt;&gt; o1 = o.omega(cte_sfr=1.0, mgal=1.5e10)</span>

<span class="sd">Simulate a known galaxy (open box):</span>

<span class="sd">&gt;&gt;&gt; o2 = o.omega(galaxy=&#39;sculptor&#39;, in_out_control=True, mgal=1e6, mass_loading=8, in_out_ratio=1.5)</span>

<span class="sd">Analysis functions: See the Sphinx documentation</span>

<span class="sd">&#39;&#39;&#39;</span>

<span class="c">#standard packages</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">random</span>

<span class="c"># Import the class inherited by SYGMA</span>
<span class="kn">from</span> <span class="nn">chem_evol</span> <span class="kn">import</span> <span class="o">*</span>


<div class="viewcode-block" id="omega"><a class="viewcode-back" href="../omega.html#omega.omega">[docs]</a><span class="k">class</span> <span class="nc">omega</span><span class="p">(</span> <span class="n">chem_evol</span> <span class="p">):</span>

    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Input parameters (OMEGA)</span>
<span class="sd">    ================</span>

<span class="sd">    Important : By default, a closed box model is always assumed.</span>

<span class="sd">    galaxy : string</span>

<span class="sd">        Name of the target galaxy.  By using a known galaxy, the code</span>
<span class="sd">        automatically selects the corresponding star formation history, stellar</span>
<span class="sd">        mass, and total mass (when available).  By using &#39;none&#39;, the user has</span>
<span class="sd">        the perfect control on these three last parameters.</span>

<span class="sd">        Choices : &#39;milky_way&#39;, &#39;milky_way_cte&#39;, &#39;sculptor&#39;, &#39;carina&#39;, &#39;fornax&#39;,</span>
<span class="sd">        &#39;none&#39;</span>

<span class="sd">        Default value : &#39;none&#39; </span>

<span class="sd">        Special note : The &#39;milky_way_cte&#39; option uses the Milky Way&#39;s</span>
<span class="sd">        characteristics, but with a constant star formation history.</span>

<span class="sd">    cte_sfr : float</span>

<span class="sd">        Constant star formation history in [Mo/yr].</span>

<span class="sd">        Default value : 1.0</span>

<span class="sd">    rand_sfh : float</span>

<span class="sd">        Maximum possible ratio between the maximum and the minium values of a star</span>
<span class="sd">        formation history that is randomly generated.</span>

<span class="sd">        Default value : 0.0 (deactivated)</span>

<span class="sd">        Special note : A value greater than zero automatically generates a random</span>
<span class="sd">        star formation history, which pypasses the use of the cte_sfr parameter.</span>

<span class="sd">    sfh_file : string</span>

<span class="sd">        Path to a file containing an input star formation history.  The first and</span>
<span class="sd">        second columns must be the age of the galaxy in [yr] and the star</span>
<span class="sd">        formation rate in [Mo/yr].</span>

<span class="sd">        Default value : &#39;none&#39; (deactivated)</span>

<span class="sd">        Special note : When a path is specified, it by passes the cte_sfr and the</span>
<span class="sd">        and_sfh parameters.</span>

<span class="sd">    stellar_mass_0 : float</span>

<span class="sd">        Current stellar mass of the galaxy, in [Mo], at the end of the simulation.</span>
<span class="sd">        </span>
<span class="sd">        Default value : -1.0 (you need to specify a value with unkown galaxies)</span>

<span class="sd">    in_out_control : boolean</span>

<span class="sd">        The in_out_control implementation enables to control the outflow and</span>
<span class="sd">        the inflow rates independently by using constant values (see outflow_rate</span>
<span class="sd">        and inflow_rate) or by using a mass-loading factor that connects the</span>
<span class="sd">        rates to the star formation history (see mass_loading and in_out_ratio).</span>

<span class="sd">        Default value : False (deactivated)</span>

<span class="sd">    mass_loading : float</span>

<span class="sd">        Ratio between the outflow rate and the star formation rate.</span>

<span class="sd">        Default value : 1.0</span>

<span class="sd">    outflow_rate : float</span>

<span class="sd">        Constant outflow rate in [Mo/yr].</span>

<span class="sd">        Default value : -1.0 (deactivated)</span>

<span class="sd">        Special note : A value greater or equal to zero activates the constant</span>
<span class="sd">        utflow mode, which bypasses the use of the mass_loading parameter.</span>

<span class="sd">    in_out_ratio : float</span>

<span class="sd">        Used in : in_out_control mode</span>

<span class="sd">        Ratio between the inflow rate and the outflow rate.  This parameter is</span>
<span class="sd">        used to calculate the inflow rate, not the outflow rate.</span>

<span class="sd">        Default value : 1.0</span>

<span class="sd">    inflow_rate : float</span>

<span class="sd">        Used in : in_out_control mode</span>

<span class="sd">        Constant inflow rate in [Mo/yr].</span>

<span class="sd">        Default value : -1.0 (deactivated)</span>

<span class="sd">        Special note : A value greater or equal to zero activates the constant</span>
<span class="sd">        inflow mode, which bypasses the use of the in_out_ratio parameter.</span>

<span class="sd">    SF_law : boolean</span>

<span class="sd">        The SF_law inplementation assumes a Kennicutt-Schmidt star formation law</span>
<span class="sd">        and combines it to the known input star formation history in order to</span>
<span class="sd">        derive the mass of the gas reservoir at every timestep.</span>

<span class="sd">        Default value : False (deactivated)</span>

<span class="sd">    sfe : float</span>

<span class="sd">        Used in : SF_law and DM_evolution modes</span>

<span class="sd">        Star formation efficiency present in the Kennicutt-Schmidt law.</span>

<span class="sd">        Default value : 0.1</span>

<span class="sd">    f_dyn : float</span>

<span class="sd">        Used in : SF_law and DM_evolution modes</span>

<span class="sd">        Scaling factor used to calculate the star formation timescale present in</span>
<span class="sd">        the Kennicutt-Schmidt law.  We assume that this timescale is equal to a</span>
<span class="sd">        fraction of the dynamical timescale of the virialized system (dark and</span>
<span class="sd">        baryonic matter), t_star = f_dyn * t_dyn.</span>

<span class="sd">        Default value : 0.1</span>

<span class="sd">    m_DM_0 : float</span>

<span class="sd">        Used in : SF_law and DM_evolution modes</span>

<span class="sd">        Current dark matter halo mass of the galaxy, in [Mo], at the end of the</span>
<span class="sd">        simulations.</span>

<span class="sd">        Default value : 1.0e+11 </span>

<span class="sd">    t_star : float</span>

<span class="sd">        Used in : SF_law and DM_evolution modes</span>

<span class="sd">        Star formation timescale, in [yr], used in the Kennicutt-Schmidt law.</span>

<span class="sd">        Default value = -1.0 (deactivated)</span>

<span class="sd">        Special note : A positive value activates the use of this parameter, </span>
<span class="sd">        which bypasses the f_dyn parameter.</span>

<span class="sd">    DM_evolution : boolean</span>

<span class="sd">        The DM_evolution implementation is an extention of the SF_law option.</span>
<span class="sd">        In addition of using a Kennicutt-Schmidt star formation law, it assumes</span>
<span class="sd">        an evolution in the total mass of the galaxy as function of time.  With</span>
<span class="sd">        this prescription, the mass-loading factor has a mass dependency.  The</span>
<span class="sd">        mass_loading parameter then only represents the final value at the end</span>
<span class="sd">        of the simulation. </span>

<span class="sd">        Default value : False (deactivated)</span>

<span class="sd">    exp_ml : float</span>

<span class="sd">        Used in : DM_evolution mode</span>

<span class="sd">        Exponent of the mass dependency of the mass-loading factor.  This last</span>
<span class="sd">        factor is proportional to M_vir**(-exp_ml/3), where M_vir is the sum of</span>
<span class="sd">        dark and baryonic matter.</span>

<span class="sd">        Default value : 2.0    </span>

<span class="sd">    ================</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="c">#Combine docstrings from chem_evol with sygma docstring</span>
    <span class="n">__doc__</span> <span class="o">=</span> <span class="n">__doc__</span><span class="o">+</span><span class="n">chem_evol</span><span class="o">.</span><span class="n">__doc__</span>


    <span class="c">##############################################</span>
    <span class="c">##               Constructor                ##</span>
    <span class="c">##############################################</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">galaxy</span><span class="o">=</span><span class="s">&#39;none&#39;</span><span class="p">,</span> <span class="n">in_out_control</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">SF_law</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> \
                 <span class="n">DM_evolution</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">Z_trans</span><span class="o">=</span><span class="mf">1e-20</span><span class="p">,</span> <span class="n">f_dyn</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">sfe</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> \
                 <span class="n">outflow_rate</span><span class="o">=-</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">inflow_rate</span><span class="o">=-</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">rand_sfh</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">cte_sfr</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> \
                 <span class="n">m_DM_0</span><span class="o">=</span><span class="mf">1.0e11</span><span class="p">,</span> <span class="n">mass_loading</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">t_star</span><span class="o">=-</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">sfh_file</span><span class="o">=</span><span class="s">&#39;none&#39;</span><span class="p">,</span> \
                 <span class="n">in_out_ratio</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">stellar_mass_0</span><span class="o">=-</span><span class="mf">1.0</span><span class="p">,</span> \
                 <span class="n">z_dependent</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">exp_ml</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> \
                 <span class="n">imf_type</span><span class="o">=</span><span class="s">&#39;kroupa&#39;</span><span class="p">,</span> <span class="n">alphaimf</span><span class="o">=</span><span class="mf">2.35</span><span class="p">,</span> <span class="n">imf_bdys</span><span class="o">=</span><span class="p">[</span><span class="mf">0.1</span><span class="p">,</span><span class="mi">100</span><span class="p">],</span> \
                 <span class="n">sn1a_rate</span><span class="o">=</span><span class="s">&#39;power_law&#39;</span><span class="p">,</span> <span class="n">iniZ</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="mf">1e6</span><span class="p">,</span> <span class="n">special_timesteps</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> \
                 <span class="n">tend</span><span class="o">=</span><span class="mf">13e9</span><span class="p">,</span> <span class="n">mgal</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">transitionmass</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">iolevel</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> \
                 <span class="n">ini_alpha</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> \
                 <span class="n">table</span><span class="o">=</span><span class="s">&#39;yield_tables/isotope_yield_table_MESA_only.txt&#39;</span><span class="p">,</span> \
                 <span class="n">hardsetZ</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">sn1a_on</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>\
                 <span class="n">sn1a_table</span><span class="o">=</span><span class="s">&#39;yield_tables/sn1a_t86.txt&#39;</span><span class="p">,</span>\
                 <span class="n">iniabu_table</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> \
                 <span class="n">extra_source_on</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> \
                 <span class="n">extra_source_table</span><span class="o">=</span><span class="s">&#39;yield_tables/mhdjet_NTT_delayed.txt&#39;</span><span class="p">,</span> \
                 <span class="n">pop3_table</span><span class="o">=</span><span class="s">&#39;yield_tables/popIII_heger10.txt&#39;</span><span class="p">,</span> \
                 <span class="n">imf_bdys_pop3</span><span class="o">=</span><span class="p">[</span><span class="mf">0.1</span><span class="p">,</span><span class="mi">100</span><span class="p">],</span> <span class="n">imf_yields_range_pop3</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">30</span><span class="p">],</span> \
                 <span class="n">starbursts</span><span class="o">=</span><span class="p">[],</span> <span class="n">beta_pow</span><span class="o">=-</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">gauss_dtd</span><span class="o">=</span><span class="p">[</span><span class="mf">1e9</span><span class="p">,</span><span class="mf">6.6e8</span><span class="p">],</span><span class="n">exp_dtd</span><span class="o">=</span><span class="mf">2e9</span><span class="p">,</span>\
                 <span class="n">nb_1a_per_m</span><span class="o">=</span><span class="mf">1.0e-3</span><span class="p">,</span> <span class="n">f_arfo</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> \
                 <span class="n">imf_yields_range</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">30</span><span class="p">],</span><span class="n">exclude_masses</span><span class="o">=</span><span class="p">[</span><span class="mi">32</span><span class="p">,</span><span class="mi">60</span><span class="p">],</span> \
		 <span class="n">netyields_on</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">wiersmamod</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">skip_zero</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>\
                 <span class="n">redshift_f</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span><span class="n">print_off</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">long_range_ref</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>

        <span class="c"># Announce the beginning of the simulation </span>
        <span class="k">print</span> <span class="s">&#39;OMEGA run in progress..&#39;</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">t_module</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">start_time</span> <span class="o">=</span> <span class="n">start_time</span>

        <span class="c"># Call the init function of the class inherited by SYGMA</span>
        <span class="n">chem_evol</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">imf_type</span><span class="o">=</span><span class="n">imf_type</span><span class="p">,</span> <span class="n">alphaimf</span><span class="o">=</span><span class="n">alphaimf</span><span class="p">,</span> \
                 <span class="n">imf_bdys</span><span class="o">=</span><span class="n">imf_bdys</span><span class="p">,</span> <span class="n">sn1a_rate</span><span class="o">=</span><span class="n">sn1a_rate</span><span class="p">,</span> <span class="n">iniZ</span><span class="o">=</span><span class="n">iniZ</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span> \
                 <span class="n">special_timesteps</span><span class="o">=</span><span class="n">special_timesteps</span><span class="p">,</span> <span class="n">tend</span><span class="o">=</span><span class="n">tend</span><span class="p">,</span> <span class="n">mgal</span><span class="o">=</span><span class="n">mgal</span><span class="p">,</span> \
                 <span class="n">transitionmass</span><span class="o">=</span><span class="n">transitionmass</span><span class="p">,</span> <span class="n">iolevel</span><span class="o">=</span><span class="n">iolevel</span><span class="p">,</span> \
                 <span class="n">ini_alpha</span><span class="o">=</span><span class="n">ini_alpha</span><span class="p">,</span> <span class="n">table</span><span class="o">=</span><span class="n">table</span><span class="p">,</span> <span class="n">hardsetZ</span><span class="o">=</span><span class="n">hardsetZ</span><span class="p">,</span> \
                 <span class="n">sn1a_on</span><span class="o">=</span><span class="n">sn1a_on</span><span class="p">,</span> <span class="n">sn1a_table</span><span class="o">=</span><span class="n">sn1a_table</span><span class="p">,</span> \
                 <span class="n">iniabu_table</span><span class="o">=</span><span class="n">iniabu_table</span><span class="p">,</span> <span class="n">extra_source_on</span><span class="o">=</span><span class="n">extra_source_on</span><span class="p">,</span> \
                 <span class="n">extra_source_table</span><span class="o">=</span><span class="n">extra_source_table</span><span class="p">,</span> <span class="n">pop3_table</span><span class="o">=</span><span class="n">pop3_table</span><span class="p">,</span> \
                 <span class="n">imf_bdys_pop3</span><span class="o">=</span><span class="n">imf_bdys_pop3</span><span class="p">,</span> \
                 <span class="n">imf_yields_range_pop3</span><span class="o">=</span><span class="n">imf_yields_range_pop3</span><span class="p">,</span> \
                 <span class="n">starbursts</span><span class="o">=</span><span class="n">starbursts</span><span class="p">,</span> <span class="n">beta_pow</span><span class="o">=</span><span class="n">beta_pow</span><span class="p">,</span> \
                 <span class="n">gauss_dtd</span> <span class="o">=</span> <span class="n">gauss_dtd</span><span class="p">,</span> <span class="n">exp_dtd</span> <span class="o">=</span> <span class="n">exp_dtd</span><span class="p">,</span> \
                 <span class="n">nb_1a_per_m</span><span class="o">=</span><span class="n">nb_1a_per_m</span><span class="p">,</span> <span class="n">Z_trans</span><span class="o">=</span><span class="n">Z_trans</span><span class="p">,</span> <span class="n">f_arfo</span><span class="o">=</span><span class="n">f_arfo</span><span class="p">,</span> \
                 <span class="n">imf_yields_range</span><span class="o">=</span><span class="n">imf_yields_range</span><span class="p">,</span><span class="n">exclude_masses</span><span class="o">=</span><span class="n">exclude_masses</span><span class="p">,</span>\
                 <span class="n">netyields_on</span><span class="o">=</span><span class="n">netyields_on</span><span class="p">,</span><span class="n">wiersmamod</span><span class="o">=</span><span class="n">wiersmamod</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">need_to_quit</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c"># Attribute the input parameters to the current OMEGA object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">galaxy</span> <span class="o">=</span> <span class="n">galaxy</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">in_out_control</span> <span class="o">=</span> <span class="n">in_out_control</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SF_law</span> <span class="o">=</span> <span class="n">SF_law</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DM_evolution</span> <span class="o">=</span> <span class="n">DM_evolution</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f_dyn</span> <span class="o">=</span> <span class="n">f_dyn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sfe</span> <span class="o">=</span> <span class="n">sfe</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">outflow_rate</span> <span class="o">=</span> <span class="n">outflow_rate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inflow_rate</span> <span class="o">=</span> <span class="n">inflow_rate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rand_sfh</span> <span class="o">=</span> <span class="n">rand_sfh</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cte_sfr</span> <span class="o">=</span> <span class="n">cte_sfr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">m_DM_0</span> <span class="o">=</span> <span class="n">m_DM_0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mass_loading</span> <span class="o">=</span> <span class="n">mass_loading</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t_star</span> <span class="o">=</span> <span class="n">t_star</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sfh_file</span> <span class="o">=</span> <span class="n">sfh_file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">in_out_ratio</span> <span class="o">=</span> <span class="n">in_out_ratio</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stellar_mass_0</span> <span class="o">=</span> <span class="n">stellar_mass_0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">z_dependent</span> <span class="o">=</span> <span class="n">z_dependent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exp_ml</span> <span class="o">=</span> <span class="n">exp_ml</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DM_too_low</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">skip_zero</span> <span class="o">=</span> <span class="n">skip_zero</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">redshift_f</span> <span class="o">=</span> <span class="n">redshift_f</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">print_off</span> <span class="o">=</span> <span class="n">print_off</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">long_range_ref</span> <span class="o">=</span> <span class="n">long_range_ref</span>

        <span class="c"># Set cosmological parameters - Dunkley et al. (2009)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">omega_0</span>   <span class="o">=</span> <span class="mf">0.257</span>   <span class="c"># Current mass density parameter</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">omega_b_0</span> <span class="o">=</span> <span class="mf">0.044</span>   <span class="c"># Current baryonic mass density parameter</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lambda_0</span>  <span class="o">=</span> <span class="mf">0.742</span>   <span class="c"># Current dark energy density parameter</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H_0</span>       <span class="o">=</span> <span class="mf">71.9</span>    <span class="c"># Hubble constant [km s^-1 Mpc^-1]</span>

        <span class="c"># Look for error in the input parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__check_inputs_omega</span><span class="p">()</span>

        <span class="c"># Define wether the open box scenario is used or not</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_out_control</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">SF_law</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">DM_evolution</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">open_box</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">open_box</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="c"># Check if the timesteps need to be rafined</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">SF_law</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">DM_evolution</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">t_SF_t</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">redshift_t</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nb_timesteps</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">t_SF_t</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">redshift_t</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">t_SF_t</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">redshift_t</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__calculate_redshift_t</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__calculate_t_SF_t</span><span class="p">()</span>
            <span class="n">need_t_raf</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">for</span> <span class="n">i_raf</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nb_timesteps</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">timesteps</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_SF_t</span><span class="p">[</span><span class="n">i_raf</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">sfe</span><span class="p">:</span>
                    <span class="n">need_t_raf</span> <span class="o">=</span> <span class="bp">True</span>
                    <span class="k">break</span>
            <span class="k">if</span> <span class="n">need_t_raf</span><span class="p">:</span>
              <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">long_range_ref</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__rafine_steps_lr</span><span class="p">()</span>
              <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__rafine_steps</span><span class="p">()</span>

        <span class="c"># Declare arrays used to follow the evolution of the galaxy</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__declare_evol_arrays</span><span class="p">()</span>

        <span class="c"># Set the general properties of the selected galaxy</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__initialize_gal_prop</span><span class="p">()</span>

        <span class="c"># Fill arrays used to follow the evolution</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__fill_evol_arrays</span><span class="p">()</span>

        <span class="c"># Read the primordial composition of the inflow gas</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_out_control</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">SF_law</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">DM_evolution</span><span class="p">:</span>
            <span class="n">prim_comp_table</span> <span class="o">=</span> <span class="s">&#39;yield_tables/bb_walker91.txt&#39;</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">prim_comp</span> <span class="o">=</span> <span class="n">ry</span><span class="o">.</span><span class="n">read_yield_sn1a_tables</span><span class="p">(</span><span class="n">global_path</span> <span class="o">+</span> \
                <span class="n">prim_comp_table</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">isotopes</span><span class="p">)</span>

        <span class="c"># Assume the baryonic ratio for the initial gas reservoir, if needed</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bar_ratio</span><span class="p">:</span>
            <span class="n">scale_m_tot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_DM_0</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">omega_b_0</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">omega_0</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">mgal</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">k_cm</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ymgal</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ymgal</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">k_cm</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ymgal</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">k_cm</span><span class="p">]</span> <span class="o">*</span> <span class="n">scale_m_tot</span>

        <span class="c"># Run the simulation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__run_simulation</span><span class="p">()</span>

        <span class="c"># Do the final update of the history class</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_history_final</span><span class="p">()</span>

        <span class="c"># Add the evolution arrays to the history class</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">m_DM_t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_DM_t</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">m_tot_ISM_t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_tot_ISM_t</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">m_outflow_t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_outflow_t</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">m_inflow_t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_inflow_t</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">eta_outflow_t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eta_outflow_t</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">t_SF_t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_SF_t</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">redshift_t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">redshift_t</span>

        <span class="c"># Announce the end of the simulation</span>
        <span class="k">print</span> <span class="s">&#39;   OMEGA run completed -&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_gettime</span><span class="p">()</span>


    <span class="c">##############################################</span>
    <span class="c">#             Check Inputs OMEGA             #</span>
    <span class="c">##############################################</span>
    <span class="k">def</span> <span class="nf">__check_inputs_omega</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        This function checks for incompatible input entries, and stops</span>
<span class="sd">        the simulation if needed.</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c"># Input galaxy</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">galaxy</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;none&#39;</span><span class="p">,</span> <span class="s">&#39;milky_way&#39;</span><span class="p">,</span> <span class="s">&#39;milky_way_cte&#39;</span><span class="p">,</span> \
                               <span class="s">&#39;sculptor&#39;</span><span class="p">,</span> <span class="s">&#39;fornax&#39;</span><span class="p">,</span> <span class="s">&#39;carina&#39;</span><span class="p">]:</span>
            <span class="k">print</span> <span class="s">&#39;Error - Selected galaxy not available.&#39;</span>
            <span class="k">return</span>

        <span class="c"># Random SFH</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rand_sfh</span> <span class="o">&gt;</span> <span class="mf">0.0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">stellar_mass_0</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&#39;Error - You need to choose a current stellar mass.&#39;</span>
            <span class="k">return</span>

        <span class="c"># Inflow control when non-available</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_out_control</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SF_law</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">DM_evolution</span><span class="p">):</span>
            <span class="k">print</span> <span class="s">&#39;Error - Cannot control inflows and outflows when SF_law or&#39;</span>\
                  <span class="s">&#39;DM_evolution is equal to True.&#39;</span>
            <span class="k">return</span>

        <span class="c"># Defined initial dark matter halo mass when non-available</span>
        <span class="c">#if self.m_DM_ini &gt; 0.0 and not self.DM_evolution:</span>
        <span class="c">#    print &#39;Warning - Can\&#39;t control m_DM_ini when the mass of&#39;, \</span>
        <span class="c">#          &#39;the dark matter halo is not evolving.&#39;</span>

        <span class="c"># Inflow and outflow control when the dark matter mass if evolving</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outflow_rate</span> <span class="o">&gt;=</span> <span class="mf">0.0</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">inflow_rate</span> <span class="o">&gt;=</span> <span class="mf">0.0</span><span class="p">)</span> <span class="ow">and</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">DM_evolution</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&#39;Error - Cannot fix inflow and outflow rates when the mass&#39;</span>\
                  <span class="s">&#39;of the dark matter halo is evolving.&#39;</span>
            <span class="k">return</span>


    <span class="c">##############################################</span>
    <span class="c">#                Rafine Steps                #</span>
    <span class="c">##############################################</span>
    <span class="k">def</span> <span class="nf">__rafine_steps</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        This function increases the number of timesteps if the star formation</span>
<span class="sd">        will eventually consume all the gas, which occur when dt &gt; (t_star/sfe).</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c"># Declaration of the new timestep array</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">print_off</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&#39;..Time rafinement..&#39;</span>
        <span class="n">new_dt</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c"># For every timestep ...</span>
        <span class="k">for</span> <span class="n">i_rs</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">timesteps</span><span class="p">)):</span>

            <span class="c"># Calculate the critital time delay</span>
            <span class="n">t_raf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_SF_t</span><span class="p">[</span><span class="n">i_rs</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">sfe</span>

            <span class="c"># If the step needs to be rafined ...</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">timesteps</span><span class="p">[</span><span class="n">i_rs</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">t_raf</span><span class="p">:</span>

                <span class="c"># Calculate the split factor</span>
                <span class="n">nb_split</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">timesteps</span><span class="p">[</span><span class="n">i_rs</span><span class="p">]</span> <span class="o">/</span> <span class="n">t_raf</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

                <span class="c"># Split the step</span>
                <span class="k">for</span> <span class="n">i_sp_st</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nb_split</span><span class="p">):</span>
                    <span class="n">new_dt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">timesteps</span><span class="p">[</span><span class="n">i_rs</span><span class="p">]</span><span class="o">/</span><span class="n">nb_split</span><span class="p">)</span>

            <span class="c"># If ok, don&#39;t change anything</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">new_dt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">timesteps</span><span class="p">[</span><span class="n">i_rs</span><span class="p">])</span>

        <span class="c"># Update the timestep information</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nb_timesteps</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_dt</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">timesteps</span> <span class="o">=</span> <span class="n">new_dt</span>

        <span class="c"># Update/redeclare all the arrays</span>
        <span class="n">ymgal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_iniabu</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">len_ymgal</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ymgal</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mdot</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ymgal</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ymgal_massive</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ymgal_agb</span><span class="p">,</span> \
        <span class="bp">self</span><span class="o">.</span><span class="n">ymgal_1a</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mdot_massive</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mdot_agb</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mdot_1a</span><span class="p">,</span> \
        <span class="bp">self</span><span class="o">.</span><span class="n">sn1a_numbers</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sn2_numbers</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">imf_mass_ranges</span><span class="p">,</span> \
        <span class="bp">self</span><span class="o">.</span><span class="n">imf_mass_ranges_contribution</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">imf_mass_ranges_mtot</span> <span class="o">=</span> \
        <span class="bp">self</span><span class="o">.</span><span class="n">_get_storing_arrays</span><span class="p">(</span><span class="n">ymgal</span><span class="p">)</span>


    <span class="c">##############################################</span>
    <span class="c">#              Rafine Steps LR               #</span>
    <span class="c">##############################################</span>
    <span class="k">def</span> <span class="nf">__rafine_steps_lr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        This function increases the number of timesteps if the star formation</span>
<span class="sd">        will eventually consume all the gas, which occur when dt &gt; (t_star/sfe).</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c"># Declaration of the new timestep array</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">print_off</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&#39;..Time rafinement (long range)..&#39;</span>
        <span class="n">new_dt</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c"># For every timestep ...</span>
        <span class="k">for</span> <span class="n">i_rs</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">timesteps</span><span class="p">)):</span>

            <span class="c"># Calculate the critital time delay</span>
            <span class="n">t_raf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_SF_t</span><span class="p">[</span><span class="n">i_rs</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">sfe</span>

            <span class="c"># If the step needs to be rafined ...</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">timesteps</span><span class="p">[</span><span class="n">i_rs</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">t_raf</span><span class="p">:</span>

                <span class="c"># Calculate the number of remaining steps</span>
                <span class="n">nb_step_rem</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">timesteps</span><span class="p">)</span> <span class="o">-</span> <span class="n">i_rs</span>
                <span class="n">t_rem</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="k">for</span> <span class="n">i_rs</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">timesteps</span><span class="p">)):</span>
                    <span class="n">t_rem</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">timesteps</span><span class="p">[</span><span class="n">i_rs</span><span class="p">]</span>

                <span class="c"># Calculate the split factor</span>
                <span class="n">nb_split</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">t_rem</span> <span class="o">/</span> <span class="n">t_raf</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

                <span class="c"># Split the step</span>
                <span class="k">for</span> <span class="n">i_sp_st</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nb_split</span><span class="p">):</span>
                    <span class="n">new_dt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t_rem</span><span class="o">/</span><span class="n">nb_split</span><span class="p">)</span>

                <span class="c"># Quit the for loop</span>
                <span class="k">break</span>

            <span class="c"># If ok, don&#39;t change anything</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">new_dt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">timesteps</span><span class="p">[</span><span class="n">i_rs</span><span class="p">])</span>

        <span class="c"># Update the timestep information</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nb_timesteps</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_dt</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">timesteps</span> <span class="o">=</span> <span class="n">new_dt</span>

        <span class="c"># Update/redeclare all the arrays</span>
        <span class="n">ymgal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_iniabu</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">len_ymgal</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ymgal</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mdot</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ymgal</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ymgal_massive</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ymgal_agb</span><span class="p">,</span> \
        <span class="bp">self</span><span class="o">.</span><span class="n">ymgal_1a</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mdot_massive</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mdot_agb</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mdot_1a</span><span class="p">,</span> \
        <span class="bp">self</span><span class="o">.</span><span class="n">sn1a_numbers</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sn2_numbers</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">imf_mass_ranges</span><span class="p">,</span> \
        <span class="bp">self</span><span class="o">.</span><span class="n">imf_mass_ranges_contribution</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">imf_mass_ranges_mtot</span> <span class="o">=</span> \
        <span class="bp">self</span><span class="o">.</span><span class="n">_get_storing_arrays</span><span class="p">(</span><span class="n">ymgal</span><span class="p">)</span>


    <span class="c">##############################################</span>
    <span class="c">#            Declare Evol Arrays             #</span>
    <span class="c">##############################################</span>
    <span class="k">def</span> <span class="nf">__declare_evol_arrays</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        This function declares the arrays used to follow the evolution of the</span>
<span class="sd">        galaxy regarding its growth and the exchange of gas with its surrounding.</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c"># Arrays with specific values at every timestep</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sfr_input</span> <span class="o">=</span> <span class="p">[]</span>     <span class="c"># Star formation rate [Mo yr^-1]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">m_DM_t</span> <span class="o">=</span> <span class="p">[]</span>        <span class="c"># Mass of the dark matter halo</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">m_tot_ISM_t</span> <span class="o">=</span> <span class="p">[]</span>   <span class="c"># Mass of the ISM in gas at every timestep</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">m_outflow_t</span> <span class="o">=</span> <span class="p">[]</span>   <span class="c"># Mass of the outflow at every timestep</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eta_outflow_t</span> <span class="o">=</span> <span class="p">[]</span> <span class="c"># Mass-loading factor == M_outflow / SFR</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t_SF_t</span> <span class="o">=</span> <span class="p">[]</span>        <span class="c"># Star formation timescale at every timestep</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">redshift_t</span> <span class="o">=</span> <span class="p">[]</span>    <span class="c"># Redshift associated to every timestep</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">m_inflow_t</span> <span class="o">=</span> <span class="p">[]</span>    <span class="c"># Mass of the inflow at every timestep</span>

        <span class="c"># Extends the arrays to cover all timestep</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nb_timesteps</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sfr_input</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">m_DM_t</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">m_tot_ISM_t</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">m_outflow_t</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">eta_outflow_t</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">t_SF_t</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">redshift_t</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">m_inflow_t</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>

        <span class="c"># Add one additional slot for t = tend when needed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sfr_input</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">m_DM_t</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">m_tot_ISM_t</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t_SF_t</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">redshift_t</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>


    <span class="c">##############################################</span>
    <span class="c">#            Initialize Gal Prop             #</span>
    <span class="c">##############################################</span>
    <span class="k">def</span> <span class="nf">__initialize_gal_prop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        This function sets the properties of the selected galaxy, such as its</span>
<span class="sd">        SFH, its total mass, and its stellar mass.</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c"># No specific galaxy - Use input parameters</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">galaxy</span> <span class="o">==</span> <span class="s">&#39;none&#39;</span><span class="p">:</span>
            
            <span class="c"># If an input file is used for the SFH ...</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">sfh_file</span> <span class="o">==</span> <span class="s">&#39;none&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__copy_sfr_input</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sfh_file</span><span class="p">)</span>

            <span class="c"># If a random SFH is chosen ...</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">rand_sfh</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__generate_rand_sfh</span><span class="p">()</span>

            <span class="c"># If the SFH is constant ...</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i_cte_sfr</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nb_timesteps</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">sfr_input</span><span class="p">[</span><span class="n">i_cte_sfr</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cte_sfr</span>

        <span class="c"># Milky Way galaxy ...</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">galaxy</span> <span class="o">==</span> <span class="s">&#39;milky_way&#39;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">galaxy</span> <span class="o">==</span> <span class="s">&#39;milky_way_cte&#39;</span><span class="p">:</span>

            <span class="c"># Set the current dark and stellar masses (corrected for mass loss)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">m_DM_0</span> <span class="o">=</span> <span class="mf">1.0e12</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stellar_mass_0</span> <span class="o">=</span> <span class="mf">5.0e10</span> 

            <span class="c"># Read Chiappini et al. (2001) SFH</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">galaxy</span> <span class="o">==</span> <span class="s">&#39;milky_way&#39;</span><span class="p">:</span> 
                <span class="bp">self</span><span class="o">.</span><span class="n">__copy_sfr_input</span><span class="p">(</span><span class="s">&#39;milky_way_data/sfh_mw_cmr01.txt&#39;</span><span class="p">)</span>

            <span class="c"># Read constant SFH</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__copy_sfr_input</span><span class="p">(</span><span class="s">&#39;milky_way_data/sfh_cte.txt&#39;</span><span class="p">)</span>

        <span class="c"># Sculptor dwarf galaxy ...</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">galaxy</span> <span class="o">==</span> <span class="s">&#39;sculptor&#39;</span><span class="p">:</span>

            <span class="c"># Set the current dark and stellar masses (corrected for mass loss)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">m_DM_0</span> <span class="o">=</span> <span class="mf">1.5e9</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stellar_mass_0</span> <span class="o">=</span> <span class="mf">7.8e6</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stellar_mass_0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stellar_mass_0</span> <span class="o">*</span> <span class="mf">0.5</span>

            <span class="c">#Read deBoer et al. (2012) SFH</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__copy_sfr_input</span><span class="p">(</span><span class="s">&#39;sculptor_data/sfh_deBoer12.txt&#39;</span><span class="p">)</span>

        <span class="c"># Fornax dwarf galaxy ...</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">galaxy</span> <span class="o">==</span> <span class="s">&#39;fornax&#39;</span><span class="p">:</span>

            <span class="c"># Set the current dark and stellar masses (corrected for mass loss)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">m_DM_0</span> <span class="o">=</span> <span class="mf">7.08e8</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stellar_mass_0</span> <span class="o">=</span> <span class="mf">4.3e7</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stellar_mass_0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stellar_mass_0</span> <span class="o">*</span> <span class="mf">0.5</span>

            <span class="c">#Read deBoer et al. (2012) SFH</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__copy_sfr_input</span><span class="p">(</span><span class="s">&#39;fornax_data/sfh_fornax_deboer_et_al_2012.txt&#39;</span><span class="p">)</span>

        <span class="c"># Carina dwarf galaxy ...</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">galaxy</span> <span class="o">==</span> <span class="s">&#39;carina&#39;</span><span class="p">:</span>

            <span class="c"># Set the current dark and stellar masses (corrected for mass loss)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">m_DM_0</span> <span class="o">=</span> <span class="mf">3.4e6</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stellar_mass_0</span> <span class="o">=</span> <span class="mf">1.07e6</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stellar_mass_0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stellar_mass_0</span> <span class="o">*</span> <span class="mf">0.5</span>

            <span class="c">#Read deBoer et al. (2014) SFH</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__copy_sfr_input</span><span class="p">(</span><span class="s">&#39;carina_data/sfh_deBoer14.txt&#39;</span><span class="p">)</span>

        <span class="c">#Keep the SFH in memory</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">sfr_abs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sfr_input</span>


    <span class="c">##############################################</span>
    <span class="c">#              Copy SFR Input                #</span>
    <span class="c">##############################################</span>
    <span class="k">def</span> <span class="nf">__copy_sfr_input</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path_sfh_in</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        This function reads a SFH input file and interpolates its values so it</span>
<span class="sd">        can be inserted in the arraw &quot;sfr_input&quot;, which contains the SFR for each</span>
<span class="sd">        OMEGA timestep.</span>

<span class="sd">        Note</span>
<span class="sd">        ====</span>

<span class="sd">          The input file does not need to have constant time step lengths, and </span>
<span class="sd">          does not need to have the same number of timesteps than the number of </span>
<span class="sd">          OMEGA timesteps.</span>

<span class="sd">        Important</span>
<span class="sd">        =========</span>

<span class="sd">          In OMEGA and SYGMA, t += timestep[i] is the first thing done in the main</span>
<span class="sd">          loop.  The loop calculates what happened between the previous t and the </span>
<span class="sd">          new t.  This means the mass of stars formed must be SFR(previous t) *</span>
<span class="sd">          timestep[i].  Therefore, sfr_input[i] IS NOT the SFR at time t += </span>
<span class="sd">          timestep[i], but rather the SFR at previous time which is used for the </span>
<span class="sd">          current step i.</span>

<span class="sd">        Argument</span>
<span class="sd">        ========</span>

<span class="sd">          path_sfh_in : Path of the input SFH file.</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c"># Variable to keep track of the OMEGA timestep</span>
        <span class="n">nb_dt_csi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nb_timesteps</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">i_dt_csi</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">t_csi</span> <span class="o">=</span> <span class="mf">0.0</span> <span class="c"># Not timesteps[0] because sfr_input[0] must be</span>
                    <span class="c"># used from t = 0 to t = timesteps[0]</span>

        <span class="c"># Variable to keep track of the total stellar mass from the input SFH</span>
        <span class="n">m_stel_sfr_in</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="c"># Open the file containing the SFR vs time</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">global_path</span><span class="o">+</span><span class="n">path_sfh_in</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">sfr_file</span><span class="p">:</span>

            <span class="c"># Read the first line  (col 0 : t, col 1 : SFR)</span>
            <span class="n">line_1_str</span> <span class="o">=</span> <span class="n">sfr_file</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
            <span class="n">parts_1</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">line_1_str</span><span class="o">.</span><span class="n">split</span><span class="p">()]</span>

            <span class="c"># For every remaining line ...</span>
            <span class="k">for</span> <span class="n">line_2_str</span> <span class="ow">in</span> <span class="n">sfr_file</span><span class="p">:</span>

                <span class="c"># Extract data</span>
                <span class="n">parts_2</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">line_2_str</span><span class="o">.</span><span class="n">split</span><span class="p">()]</span>
 
                <span class="c"># Calculate the interpolation coefficients (SFR = a*t + b)</span>
                <span class="n">a_csi</span> <span class="o">=</span> <span class="p">(</span><span class="n">parts_2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">parts_1</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">parts_2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">parts_1</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">b_csi</span> <span class="o">=</span> <span class="n">parts_1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">a_csi</span> <span class="o">*</span> <span class="n">parts_1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

                <span class="c"># While we stay in the same time bin ...</span>
                <span class="k">while</span> <span class="n">t_csi</span> <span class="o">&lt;=</span> <span class="n">parts_2</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>

                    <span class="c"># Calculate the right SFR for the specific OMEGA timestep</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">sfr_input</span><span class="p">[</span><span class="n">i_dt_csi</span><span class="p">]</span> <span class="o">=</span> <span class="n">a_csi</span> <span class="o">*</span> <span class="n">t_csi</span> <span class="o">+</span> <span class="n">b_csi</span>

                    <span class="c"># Cumulate the mass of stars formed</span>
                    <span class="k">if</span> <span class="n">i_dt_csi</span> <span class="o">&lt;</span> <span class="n">nb_dt_csi</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">m_stel_sfr_in</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sfr_input</span><span class="p">[</span><span class="n">i_dt_csi</span><span class="p">]</span> <span class="o">*</span> \
                            <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">timesteps</span><span class="p">[</span><span class="n">i_dt_csi</span><span class="p">]</span>

                        <span class="c"># Calculate the new time</span>
                        <span class="n">t_csi</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">timesteps</span><span class="p">[</span><span class="n">i_dt_csi</span><span class="p">]</span>

                    <span class="c"># Go to the next time step</span>
                    <span class="n">i_dt_csi</span> <span class="o">+=</span> <span class="mi">1</span>

                    <span class="c"># Exit the loop if the array is full</span>
                    <span class="k">if</span> <span class="n">i_dt_csi</span> <span class="o">&gt;=</span> <span class="n">nb_dt_csi</span><span class="p">:</span>
                        <span class="k">break</span>
               
                <span class="c"># Exit the loop if the array is full</span>
                <span class="k">if</span> <span class="n">i_dt_csi</span> <span class="o">&gt;=</span> <span class="n">nb_dt_csi</span><span class="p">:</span>
                    <span class="k">break</span>

                <span class="c"># Copie the last read line</span>
                <span class="n">parts_1</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">parts_2</span><span class="p">)</span>

        <span class="c"># Close the file</span>
        <span class="n">sfr_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="c"># If the file has been read completely, but the sfr_input array is</span>
        <span class="c"># not full, fill the rest of the array with the last read value</span>
        <span class="k">while</span> <span class="n">i_dt_csi</span> <span class="o">&lt;</span> <span class="n">nb_dt_csi</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sfr_input</span><span class="p">[</span><span class="n">i_dt_csi</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sfr_input</span><span class="p">[</span><span class="n">i_dt_csi</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">i_dt_csi</span> <span class="o">&lt;</span> <span class="n">nb_dt_csi</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">m_stel_sfr_in</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sfr_input</span><span class="p">[</span><span class="n">i_dt_csi</span><span class="p">]</span> <span class="o">*</span> \
                    <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">timesteps</span><span class="p">[</span><span class="n">i_dt_csi</span><span class="p">]</span>
            <span class="n">i_dt_csi</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c"># Normalise the SFR in order to be consistent with the input current</span>
        <span class="c"># stellar mass (if the stellar mass is known)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stellar_mass_0</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">norm_sfr_in</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stellar_mass_0</span> <span class="o">/</span> <span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">m_stel_sfr_in</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i_csi</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nb_dt_csi</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sfr_input</span><span class="p">[</span><span class="n">i_csi</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sfr_input</span><span class="p">[</span><span class="n">i_csi</span><span class="p">]</span> <span class="o">*</span> <span class="n">norm_sfr_in</span>


    <span class="c">##############################################</span>
    <span class="c">#             Generate Rand SFH              #</span>
    <span class="c">##############################################</span>
    <span class="k">def</span> <span class="nf">__generate_rand_sfh</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        This function generates a random SFH. This should only be used for </span>
<span class="sd">        testing purpose in order to look at how the uncertainty associated to the</span>
<span class="sd">        SFH can affects the results.</span>

<span class="sd">        The self.rand_sfh sets the maximum ratio between the maximum and the</span>
<span class="sd">        minium values for the SFR.  This parameter sets how &quot;bursty&quot; or constant</span>
<span class="sd">        a SFH is.  self.rand_sfh = 1 means a constant SFH.</span>
<span class="sd">         </span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c"># Variable to keep track of the total stellar mass from the random SFH</span>
        <span class="n">m_stel_sfr_in</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="c"># For each timestep</span>
        <span class="k">for</span> <span class="n">i_csi</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">nb_timesteps</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">sfr_input</span><span class="p">[</span><span class="n">i_csi</span><span class="p">]</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randrange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">rand_sfh</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>

            <span class="c"># Cumulate the total mass of stars formed</span>
            <span class="k">if</span> <span class="n">i_csi</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">nb_timesteps</span><span class="p">:</span>
                <span class="n">m_stel_sfr_in</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sfr_input</span><span class="p">[</span><span class="n">i_csi</span><span class="p">]</span> <span class="o">*</span> \
                    <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">timesteps</span><span class="p">[</span><span class="n">i_csi</span><span class="p">]</span>

        <span class="c"># Normalise the SFR in order to be consistent with the input</span>
        <span class="c"># current stellar mass</span>
        <span class="n">norm_sfr_in</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stellar_mass_0</span> <span class="o">/</span> <span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">m_stel_sfr_in</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i_csi</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">timesteps</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sfr_input</span><span class="p">[</span><span class="n">i_csi</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sfr_input</span><span class="p">[</span><span class="n">i_csi</span><span class="p">]</span> <span class="o">*</span> <span class="n">norm_sfr_in</span>


    <span class="c">##############################################</span>
    <span class="c">#              Fill Evol Arrays              #</span>
    <span class="c">##############################################</span>
    <span class="k">def</span> <span class="nf">__fill_evol_arrays</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        This function fills the arrays used to follow the evolution of the</span>
<span class="sd">        galaxy regarding its growth and the exchange of gas with its surrounding.</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c"># Execute this function only if needed</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_out_control</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">SF_law</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">DM_evolution</span><span class="p">:</span>

            <span class="c"># Calculate the resdhift for every timestep, if needed</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__calculate_redshift_t</span><span class="p">()</span>

            <span class="c"># Calculate the mass of the dark matter halo at every timestep</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__calculate_m_DM_t</span><span class="p">()</span>

            <span class="c"># Calculate the star formation timescale at every timestep</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__calculate_t_SF_t</span><span class="p">()</span>

            <span class="c"># Calculate the gas mass of the ISM at every timestep</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__calculate_m_tot_ISM_t</span><span class="p">()</span>

            <span class="c"># Calculate the mass-loading factor and ouflow mass at every timestep</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__calculate_outflow_t</span><span class="p">()</span>


    <span class="c">##############################################</span>
    <span class="c">#               Get t From z                 #</span>
    <span class="c">##############################################</span>
    <span class="k">def</span> <span class="nf">__get_t_from_z</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">z_gttfz</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        This function returns the age of the Universe at a given redshift.</span>

<span class="sd">        Argument</span>
<span class="sd">        ========</span>

<span class="sd">          z_gttfz : Redshift that needs to be converted into age.</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c"># Return the age of the Universe</span>
        <span class="n">temp_var</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">lambda_0</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">omega_0</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">z_gttfz</span><span class="p">)</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">x_var</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span> <span class="n">temp_var</span> <span class="o">+</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="n">temp_var</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">)</span> <span class="p">)</span>
        <span class="k">return</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span> <span class="mi">3</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">H_0</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lambda_0</span><span class="p">))</span> <span class="o">*</span> \
               <span class="n">x_var</span> <span class="o">*</span> <span class="mf">9.77793067e11</span>


    <span class="c">##############################################</span>
    <span class="c">#               Get z From t                 #</span>
    <span class="c">##############################################</span>
    <span class="k">def</span> <span class="nf">__get_z_from_t</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t_gtzft</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        This function returns the redshift of a given Universe age.</span>

<span class="sd">        Argument</span>
<span class="sd">        ========</span>

<span class="sd">          t_gtzft : Age of the Universe that needs to be converted into redshift.</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c"># Return the redshift</span>
        <span class="n">temp_var</span> <span class="o">=</span> <span class="mf">1.5340669e-12</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">lambda_0</span><span class="o">**</span><span class="mf">0.5</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">H_0</span> <span class="o">*</span> <span class="n">t_gtzft</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lambda_0</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">omega_0</span><span class="p">)</span><span class="o">**</span><span class="mf">0.3333333</span> <span class="o">/</span> \
                <span class="n">math</span><span class="o">.</span><span class="n">sinh</span><span class="p">(</span><span class="n">temp_var</span><span class="p">)</span><span class="o">**</span><span class="mf">0.66666667</span> <span class="o">-</span> <span class="mi">1</span>


    <span class="c">##############################################</span>
    <span class="c">#           Calculate redshift(t)            #</span>
    <span class="c">##############################################</span>
    <span class="k">def</span> <span class="nf">__calculate_redshift_t</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        This functions calculates the redshift associated to every timestep</span>
<span class="sd">        assuming that &#39;tend&#39; represents redshift zero.</span>

<span class="sd">        &#39;&#39;&#39;</span>
 
        <span class="c"># Execute the function only if needed</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">DM_evolution</span><span class="p">:</span>

            <span class="c"># Calculate the current age of the Universe (LambdaCDM - z = 0)</span>
            <span class="n">current_age_czt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_t_from_z</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">redshift_f</span><span class="p">)</span>

            <span class="c"># Calculate the age of the Universe when the galaxy forms</span>
            <span class="n">age_formation_czt</span> <span class="o">=</span> <span class="n">current_age_czt</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">tend</span>

            <span class="c"># Initiate the age of the galaxy</span>
            <span class="n">t_czt</span> <span class="o">=</span> <span class="mf">0.0</span>

            <span class="c">#For each timestep</span>
            <span class="k">for</span> <span class="n">i_czt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nb_timesteps</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>

                <span class="c">#Calculate the age of the Universe at that time [yr]</span>
                <span class="n">age_universe_czt</span> <span class="o">=</span> <span class="n">age_formation_czt</span> <span class="o">+</span> <span class="n">t_czt</span>

                <span class="c">#Calculate the redshift at that time</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">redshift_t</span><span class="p">[</span><span class="n">i_czt</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_z_from_t</span><span class="p">(</span><span class="n">age_universe_czt</span><span class="p">)</span>

                <span class="c">#Udpate the age of the galaxy [yr]</span>
                <span class="k">if</span> <span class="n">i_czt</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">nb_timesteps</span><span class="p">:</span>
                    <span class="n">t_czt</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">timesteps</span><span class="p">[</span><span class="n">i_czt</span><span class="p">]</span>

            <span class="c">#Correction for last digit error (e.g. z = -2.124325345e-8)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">redshift_t</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">redshift_t</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>


    <span class="c">##############################################</span>
    <span class="c">#              Calculate M_DM(t)             #</span>
    <span class="c">##############################################</span>
    <span class="k">def</span> <span class="nf">__calculate_m_DM_t</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        This functions calculates the mass of the dark matter halo at each</span>
<span class="sd">        timestep.</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c"># If the mass of the dark matter halo is kept at a constant value ...</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">DM_evolution</span><span class="p">:</span>

            <span class="c"># Use the current value for every timestep</span>
            <span class="k">for</span> <span class="n">i_cmdt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nb_timesteps</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">m_DM_t</span><span class="p">[</span><span class="n">i_cmdt</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_DM_0</span>

        <span class="c"># If the mass of the dark matter halo evolves with time ...</span>
        <span class="k">else</span><span class="p">:</span>

            <span class="c"># Calculate the polynomial coefficient for the evolution of</span>
            <span class="c"># the dark matter mass</span>
            <span class="n">poly_up_dm</span><span class="p">,</span> <span class="n">poly_low_dm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_DM_bdy</span><span class="p">()</span>

            <span class="c"># For each timestep ...</span>
            <span class="k">for</span> <span class="n">i_cmdt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nb_timesteps</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>

                <span class="c"># Calculate the lower and upper dark matter mass boundaries</span>
                <span class="n">log_m_dm_up</span> <span class="o">=</span> <span class="n">poly_up_dm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">redshift_t</span><span class="p">[</span><span class="n">i_cmdt</span><span class="p">]</span><span class="o">**</span><span class="mi">3</span> <span class="o">+</span> \
                    <span class="n">poly_up_dm</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">redshift_t</span><span class="p">[</span><span class="n">i_cmdt</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">poly_up_dm</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> \
                        <span class="bp">self</span><span class="o">.</span><span class="n">redshift_t</span><span class="p">[</span><span class="n">i_cmdt</span><span class="p">]</span> <span class="o">+</span> <span class="n">poly_up_dm</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
                <span class="n">log_m_dm_low</span> <span class="o">=</span> <span class="n">poly_low_dm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">redshift_t</span><span class="p">[</span><span class="n">i_cmdt</span><span class="p">]</span><span class="o">**</span><span class="mi">3</span> <span class="o">+</span> \
                    <span class="n">poly_low_dm</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">redshift_t</span><span class="p">[</span><span class="n">i_cmdt</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">poly_low_dm</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span>\
                        <span class="bp">self</span><span class="o">.</span><span class="n">redshift_t</span><span class="p">[</span><span class="n">i_cmdt</span><span class="p">]</span> <span class="o">+</span> <span class="n">poly_low_dm</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>

                <span class="c"># If the dark matter mass is too low for the available fit ...</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">DM_too_low</span><span class="p">:</span>

                    <span class="c"># Scale the fit using the current input mass</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">m_DM_t</span><span class="p">[</span><span class="n">i_cmdt</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">log_m_dm_low</span> <span class="o">*</span> \
                                            <span class="bp">self</span><span class="o">.</span><span class="n">m_DM_0</span> <span class="o">/</span> <span class="mi">10</span><span class="o">**</span><span class="n">poly_low_dm</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>

                <span class="c"># If the dark matter mass can be interpolate</span>
                <span class="k">else</span><span class="p">:</span>

                    <span class="c"># Use a linear interpolation with the log of the mass</span>
                    <span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="n">log_m_dm_up</span> <span class="o">-</span> <span class="n">log_m_dm_low</span><span class="p">)</span> <span class="o">/</span> \
                        <span class="p">(</span><span class="n">poly_up_dm</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">poly_low_dm</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
                    <span class="n">b</span> <span class="o">=</span> <span class="n">log_m_dm_up</span> <span class="o">-</span> <span class="n">a</span> <span class="o">*</span> <span class="n">poly_up_dm</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">m_DM_t</span><span class="p">[</span><span class="n">i_cmdt</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span> <span class="n">a</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m_DM_0</span><span class="p">)</span> <span class="o">+</span> <span class="n">b</span> <span class="p">)</span>

            <span class="c"># If the simulation do not stop at redshift zero ...</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">redshift_f</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>

                <span class="c"># Scale the DM mass (because the fits look at M_DM_0 at z=0)</span>
                <span class="n">m_dm_scale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_DM_0</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_DM_t</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">i_cmdt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nb_timesteps</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">m_DM_t</span><span class="p">[</span><span class="n">i_cmdt</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_DM_t</span><span class="p">[</span><span class="n">i_cmdt</span><span class="p">]</span> <span class="o">*</span> <span class="n">m_dm_scale</span>


    <span class="c">##############################################</span>
    <span class="c">#                  Get DM Bdy                #</span>
    <span class="c">##############################################</span>
    <span class="c"># Return the fit coefficients for the interpolation of the dark matter mass</span>
    <span class="k">def</span> <span class="nf">__get_DM_bdy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        This functions calculates and returns the fit coefficients for the</span>
<span class="sd">        interpolation of the evolution of the dark matter mass as a function </span>
<span class="sd">        of time.</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c"># Open the file containing the coefficient of the 3rd order polynomial fit</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">global_path</span><span class="o">+</span><span class="s">&quot;m_dm_evolution/poly3_fits.txt&quot;</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">m_dm_file</span><span class="p">:</span>

            <span class="c"># Read the first line</span>
            <span class="n">line_str</span> <span class="o">=</span> <span class="n">m_dm_file</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
            <span class="n">parts_1</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">line_str</span><span class="o">.</span><span class="n">split</span><span class="p">()]</span>

            <span class="c"># If the input dark matter mass if higher than the ones provided</span>
            <span class="c"># by the fits ...</span>
            <span class="k">if</span> <span class="n">math</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m_DM_0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">parts_1</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span>

                <span class="c"># Use the highest dark matter mass available</span>
                <span class="n">parts_2</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">parts_1</span><span class="p">)</span>
                <span class="k">print</span> <span class="s">&#39;Warning - Current dark matter mass too high for&#39;</span> \
                      <span class="s">&#39;the available fits.&#39;</span>

            <span class="c"># If the input dark matter mass is in the available range ...</span>
            <span class="c"># Find the mass boundary for the interpolation.</span>
            <span class="k">else</span><span class="p">:</span>

                <span class="c"># For every remaining line ...</span>
                <span class="k">for</span> <span class="n">line_str</span> <span class="ow">in</span> <span class="n">m_dm_file</span><span class="p">:</span>

                    <span class="c"># Extract data</span>
                    <span class="n">parts_2</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">line_str</span><span class="o">.</span><span class="n">split</span><span class="p">()]</span>

                    <span class="c"># If the read mass is lower than the input dark matter mass</span>
                    <span class="k">if</span> <span class="n">math</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m_DM_0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">parts_2</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span>
                        <span class="c"># Exit the loop and use the current interpolation boundary</span>
                        <span class="k">break</span>

                    <span class="c"># Copy the current read line</span>
                    <span class="n">parts_1</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">parts_2</span><span class="p">)</span>

            <span class="c"># Keep track if the input dark matter mass is too low ...</span>
            <span class="k">if</span> <span class="n">parts_1</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="n">parts_2</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span>
                 <span class="bp">self</span><span class="o">.</span><span class="n">DM_too_low</span> <span class="o">=</span> <span class="bp">True</span>

        <span class="c">#Close the file</span>
        <span class="n">m_dm_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">parts_1</span><span class="p">,</span> <span class="n">parts_2</span>


    <span class="c">##############################################</span>
    <span class="c">#             Calculate t_SF(t)              #</span>
    <span class="c">##############################################</span>
    <span class="k">def</span> <span class="nf">__calculate_t_SF_t</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        This functions calculates the star formation timescale at every timestep.</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c"># Execute this function only if needed</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">SF_law</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">DM_evolution</span><span class="p">:</span>

            <span class="c"># If the star formation timescale is kept constant ...</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_star</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>

                <span class="c"># Use the same value for every timestep</span>
                <span class="k">for</span> <span class="n">i_ctst</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nb_timesteps</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">t_SF_t</span><span class="p">[</span><span class="n">i_ctst</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_star</span>

            <span class="c"># If the timescale follows the halo dynamical time ...</span>
            <span class="k">else</span><span class="p">:</span>

                <span class="c"># Set the timescale to a fraction of the halo dynamical time</span>
                <span class="c"># See White &amp; Frenk (1991); Springel et al. (2001)</span>
                <span class="k">for</span> <span class="n">i_ctst</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nb_timesteps</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>

                    <span class="c"># If the dark matter mass is evolving ...</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">DM_evolution</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">t_SF_t</span><span class="p">[</span><span class="n">i_ctst</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">f_dyn</span> <span class="o">*</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> \
                            <span class="bp">self</span><span class="o">.</span><span class="n">redshift_t</span><span class="p">[</span><span class="n">i_ctst</span><span class="p">])</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mf">1.5</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">H_0</span> <span class="o">*</span> \
                                <span class="mf">9.7759839e11</span>

                    <span class="c"># If the dark matter mass is not evolving ...</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">t_SF_t</span><span class="p">[</span><span class="n">i_ctst</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">f_dyn</span> <span class="o">*</span> <span class="mf">0.1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">H_0</span> <span class="o">*</span> \
                                <span class="mf">9.7759839e11</span>


    <span class="c">##############################################</span>
    <span class="c">#           Calculate M_tot ISM(t)           #</span>
    <span class="c">##############################################</span>
    <span class="k">def</span> <span class="nf">__calculate_m_tot_ISM_t</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        This functions calculates the mass of the gas reservoir at every </span>
<span class="sd">        timestep using a classical star formation law.</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c"># Execute this function only if needed</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">SF_law</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">DM_evolution</span><span class="p">:</span>

            <span class="c"># For each timestep ...</span>
            <span class="k">for</span> <span class="n">i_cm</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nb_timesteps</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>

                <span class="c"># If it&#39;s the last timestep ... use the previous sfr_input</span>
                <span class="k">if</span> <span class="n">i_cm</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">nb_timesteps</span><span class="p">:</span>

                    <span class="c"># Calculate the total mass of the ISM using the previous SFR</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">m_tot_ISM_t</span><span class="p">[</span><span class="n">i_cm</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sfr_input</span><span class="p">[</span><span class="n">i_cm</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> \
                        <span class="bp">self</span><span class="o">.</span><span class="n">t_SF_t</span><span class="p">[</span><span class="n">i_cm</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">sfe</span>

                <span class="c"># If it&#39;s not the last timestep ...</span>
                <span class="k">else</span><span class="p">:</span>

                    <span class="c"># Calculate the total mass of the ISM using the current SFR</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">m_tot_ISM_t</span><span class="p">[</span><span class="n">i_cm</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sfr_input</span><span class="p">[</span><span class="n">i_cm</span><span class="p">]</span> <span class="o">*</span> \
                        <span class="bp">self</span><span class="o">.</span><span class="n">t_SF_t</span><span class="p">[</span><span class="n">i_cm</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">sfe</span>

            <span class="c"># Scale the initial gas reservoir that was already set</span>
            <span class="n">scale_m_tot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_tot_ISM_t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">mgal</span>
            <span class="k">for</span> <span class="n">k_cm</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ymgal</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ymgal</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">k_cm</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ymgal</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">k_cm</span><span class="p">]</span> <span class="o">*</span> <span class="n">scale_m_tot</span>


    <span class="c">####################a##########################</span>
    <span class="c">#              Calculate Outflow             #</span>
    <span class="c">##############################################</span>
    <span class="k">def</span> <span class="nf">__calculate_outflow_t</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        This functions calculates the mass-loading factor and the mass of outflow </span>
<span class="sd">        at every timestep.</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c"># If the outflow rate is kept constant ...</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">outflow_rate</span> <span class="o">&gt;=</span> <span class="mf">0.0</span><span class="p">:</span>

            <span class="c"># Use the input value for each timestep</span>
            <span class="k">for</span> <span class="n">i_ceo</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nb_timesteps</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">eta_outflow_t</span><span class="p">[</span><span class="n">i_ceo</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outflow_rate</span> <span class="o">/</span> \
                    <span class="bp">self</span><span class="o">.</span><span class="n">sfr_input</span><span class="p">[</span><span class="n">i_ceo</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">m_outflow_t</span><span class="p">[</span><span class="n">i_ceo</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outflow_rate</span> <span class="o">*</span> \
                    <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">timesteps</span><span class="p">[</span><span class="n">i_ceo</span><span class="p">]</span>

        <span class="c"># If the outflow rate is connected to the SFR ...</span>
        <span class="k">else</span><span class="p">:</span>

            <span class="c"># If the mass of the dark matter halo is not evolving</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">DM_evolution</span><span class="p">:</span>

                <span class="c">#For each timestep ...</span>
                <span class="k">for</span> <span class="n">i_ceo</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nb_timesteps</span><span class="p">):</span>

                    <span class="c"># Use the input mass-loading factor</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">eta_outflow_t</span><span class="p">[</span><span class="n">i_ceo</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass_loading</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">m_outflow_t</span><span class="p">[</span><span class="n">i_ceo</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eta_outflow_t</span><span class="p">[</span><span class="n">i_ceo</span><span class="p">]</span> <span class="o">*</span> \
                        <span class="bp">self</span><span class="o">.</span><span class="n">sfr_input</span><span class="p">[</span><span class="n">i_ceo</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">timesteps</span><span class="p">[</span><span class="n">i_ceo</span><span class="p">]</span>
                  
            <span class="c"># If the mass of the dark matter halo is evolving</span>
            <span class="k">else</span><span class="p">:</span>

                <span class="c"># Use the input mass-loading factor to normalize the evolution</span>
                <span class="c"># of this factor as a function of time</span>
                <span class="n">eta_norm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass_loading</span> <span class="o">*</span> \
                    <span class="bp">self</span><span class="o">.</span><span class="n">m_DM_0</span><span class="o">**</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exp_ml</span><span class="o">*</span><span class="mf">0.33333</span><span class="p">)</span><span class="o">*</span> \
                        <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">redshift_f</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mf">0.5</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">exp_ml</span><span class="p">)</span>

                <span class="c"># For each timestep ...</span>
                <span class="k">for</span> <span class="n">i_ceo</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nb_timesteps</span><span class="p">):</span>

                    <span class="c"># Calculate the mass-loading factor with redshift depen</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_dependent</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">eta_outflow_t</span><span class="p">[</span><span class="n">i_ceo</span><span class="p">]</span> <span class="o">=</span> <span class="n">eta_norm</span> <span class="o">*</span> \
                            <span class="bp">self</span><span class="o">.</span><span class="n">m_DM_t</span><span class="p">[</span><span class="n">i_ceo</span><span class="p">]</span><span class="o">**</span><span class="p">((</span><span class="o">-</span><span class="mf">0.3333</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">exp_ml</span><span class="p">)</span> <span class="o">*</span> \
                                <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">redshift_t</span><span class="p">[</span><span class="n">i_ceo</span><span class="p">])</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">exp_ml</span><span class="p">)</span>

                    <span class="c"># Calculate the mass-loading factor without redshift depen</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">eta_outflow_t</span><span class="p">[</span><span class="n">i_ceo</span><span class="p">]</span> <span class="o">=</span> <span class="n">eta_norm</span> <span class="o">*</span> \
                            <span class="bp">self</span><span class="o">.</span><span class="n">m_DM_t</span><span class="p">[</span><span class="n">i_ceo</span><span class="p">]</span><span class="o">**</span><span class="p">((</span><span class="o">-</span><span class="mf">0.3333</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">exp_ml</span><span class="p">)</span>

                    <span class="c"># Calculate the outflow mass during the current timestep</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">m_outflow_t</span><span class="p">[</span><span class="n">i_ceo</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eta_outflow_t</span><span class="p">[</span><span class="n">i_ceo</span><span class="p">]</span> <span class="o">*</span> \
                        <span class="bp">self</span><span class="o">.</span><span class="n">sfr_input</span><span class="p">[</span><span class="n">i_ceo</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">timesteps</span><span class="p">[</span><span class="n">i_ceo</span><span class="p">]</span>


    <span class="c">##############################################</span>
    <span class="c">#                Run Simulation              #</span>
    <span class="c">##############################################</span>
    <span class="k">def</span> <span class="nf">__run_simulation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        This function calculates the evolution of the chemical abundances of a</span>
<span class="sd">        galaxy as a function of time.</span>
<span class="sd">         </span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c"># For every timestep i considered in the simulation ...</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nb_timesteps</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>

            <span class="c"># Calculate the current mass fraction of gas converted into stars</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__cal_m_frac_stars</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                
            <span class="c"># Run the timestep i</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_evol_stars</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

            <span class="c"># If the open box scenario is used ...</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">open_box</span><span class="p">:</span>

                <span class="c"># Calculate the total mass of the gas reservoir at timstep i</span>
                <span class="c"># after the star formation and the stellar ejecta</span>
                <span class="n">m_tot_current</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="k">for</span> <span class="n">k_op</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nb_isotopes</span><span class="p">):</span>
                    <span class="n">m_tot_current</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ymgal</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">k_op</span><span class="p">]</span>

                <span class="c"># Get the current mass of inflow</span>
                <span class="n">m_inflow_current</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_m_inflow</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">m_tot_current</span><span class="p">)</span>

                <span class="c"># Add primordial gas coming with the inflow</span>
                <span class="k">if</span> <span class="n">m_inflow_current</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
                    <span class="n">ym_inflow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prim_comp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">quantity</span><span class="o">=</span><span class="s">&#39;Yields&#39;</span><span class="p">)</span> <span class="o">*</span> \
                                <span class="n">m_inflow_current</span>
                    <span class="k">for</span> <span class="n">k_op</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nb_isotopes</span><span class="p">):</span>
		        <span class="bp">self</span><span class="o">.</span><span class="n">ymgal</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">k_op</span><span class="p">]</span> <span class="o">+=</span> <span class="n">ym_inflow</span><span class="p">[</span><span class="n">k_op</span><span class="p">]</span>
                
                <span class="c">#Calculate the fraction of gas removed by the outflow</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">m_tot_current</span> <span class="o">+</span> <span class="n">m_inflow_current</span><span class="p">)</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
                    <span class="n">frac_rem</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_outflow_t</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> \
                        <span class="p">(</span><span class="n">m_tot_current</span> <span class="o">+</span> <span class="n">m_inflow_current</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">frac_rem</span> <span class="o">=</span> <span class="mf">0.0</span>


                <span class="c"># Limit the outflow mass to the amount of available gas</span>
                <span class="k">if</span> <span class="n">frac_rem</span> <span class="o">&gt;</span> <span class="mf">1.0</span><span class="p">:</span>
                    <span class="n">frac_rem</span> <span class="o">=</span> <span class="mf">1.0</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">m_outflow_t</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">m_tot_current</span> <span class="o">+</span> <span class="n">m_inflow_current</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">print_off</span><span class="p">:</span>
                        <span class="k">print</span> <span class="s">&#39;Warning - &#39;</span>\
                          <span class="s">&#39;Outflows eject more mass than available.  &#39;</span> \
                          <span class="s">&#39;It has been reduced to the amount of available gas.&#39;</span>

                <span class="c"># Remove mass from the ISM because of the outflow</span>
		<span class="k">for</span> <span class="n">k_op</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nb_isotopes</span><span class="p">):</span>
		    <span class="bp">self</span><span class="o">.</span><span class="n">ymgal</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">k_op</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">frac_rem</span><span class="p">)</span> <span class="o">*</span> \
                        <span class="bp">self</span><span class="o">.</span><span class="n">ymgal</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">k_op</span><span class="p">]</span>
		    <span class="bp">self</span><span class="o">.</span><span class="n">ymgal_agb</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">k_op</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">frac_rem</span><span class="p">)</span> <span class="o">*</span> \
                        <span class="bp">self</span><span class="o">.</span><span class="n">ymgal_agb</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">k_op</span><span class="p">]</span>
		    <span class="bp">self</span><span class="o">.</span><span class="n">ymgal_1a</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">k_op</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">frac_rem</span><span class="p">)</span> <span class="o">*</span> \
                        <span class="bp">self</span><span class="o">.</span><span class="n">ymgal_1a</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">k_op</span><span class="p">]</span>
		    <span class="bp">self</span><span class="o">.</span><span class="n">ymgal_massive</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">k_op</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">frac_rem</span><span class="p">)</span> <span class="o">*</span> \
                        <span class="bp">self</span><span class="o">.</span><span class="n">ymgal_massive</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">k_op</span><span class="p">]</span>

            <span class="c"># Get the new metallicity of the gas</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">zmetal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getmetallicity</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

            <span class="c"># Update the history class</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_history</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>


    <span class="c">##############################################</span>
    <span class="c">#              Cal M Frac Stars              #</span>
    <span class="c">##############################################</span>
    <span class="k">def</span> <span class="nf">__cal_m_frac_stars</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        This function calculates the mass fraction of the gas reservoir that</span>
<span class="sd">        is converted into stars at a given timestep.</span>

<span class="sd">        Argument</span>
<span class="sd">        ========</span>

<span class="sd">          i : Index of the timestep. </span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c"># Calculate the total mass of stars formed during this timestep</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sfrin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sfr_input</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">timesteps</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="c"># Calculate the mass fraction of gas converted into stars</span>
        <span class="n">mgal_tot</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">k_ml</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nb_isotopes</span><span class="p">):</span>
            <span class="n">mgal_tot</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ymgal</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">k_ml</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sfrin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sfrin</span> <span class="o">/</span> <span class="n">mgal_tot</span>

        <span class="c"># Modify the history of SFR if there is not enough gas</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sfrin</span> <span class="o">&gt;</span> <span class="mf">1.0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">sfr_abs</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">mgal_tot</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">timesteps</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>


    <span class="c">##############################################</span>
    <span class="c">#                Get M Inflow                #</span>
    <span class="c">##############################################</span>
    <span class="k">def</span> <span class="nf">__get_m_inflow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">m_tot_current</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        This function calculates and returns the inflow mass at a given timestep</span>

<span class="sd">        Argument</span>
<span class="sd">        ========</span>

<span class="sd">          i : Index of the timestep. </span>
<span class="sd">          m_tot_current : Total mass of the gas reservoir at step i</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c"># If the constant inflow rate is kept constant ...</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">inflow_rate</span> <span class="o">&gt;=</span> <span class="mf">0.0</span><span class="p">:</span>

            <span class="c"># Use the input rate to calculate the inflow mass</span>
            <span class="c"># Note : i-1 --&gt; current timestep, see __copy_sfr_input()</span>
            <span class="n">m_inflow_current</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inflow_rate</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">timesteps</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="c"># If the inflow rate follows the outflow rate ...</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_out_control</span><span class="p">:</span>

            <span class="c"># Use the input scale factor to calculate the inflow mass</span>
            <span class="n">m_inflow_current</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_out_ratio</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_outflow_t</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>


        <span class="c"># If the inflow rate is calculated from the main equation ...</span>
        <span class="k">else</span><span class="p">:</span>

            <span class="c"># If SFR = 0 and we do not want to use the main equation ..</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sfr_input</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">skip_zero</span><span class="p">:</span>
                <span class="n">m_inflow_current</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">else</span><span class="p">:</span>

                <span class="c"># Calculate the mass of the inflow </span>
                <span class="n">m_inflow_current</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_tot_ISM_t</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> \
                    <span class="n">m_tot_current</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_outflow_t</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

                <span class="c"># If the inflow mass is negative ...</span>
                <span class="k">if</span> <span class="n">m_inflow_current</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">:</span>

                    <span class="c"># Convert the negative inflow into positive outflow</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">skip_zero</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">m_outflow_t</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">m_inflow_current</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">print_off</span><span class="p">:</span>
                            <span class="k">print</span> <span class="s">&#39;Warning - Negative inflow.  &#39;</span> \
                              <span class="s">&#39;The outflow rate has been increased.&#39;</span><span class="p">,</span> <span class="n">i</span>

                    <span class="c"># Assume no inflow</span>
                    <span class="n">m_inflow_current</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="c"># Keep the mass of inflow in memory</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">m_inflow_t</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">m_inflow_current</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">m_inflow_current</span>


<span class="c">###############################################################################################</span>
<span class="c">######################## Here start the analysis methods ######################################</span>
<span class="c">###############################################################################################</span>



<div class="viewcode-block" id="omega.plot_mass"><a class="viewcode-back" href="../omega.html#omega.omega.plot_mass">[docs]</a>    <span class="k">def</span> <span class="nf">plot_mass</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fig</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">specie</span><span class="o">=</span><span class="s">&#39;C&#39;</span><span class="p">,</span><span class="n">source</span><span class="o">=</span><span class="s">&#39;all&#39;</span><span class="p">,</span><span class="n">norm</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="n">shape</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="n">markevery</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">multiplot</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">return_x_y</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">fsize</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mf">4.5</span><span class="p">],</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span><span class="n">rspace</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span><span class="n">bspace</span><span class="o">=</span><span class="mf">0.15</span><span class="p">,</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span><span class="n">legend_fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">):</span>
    
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">	 mass evolution (in Msun) of an element or isotope vs time.</span>
<span class="sd">	</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>


<span class="sd">	specie : string</span>
<span class="sd">             isotope or element name, in the form &#39;C&#39; or &#39;C-12&#39;</span>
<span class="sd">	source : string</span>
<span class="sd">             Specifies if yields come from</span>
<span class="sd">	     all sources (&#39;all&#39;), including</span>
<span class="sd">	     AGB+SN1a, massive stars. Or from</span>
<span class="sd">	     distinctive sources:</span>
<span class="sd">	     only agb stars (&#39;agb&#39;), only</span>
<span class="sd">	     SN1a (&#39;SN1a&#39;), or only massive stars</span>
<span class="sd">             (&#39;massive&#39;)</span>
<span class="sd">        norm : boolean</span>
<span class="sd">             If True, normalize to current total ISM mass</span>
<span class="sd">	label : string</span>
<span class="sd">	     figure label</span>
<span class="sd">	marker : string</span>
<span class="sd">	     figure marker</span>
<span class="sd">	shape : string</span>
<span class="sd">	     line style	</span>
<span class="sd">	color : string</span>
<span class="sd">	     color of line</span>
<span class="sd">        fig : string,float</span>
<span class="sd">	     to name the plot figure       </span>
<span class="sd"> 	       </span>
<span class="sd">        Examples</span>
<span class="sd">	----------</span>

<span class="sd">	&gt;&gt;&gt; s.plot(&#39;C-12&#39;)</span>

<span class="sd">        &#39;&#39;&#39;</span>
	<span class="n">yaxis</span><span class="o">=</span><span class="n">specie</span>
	<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">label</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">:</span>
		<span class="n">label</span><span class="o">=</span><span class="n">yaxis</span>
		<span class="k">if</span> <span class="n">source</span><span class="o">==</span><span class="s">&#39;agb&#39;</span><span class="p">:</span>
			<span class="n">label</span><span class="o">=</span><span class="n">yaxis</span><span class="o">+</span><span class="s">&#39;, AGB&#39;</span>
		<span class="k">if</span> <span class="n">source</span><span class="o">==</span><span class="s">&#39;massive&#39;</span><span class="p">:</span>
			<span class="n">label</span><span class="o">=</span><span class="n">yaxis</span><span class="o">+</span><span class="s">&#39;, Massive&#39;</span>
		<span class="k">if</span> <span class="n">source</span><span class="o">==</span><span class="s">&#39;sn1a&#39;</span><span class="p">:</span>
			<span class="n">label</span><span class="o">=</span><span class="n">yaxis</span><span class="o">+</span><span class="s">&#39;, SNIa&#39;</span>

        <span class="c">#Reserved for plotting</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">return_x_y</span><span class="p">:</span>
            <span class="n">shape</span><span class="p">,</span><span class="n">marker</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__msc</span><span class="p">(</span><span class="n">source</span><span class="p">,</span><span class="n">shape</span><span class="p">,</span><span class="n">marker</span><span class="p">,</span><span class="n">color</span><span class="p">)</span>

        <span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">age</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">=</span><span class="n">x</span>
        <span class="n">y</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">yields_evol_all</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">ism_elem_yield</span>
        <span class="k">if</span> <span class="n">yaxis</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">elements</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">source</span> <span class="o">==</span> <span class="s">&#39;all&#39;</span><span class="p">:</span>
                <span class="n">yields_evol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">ism_elem_yield</span>
            <span class="k">elif</span> <span class="n">source</span> <span class="o">==</span><span class="s">&#39;agb&#39;</span><span class="p">:</span>
                <span class="n">yields_evol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">ism_elem_yield_agb</span>
            <span class="k">elif</span> <span class="n">source</span> <span class="o">==</span> <span class="s">&#39;sn1a&#39;</span><span class="p">:</span>
                <span class="n">yields_evol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">ism_elem_yield_1a</span>
            <span class="k">elif</span> <span class="n">source</span> <span class="o">==</span> <span class="s">&#39;massive&#39;</span><span class="p">:</span>
                <span class="n">yields_evol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">ism_elem_yield_massive</span>
            <span class="n">idx</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">elements</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">yaxis</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">yaxis</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">isotopes</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">source</span> <span class="o">==</span> <span class="s">&#39;all&#39;</span><span class="p">:</span>
                <span class="n">yields_evol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">ism_iso_yield</span>
            <span class="k">elif</span> <span class="n">source</span> <span class="o">==</span><span class="s">&#39;agb&#39;</span><span class="p">:</span>
                <span class="n">yields_evol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">ism_iso_yield_agb</span>
            <span class="k">elif</span> <span class="n">source</span> <span class="o">==</span> <span class="s">&#39;sn1a&#39;</span><span class="p">:</span>
                <span class="n">yields_evol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">ism_iso_yield_1a</span>
            <span class="k">elif</span> <span class="n">source</span> <span class="o">==</span> <span class="s">&#39;massive&#39;</span><span class="p">:</span>
                <span class="n">yields_evol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">ism_iso_yield_massive</span>
            <span class="n">idx</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">isotopes</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">yaxis</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&#39;Isotope or element not available&#39;</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">yields_evol</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">norm</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
                <span class="n">y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">yields_evol</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">idx</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">yields_evol</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">idx</span><span class="p">]</span><span class="o">/</span><span class="n">yields_evol_all</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">idx</span><span class="p">])</span>


        <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="k">if</span> <span class="n">multiplot</span><span class="o">==</span><span class="bp">True</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span>  

        <span class="c">#Reserved for plotting</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">return_x_y</span><span class="p">:</span>
           <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">fsize</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">fsize</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
           <span class="n">plt</span><span class="o">.</span><span class="n">xscale</span><span class="p">(</span><span class="s">&#39;log&#39;</span><span class="p">)</span>
           <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;log-scaled age [yrs]&#39;</span><span class="p">)</span>
           <span class="k">if</span> <span class="n">norm</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
               <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;yields [Msun]&#39;</span><span class="p">)</span>
               <span class="n">plt</span><span class="o">.</span><span class="n">yscale</span><span class="p">(</span><span class="s">&#39;log&#39;</span><span class="p">)</span>
           <span class="k">else</span><span class="p">:</span>
               <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;(IMF-weighted) fraction of ejecta&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">=</span><span class="n">y</span>

        <span class="c">#If x and y need to be returned ...</span>
        <span class="k">if</span> <span class="n">return_x_y</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span><span class="n">markevery</span><span class="o">=</span><span class="n">markevery</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
            <span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__fig_standard</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span><span class="n">labelsize</span><span class="o">=</span><span class="n">labelsize</span><span class="p">,</span><span class="n">rspace</span><span class="o">=</span><span class="n">rspace</span><span class="p">,</span> <span class="n">bspace</span><span class="o">=</span><span class="n">bspace</span><span class="p">,</span><span class="n">legend_fontsize</span><span class="o">=</span><span class="n">legend_fontsize</span><span class="p">)</span>
	    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">dt</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">tend</span><span class="p">)</span>	
	    <span class="c">#return x,y</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">save_data</span><span class="p">(</span><span class="n">header</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;Age[yrs]&#39;</span><span class="p">,</span><span class="n">specie</span><span class="p">],</span><span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">])</span>

</div>
<div class="viewcode-block" id="omega.plot_massfrac"><a class="viewcode-back" href="../omega.html#omega.omega.plot_massfrac">[docs]</a>    <span class="k">def</span> <span class="nf">plot_massfrac</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fig</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">xaxis</span><span class="o">=</span><span class="s">&#39;age&#39;</span><span class="p">,</span><span class="n">yaxis</span><span class="o">=</span><span class="s">&#39;O-16&#39;</span><span class="p">,</span><span class="n">source</span><span class="o">=</span><span class="s">&#39;all&#39;</span><span class="p">,</span><span class="n">norm</span><span class="o">=</span><span class="s">&#39;no&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="n">shape</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="n">markevery</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">fsize</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mf">4.5</span><span class="p">],</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span><span class="n">rspace</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span><span class="n">bspace</span><span class="o">=</span><span class="mf">0.15</span><span class="p">,</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span><span class="n">legend_fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">	Plots mass fraction of isotope or element</span>
<span class="sd">	vs either time or other isotope or element.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">	xaxis : string </span>
<span class="sd">            either &#39;age&#39; for time</span>
<span class="sd">	    or isotope name, in the form e.g. &#39;C-12&#39;</span>
<span class="sd">	yaxis : string</span>
<span class="sd">            isotope name, in the same form as for xaxis</span>

<span class="sd">	source : string</span>
<span class="sd">            Specifies if yields come from</span>
<span class="sd">	    all sources (&#39;all&#39;), including</span>
<span class="sd">	    AGB+SN1a, massive stars. Or from</span>
<span class="sd">	    distinctive sources:</span>
<span class="sd">	    only agb stars (&#39;agb&#39;), only</span>
<span class="sd">	    SN1a (&#39;SN1a&#39;), or only massive stars</span>
<span class="sd">            (&#39;massive&#39;)</span>

<span class="sd">        norm : string</span>
<span class="sd">            if &#39;no&#39;, no normalization of mass fraction</span>
<span class="sd">            if &#39;ini&#39;, normalization ot initial abundance</span>
<span class="sd">        label : string</span>
<span class="sd">             figure label</span>
<span class="sd">        marker : string</span>
<span class="sd">             figure marker</span>
<span class="sd">        shape : string</span>
<span class="sd">             line style </span>
<span class="sd">        color : string</span>
<span class="sd">             color of line</span>
<span class="sd">        fig : string,float</span>
<span class="sd">             to name the plot figure       </span>

<span class="sd">        </span>
<span class="sd">        Examples</span>
<span class="sd">        ----------</span>

<span class="sd">	&gt;&gt;&gt; s.plot_massfrac(&#39;age&#39;,&#39;C-12&#39;)</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">label</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">label</span><span class="o">=</span><span class="n">yaxis</span>

	<span class="n">shape</span><span class="p">,</span><span class="n">marker</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__msc</span><span class="p">(</span><span class="n">source</span><span class="p">,</span><span class="n">shape</span><span class="p">,</span><span class="n">marker</span><span class="p">,</span><span class="n">color</span><span class="p">)</span>



        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">fsize</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">fsize</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

 
        <span class="c">#Input X-axis</span>
        <span class="k">if</span> <span class="s">&#39;-&#39;</span> <span class="ow">in</span> <span class="n">xaxis</span><span class="p">:</span>
        <span class="c">#to test the different contributions</span>
	    <span class="k">if</span> <span class="n">source</span> <span class="o">==</span> <span class="s">&#39;all&#39;</span><span class="p">:</span>
	       <span class="n">yields_evol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">ism_iso_yield</span>
	    <span class="k">elif</span> <span class="n">source</span> <span class="o">==</span><span class="s">&#39;agb&#39;</span><span class="p">:</span>
	      <span class="n">yields_evol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">ism_iso_yield_agb</span>
	    <span class="k">elif</span> <span class="n">source</span> <span class="o">==</span> <span class="s">&#39;sn1a&#39;</span><span class="p">:</span>
	      <span class="n">yields_evol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">ism_iso_yield_1a</span>
	    <span class="k">elif</span> <span class="n">source</span> <span class="o">==</span> <span class="s">&#39;massive&#39;</span><span class="p">:</span>
	     <span class="n">yields_evol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">ism_iso_yield_massive</span>
	     <span class="n">iso_idx</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">isotopes</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">xaxis</span><span class="p">)</span>
            <span class="n">x</span><span class="o">=</span><span class="p">[]</span>
	    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">yields_evol</span><span class="p">)):</span>
	       <span class="k">if</span> <span class="n">norm</span><span class="o">==</span><span class="s">&#39;no&#39;</span><span class="p">:</span>
	           <span class="n">x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">yields_evol</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">iso_idx</span><span class="p">]</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">yields_evol</span><span class="p">[</span><span class="n">k</span><span class="p">]))</span>
	       <span class="k">if</span> <span class="n">norm</span><span class="o">==</span><span class="s">&#39;ini&#39;</span><span class="p">:</span>
	           <span class="n">x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">yields_evol</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">iso_idx</span><span class="p">]</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">yields_evol</span><span class="p">[</span><span class="n">k</span><span class="p">])</span><span class="o">/</span><span class="n">yields_evol</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">iso_idx</span><span class="p">])</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;log-scaled X(&#39;</span><span class="o">+</span><span class="n">xaxis</span><span class="o">+</span><span class="s">&#39;)&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xscale</span><span class="p">(</span><span class="s">&#39;log&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="s">&#39;age&#39;</span> <span class="o">==</span> <span class="n">xaxis</span><span class="p">:</span>
            <span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">age</span><span class="c">#[1:]</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xscale</span><span class="p">(</span><span class="s">&#39;log&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;log-scaled Age [yrs]&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="s">&#39;Z&#39;</span> <span class="o">==</span> <span class="n">xaxis</span><span class="p">:</span>
            <span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">metallicity</span><span class="c">#[1:]</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;ISM metallicity&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xscale</span><span class="p">(</span><span class="s">&#39;log&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">xaxis</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">elements</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">source</span> <span class="o">==</span> <span class="s">&#39;all&#39;</span><span class="p">:</span>
                <span class="n">yields_evol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">ism_elem_yield</span>
            <span class="k">elif</span> <span class="n">source</span> <span class="o">==</span><span class="s">&#39;agb&#39;</span><span class="p">:</span>
                <span class="n">yields_evol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">ism_elem_yield_agb</span>
            <span class="k">elif</span> <span class="n">source</span> <span class="o">==</span> <span class="s">&#39;sn1a&#39;</span><span class="p">:</span>
                <span class="n">yields_evol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">ism_elem_yield_1a</span>
            <span class="k">elif</span> <span class="n">source</span> <span class="o">==</span> <span class="s">&#39;massive&#39;</span><span class="p">:</span>
                <span class="n">yields_evol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">ism_elem_yield_massive</span>
            <span class="n">iso_idx</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">elements</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">xaxis</span><span class="p">)</span>
            <span class="n">x</span><span class="o">=</span><span class="p">[]</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">yields_evol</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">norm</span><span class="o">==</span><span class="s">&#39;no&#39;</span><span class="p">:</span>
                    <span class="n">x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">yields_evol</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">iso_idx</span><span class="p">]</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">yields_evol</span><span class="p">[</span><span class="n">k</span><span class="p">]))</span>
                <span class="k">if</span> <span class="n">norm</span><span class="o">==</span><span class="s">&#39;ini&#39;</span><span class="p">:</span>
                    <span class="n">x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">yields_evol</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">iso_idx</span><span class="p">]</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">yields_evol</span><span class="p">[</span><span class="n">k</span><span class="p">])</span><span class="o">/</span><span class="n">yields_evol</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">iso_idx</span><span class="p">])</span>
                    <span class="k">print</span> <span class="n">yields_evol</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">iso_idx</span><span class="p">]</span>

            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;log-scaled X(&#39;</span><span class="o">+</span><span class="n">xaxis</span><span class="o">+</span><span class="s">&#39;)&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xscale</span><span class="p">(</span><span class="s">&#39;log&#39;</span><span class="p">)</span>


        <span class="c">#Input Y-axis</span>
        <span class="k">if</span> <span class="s">&#39;-&#39;</span> <span class="ow">in</span> <span class="n">yaxis</span><span class="p">:</span>
            <span class="c">#to test the different contributions</span>
            <span class="k">if</span> <span class="n">source</span> <span class="o">==</span> <span class="s">&#39;all&#39;</span><span class="p">:</span>
                <span class="n">yields_evol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">ism_iso_yield</span>
            <span class="k">elif</span> <span class="n">source</span> <span class="o">==</span><span class="s">&#39;agb&#39;</span><span class="p">:</span>
                <span class="n">yields_evol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">ism_iso_yield_agb</span>
            <span class="k">elif</span> <span class="n">source</span> <span class="o">==</span> <span class="s">&#39;sn1a&#39;</span><span class="p">:</span>
                <span class="n">yields_evol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">ism_iso_yield_1a</span>
            <span class="k">elif</span> <span class="n">source</span> <span class="o">==</span> <span class="s">&#39;massive&#39;</span><span class="p">:</span>
                <span class="n">yields_evol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">ism_iso_yield_massive</span>
            <span class="n">iso_idx</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">isotopes</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">yaxis</span><span class="p">)</span>
            <span class="n">y</span><span class="o">=</span><span class="p">[]</span>
            <span class="c">#change of xaxis array &#39;age &#39;due to continue statement below</span>
            <span class="k">if</span> <span class="n">xaxis</span><span class="o">==</span><span class="s">&#39;age&#39;</span><span class="p">:</span>
                <span class="n">x_age</span><span class="o">=</span><span class="n">x</span>
                <span class="n">x</span><span class="o">=</span><span class="p">[]</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">yields_evol</span><span class="p">)):</span>
                <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="n">yields_evol</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="n">norm</span><span class="o">==</span><span class="s">&#39;no&#39;</span><span class="p">:</span>
                    <span class="n">y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">yields_evol</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">iso_idx</span><span class="p">]</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">yields_evol</span><span class="p">[</span><span class="n">k</span><span class="p">]))</span>
                <span class="k">if</span> <span class="n">norm</span><span class="o">==</span><span class="s">&#39;ini&#39;</span><span class="p">:</span>
                    <span class="n">y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">yields_evol</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">iso_idx</span><span class="p">]</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">yields_evol</span><span class="p">[</span><span class="n">k</span><span class="p">])</span><span class="o">/</span><span class="n">yields_evol</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">iso_idx</span><span class="p">])</span>

                <span class="n">x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x_age</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;X(&#39;</span><span class="o">+</span><span class="n">yaxis</span><span class="o">+</span><span class="s">&#39;)&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">=</span><span class="n">y</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">yscale</span><span class="p">(</span><span class="s">&#39;log&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="s">&#39;Z&#39;</span> <span class="o">==</span> <span class="n">yaxis</span><span class="p">:</span>
            <span class="n">y</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">metallicity</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;ISM metallicity&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">yscale</span><span class="p">(</span><span class="s">&#39;log&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">yaxis</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">elements</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">source</span> <span class="o">==</span> <span class="s">&#39;all&#39;</span><span class="p">:</span>
                <span class="n">yields_evol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">ism_elem_yield</span>
            <span class="k">elif</span> <span class="n">source</span> <span class="o">==</span><span class="s">&#39;agb&#39;</span><span class="p">:</span>
                <span class="n">yields_evol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">ism_elem_yield_agb</span>
            <span class="k">elif</span> <span class="n">source</span> <span class="o">==</span> <span class="s">&#39;sn1a&#39;</span><span class="p">:</span>
                <span class="n">yields_evol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">ism_elem_yield_1a</span>
            <span class="k">elif</span> <span class="n">source</span> <span class="o">==</span> <span class="s">&#39;massive&#39;</span><span class="p">:</span>
                <span class="n">yields_evol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">ism_elem_yield_massive</span>
            <span class="n">iso_idx</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">elements</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">yaxis</span><span class="p">)</span>
            <span class="n">y</span><span class="o">=</span><span class="p">[]</span>
            <span class="c">#change of xaxis array &#39;age &#39;due to continue statement below</span>
            <span class="k">if</span> <span class="n">xaxis</span><span class="o">==</span><span class="s">&#39;age&#39;</span><span class="p">:</span>
                <span class="n">x_age</span><span class="o">=</span><span class="n">x</span>
                <span class="n">x</span><span class="o">=</span><span class="p">[]</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">yields_evol</span><span class="p">)):</span>
                <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="n">yields_evol</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="n">norm</span><span class="o">==</span><span class="s">&#39;no&#39;</span><span class="p">:</span>
                    <span class="n">y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">yields_evol</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">iso_idx</span><span class="p">]</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">yields_evol</span><span class="p">[</span><span class="n">k</span><span class="p">]))</span>
                <span class="k">if</span> <span class="n">norm</span><span class="o">==</span><span class="s">&#39;ini&#39;</span><span class="p">:</span>
                    <span class="n">y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">yields_evol</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">iso_idx</span><span class="p">]</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">yields_evol</span><span class="p">[</span><span class="n">k</span><span class="p">])</span><span class="o">/</span><span class="n">yields_evol</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">iso_idx</span><span class="p">])</span>

                <span class="n">x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x_age</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
            <span class="c">#plt.yscale(&#39;log&#39;)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;X(&#39;</span><span class="o">+</span><span class="n">yaxis</span><span class="o">+</span><span class="s">&#39;)&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">=</span><span class="n">y</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">yscale</span><span class="p">(</span><span class="s">&#39;log&#39;</span><span class="p">)</span>
        <span class="c">#To prevent 0 +log scale</span>
        <span class="k">if</span> <span class="s">&#39;age&#39;</span> <span class="o">==</span> <span class="n">xaxis</span><span class="p">:</span>
                <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
                <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
		<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">dt</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">tend</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span><span class="n">markevery</span><span class="o">=</span><span class="n">markevery</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__fig_standard</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span><span class="n">labelsize</span><span class="o">=</span><span class="n">labelsize</span><span class="p">,</span><span class="n">rspace</span><span class="o">=</span><span class="n">rspace</span><span class="p">,</span> <span class="n">bspace</span><span class="o">=</span><span class="n">bspace</span><span class="p">,</span><span class="n">legend_fontsize</span><span class="o">=</span><span class="n">legend_fontsize</span><span class="p">)</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">save_data</span><span class="p">(</span><span class="n">header</span><span class="o">=</span><span class="p">[</span><span class="n">xaxis</span><span class="p">,</span><span class="n">yaxis</span><span class="p">],</span><span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="omega.plot_spectro"><a class="viewcode-back" href="../omega.html#omega.omega.plot_spectro">[docs]</a>    <span class="k">def</span> <span class="nf">plot_spectro</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fig</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">xaxis</span><span class="o">=</span><span class="s">&#39;age&#39;</span><span class="p">,</span><span class="n">yaxis</span><span class="o">=</span><span class="s">&#39;[Fe/H]&#39;</span><span class="p">,</span><span class="n">source</span><span class="o">=</span><span class="s">&#39;all&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="n">shape</span><span class="o">=</span><span class="s">&#39;-&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s">&#39;o&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">,</span><span class="n">markevery</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span><span class="n">show_data</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">show_sculptor</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">show_legend</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">return_x_y</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">sub_plot</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">sub</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">plot_data</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">fsize</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mf">4.5</span><span class="p">],</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span><span class="n">rspace</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span><span class="n">bspace</span><span class="o">=</span><span class="mf">0.15</span><span class="p">,</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span><span class="n">legend_fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span><span class="n">solar_ab</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Plots elements in spectroscopic notation:</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">	xaxis : string</span>
<span class="sd">            Elements spectroscopic notation e.g. [Fe/H]</span>
<span class="sd">	    if &#39;age&#39;: time evolution in years</span>
<span class="sd">	yaxis : string</span>
<span class="sd">                Elements in spectroscopic notation, e.g. [C/Fe]</span>
<span class="sd">	source : string</span>
<span class="sd">                If yields come from</span>
<span class="sd">		all sources use &#39;all&#39; (include</span>
<span class="sd">		AGB+SN1a, massive stars.)</span>

<span class="sd">		If yields come from distinctive source:</span>
<span class="sd">		only agb stars use &#39;agb&#39;, only</span>
<span class="sd">		SN1a (&#39;SN1a&#39;), or only massive stars</span>
<span class="sd">		(&#39;massive&#39;)</span>

<span class="sd">        label : string</span>
<span class="sd">             figure label</span>
<span class="sd">        marker : string</span>
<span class="sd">             figure marker</span>
<span class="sd">        shape : string</span>
<span class="sd">             line style </span>
<span class="sd">        color : string</span>
<span class="sd">             color of line</span>
<span class="sd">        fig : string,float</span>
<span class="sd">             to name the plot figure       </span>

<span class="sd">        Examples</span>
<span class="sd">        ----------</span>
<span class="sd">	&gt;&gt;&gt; plt.plot_spectro(&#39;[Fe/H]&#39;,&#39;[C/Fe]&#39;)</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c">#Error message if there is the &quot;subplot&quot; has not been provided</span>
        <span class="k">if</span> <span class="n">sub_plot</span> <span class="ow">and</span> <span class="n">sub</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&#39;!! Error - You need to use the </span><span class="se">\&#39;</span><span class="s">sub</span><span class="se">\&#39;</span><span class="s"> parameter and provide the frame for the plot !!&#39;</span>
            <span class="k">return</span>

        <span class="c">#Operations associated with plot visual aspects</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">return_x_y</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">sub_plot</span><span class="p">:</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">label</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">label</span><span class="o">=</span><span class="n">yaxis</span>

            <span class="n">shape</span><span class="p">,</span><span class="n">marker</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__msc</span><span class="p">(</span><span class="n">source</span><span class="p">,</span><span class="n">shape</span><span class="p">,</span><span class="n">marker</span><span class="p">,</span><span class="n">color</span><span class="p">)</span>

        <span class="c">#Set the figure output</span>
        <span class="k">if</span> <span class="n">sub_plot</span><span class="p">:</span>
            <span class="n">plt_ps</span> <span class="o">=</span> <span class="n">sub</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt_ps</span> <span class="o">=</span> <span class="n">plt</span>


        <span class="c">#Access solar abundance</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">solar_ab</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">iniabu</span><span class="o">=</span><span class="n">ry</span><span class="o">.</span><span class="n">iniabu</span><span class="p">(</span><span class="n">global_path</span><span class="o">+</span><span class="n">solar_ab</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">iniabu</span><span class="o">=</span><span class="n">ry</span><span class="o">.</span><span class="n">iniabu</span><span class="p">(</span><span class="n">global_path</span><span class="o">+</span><span class="s">&#39;yield_tables/iniabu/iniab2.0E-02GN93.ppn&#39;</span><span class="p">)</span>

        <span class="n">x_ini_iso</span><span class="o">=</span><span class="n">iniabu</span><span class="o">.</span><span class="n">iso_abundance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">isotopes</span><span class="p">)</span>
        <span class="n">elements</span><span class="p">,</span><span class="n">x_ini</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_iso_abu_to_elem</span><span class="p">(</span><span class="n">x_ini_iso</span><span class="p">)</span>
        <span class="c">#to test the different contributions</span>
        <span class="k">if</span> <span class="n">source</span> <span class="o">==</span> <span class="s">&#39;all&#39;</span><span class="p">:</span>
            <span class="n">yields_evol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">ism_elem_yield</span>
        <span class="k">elif</span> <span class="n">source</span> <span class="o">==</span><span class="s">&#39;agb&#39;</span><span class="p">:</span>
            <span class="n">yields_evol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">ism_elem_yield_agb</span>
        <span class="k">elif</span> <span class="n">source</span> <span class="o">==</span> <span class="s">&#39;sn1a&#39;</span><span class="p">:</span>
            <span class="n">yields_evol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">ism_elem_yield_1a</span>
        <span class="k">elif</span> <span class="n">source</span> <span class="o">==</span> <span class="s">&#39;massive&#39;</span><span class="p">:</span>
            <span class="n">yields_evol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">ism_elem_yield_massive</span>

        <span class="c">#Operations associated with plot visual aspects</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">return_x_y</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">sub_plot</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">fsize</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">fsize</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>


        <span class="k">if</span> <span class="s">&#39;age&#39;</span> <span class="o">==</span> <span class="n">xaxis</span><span class="p">:</span>
            <span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">age</span>

            <span class="c">#Operations associated with plot visual aspects</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">return_x_y</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">sub_plot</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">xscale</span><span class="p">(</span><span class="s">&#39;log&#39;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;Log-scaled age [yrs]&#39;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">=</span><span class="n">x</span>
        <span class="k">else</span><span class="p">:</span>


            <span class="n">xaxis_elem1</span><span class="o">=</span><span class="n">xaxis</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span>
            <span class="n">xaxis_elem2</span><span class="o">=</span><span class="n">xaxis</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

            <span class="c">#print xaxis_elem1, xaxis_elem2</span>

            <span class="c">#X-axis ini values</span>
            <span class="n">x_elem1_ini</span><span class="o">=</span><span class="n">x_ini</span><span class="p">[</span><span class="n">elements</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">xaxis_elem1</span><span class="p">)]</span>
            <span class="n">x_elem2_ini</span><span class="o">=</span><span class="n">x_ini</span><span class="p">[</span><span class="n">elements</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">xaxis_elem2</span><span class="p">)]</span>

            <span class="c">#X-axis gce values</span>
            <span class="n">elem_idx1</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">elements</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">xaxis_elem1</span><span class="p">)</span>
            <span class="n">elem_idx2</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">elements</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">xaxis_elem2</span><span class="p">)</span>

            <span class="n">x</span><span class="o">=</span><span class="p">[]</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">yields_evol</span><span class="p">)):</span>
                <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="n">yields_evol</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="c">#in case no contribution during timestep</span>
                <span class="n">x1</span><span class="o">=</span><span class="n">yields_evol</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">elem_idx1</span><span class="p">]</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">yields_evol</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                <span class="n">x2</span><span class="o">=</span><span class="n">yields_evol</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">elem_idx2</span><span class="p">]</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">yields_evol</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">x1</span> <span class="o">&lt;=</span> <span class="mf">0.0</span> <span class="ow">or</span> <span class="n">x2</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">:</span>
                    <span class="n">spec</span> <span class="o">=</span> <span class="o">-</span><span class="mf">30.0</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">spec</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">x1</span><span class="o">/</span><span class="n">x2</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">x_elem1_ini</span><span class="o">/</span><span class="n">x_elem2_ini</span><span class="p">)</span>
                <span class="n">x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>
            <span class="c">#Operations associated with plot visual aspects</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">return_x_y</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">sub_plot</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">xaxis</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">=</span><span class="n">x</span>



        <span class="n">yaxis_elem1</span><span class="o">=</span><span class="n">yaxis</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span>
        <span class="n">yaxis_elem2</span><span class="o">=</span><span class="n">yaxis</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="c">#y=axis ini values</span>
        <span class="n">x_elem1_ini</span><span class="o">=</span><span class="n">x_ini</span><span class="p">[</span><span class="n">elements</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">yaxis_elem1</span><span class="p">)]</span>
        <span class="n">x_elem2_ini</span><span class="o">=</span><span class="n">x_ini</span><span class="p">[</span><span class="n">elements</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">yaxis_elem2</span><span class="p">)]</span>

        <span class="c">#Y-axis gce values</span>
        <span class="n">elem_idx1</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">elements</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">yaxis_elem1</span><span class="p">)</span>
        <span class="n">elem_idx2</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">elements</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">yaxis_elem2</span><span class="p">)</span>

        <span class="n">y</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">if</span> <span class="n">xaxis</span><span class="o">==</span><span class="s">&#39;age&#39;</span><span class="p">:</span>
            <span class="n">x_age</span><span class="o">=</span><span class="n">x</span>
            <span class="n">x</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">yields_evol</span><span class="p">)):</span>
            <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="n">yields_evol</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="c">#in case no contribution during timestep</span>
            <span class="n">x1</span><span class="o">=</span><span class="n">yields_evol</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">elem_idx1</span><span class="p">]</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">yields_evol</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
            <span class="n">x2</span><span class="o">=</span><span class="n">yields_evol</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">elem_idx2</span><span class="p">]</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">yields_evol</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">x1</span> <span class="o">&lt;=</span> <span class="mf">0.0</span> <span class="ow">or</span> <span class="n">x2</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="n">spec</span> <span class="o">=</span> <span class="o">-</span><span class="mf">30.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">spec</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">x1</span><span class="o">/</span><span class="n">x2</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">x_elem1_ini</span><span class="o">/</span><span class="n">x_elem2_ini</span><span class="p">)</span>
            <span class="n">y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">xaxis</span><span class="o">==</span><span class="s">&#39;age&#39;</span><span class="p">:</span>
                <span class="n">x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x_age</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&#39;Y values all zero&#39;</span>
        <span class="c">#Operations associated with plot visual aspects</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">return_x_y</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">sub_plot</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">yaxis</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">=</span><span class="n">y</span>
	<span class="c">#To prevent 0 +log scale</span>
	<span class="k">if</span> <span class="s">&#39;age&#39;</span> <span class="o">==</span> <span class="n">xaxis</span><span class="p">:</span>
		<span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
		<span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
                <span class="c">#Operations associated with plot visual aspects</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">return_x_y</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">sub_plot</span><span class="p">:</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">dt</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">tend</span><span class="p">)</span>

        <span class="c">#Remove values when SFR is zero, that is when no element is locked into stars</span>
        <span class="n">i_rem</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">sfr_abs</span><span class="p">[</span><span class="n">i_rem</span><span class="p">]</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">del</span> <span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">i_rem</span> <span class="o">-=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">plot_data</span><span class="p">:</span>

          <span class="c"># Filtrate bad value</span>
          <span class="n">x_temp</span> <span class="o">=</span> <span class="p">[]</span>
          <span class="n">y_temp</span> <span class="o">=</span> <span class="p">[]</span>
          <span class="k">for</span> <span class="n">i_temp</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)):</span>
              <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i_temp</span><span class="p">])</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">i_temp</span><span class="p">])</span>\
                 <span class="ow">and</span> <span class="n">x</span><span class="p">[</span><span class="n">i_temp</span><span class="p">]</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mf">20.0</span> <span class="ow">and</span> <span class="n">y</span><span class="p">[</span><span class="n">i_temp</span><span class="p">]</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mf">20.0</span><span class="p">:</span>
                  <span class="n">x_temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i_temp</span><span class="p">])</span>
                  <span class="n">y_temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">i_temp</span><span class="p">])</span>
          <span class="n">x</span> <span class="o">=</span> <span class="n">x_temp</span>
          <span class="n">y</span> <span class="o">=</span> <span class="n">y_temp</span>

          <span class="c">#If this function is supposed to return the x, y arrays only ...</span>
          <span class="k">if</span> <span class="n">return_x_y</span><span class="p">:</span>

            <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>

          <span class="c">#If this is a sub-figure managed by an external module</span>
          <span class="k">elif</span> <span class="n">sub_plot</span><span class="p">:</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">galaxy</span> <span class="o">==</span> <span class="s">&#39;none&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">show_legend</span><span class="p">:</span>
                    <span class="n">sub</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span><span class="n">markevery</span><span class="o">=</span><span class="n">markevery</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="n">linewidth</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">sub</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span><span class="n">markevery</span><span class="o">=</span><span class="n">markevery</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="n">linewidth</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">show_legend</span><span class="p">:</span>
                    <span class="n">sub</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span><span class="n">markevery</span><span class="o">=</span><span class="n">markevery</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="n">linewidth</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">sub</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span><span class="n">markevery</span><span class="o">=</span><span class="n">markevery</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="n">linewidth</span><span class="p">)</span> 

          <span class="c">#If this function is supposed to plot ...</span>
          <span class="k">else</span><span class="p">:</span>

            <span class="c">#Plot a thicker line for specific galaxies, since they must be visible with all the obs. data</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">galaxy</span> <span class="o">==</span> <span class="s">&#39;none&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">show_legend</span><span class="p">:</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span><span class="n">markevery</span><span class="o">=</span><span class="n">markevery</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="n">linewidth</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span><span class="n">markevery</span><span class="o">=</span><span class="n">markevery</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="n">linewidth</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">show_legend</span><span class="p">:</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span><span class="n">markevery</span><span class="o">=</span><span class="n">markevery</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="n">linewidth</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span><span class="n">markevery</span><span class="o">=</span><span class="n">markevery</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="n">linewidth</span><span class="p">)</span>

            <span class="c">#plt.plot([1.93,2.123123,3.23421321321],[4.123123132,5.214124142,6.11111],linestyle=&#39;--&#39;)</span>
            <span class="c">#plt.plot([1.93,2.123123,3.23421321321],[4.123123132,5.214124142,6.11111],linestyle=&#39;--&#39;)</span>
	    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">label</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
	            <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
            <span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__fig_standard</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span><span class="n">labelsize</span><span class="o">=</span><span class="n">labelsize</span><span class="p">,</span><span class="n">rspace</span><span class="o">=</span><span class="n">rspace</span><span class="p">,</span> <span class="n">bspace</span><span class="o">=</span><span class="n">bspace</span><span class="p">,</span><span class="n">legend_fontsize</span><span class="o">=</span><span class="n">legend_fontsize</span><span class="p">)</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">save_data</span><span class="p">(</span><span class="n">header</span><span class="o">=</span><span class="p">[</span><span class="n">xaxis</span><span class="p">,</span><span class="n">yaxis</span><span class="p">],</span><span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">])</span>

</div>
<div class="viewcode-block" id="omega.plot_totmasses"><a class="viewcode-back" href="../omega.html#omega.omega.plot_totmasses">[docs]</a>    <span class="k">def</span> <span class="nf">plot_totmasses</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fig</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">mass</span><span class="o">=</span><span class="s">&#39;gas&#39;</span><span class="p">,</span><span class="n">source</span><span class="o">=</span><span class="s">&#39;all&#39;</span><span class="p">,</span><span class="n">norm</span><span class="o">=</span><span class="s">&#39;no&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="n">shape</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="n">markevery</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">log</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">fsize</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mf">4.5</span><span class="p">],</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span><span class="n">rspace</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span><span class="n">bspace</span><span class="o">=</span><span class="mf">0.15</span><span class="p">,</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span><span class="n">legend_fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">	Plots either gas or star mass in fraction of total mass</span>
<span class="sd">	vs time.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        mass : string</span>
<span class="sd">            either &#39;gas&#39; for ISM gas mass</span>
<span class="sd">            or &#39;stars&#39; for gas locked away in stars (totalgas - ISM gas)</span>

<span class="sd">        norm : string</span>
<span class="sd">            normalization, either &#39;no&#39; for no normalization (total gass mass in solar masses),</span>

<span class="sd">	    for normalization to the initial gas mass (mgal) with &#39;ini&#39;,</span>

<span class="sd">	    for normalization to the current total gas mass &#39;current&#39;.</span>
<span class="sd">	    The latter case makes sense when comparing different</span>
<span class="sd">	    sources (see below)</span>

<span class="sd">        source : string</span>
<span class="sd">            specificies if yields come from</span>
<span class="sd">	    all sources (&#39;all&#39;), including</span>
<span class="sd">	    AGB+SN1a, massive stars. Or from</span>
<span class="sd">	    distinctive sources:</span>
<span class="sd">	    only agb stars (&#39;agb&#39;), only</span>
<span class="sd">	    SN1a (&#39;sn1a&#39;), or only massive stars</span>
<span class="sd">	    (&#39;massive&#39;)</span>
<span class="sd">	log : boolean</span>
<span class="sd">            if true plot logarithmic y axis</span>
<span class="sd">        label : string</span>
<span class="sd">             figure label</span>
<span class="sd">        marker : string</span>
<span class="sd">             figure marker</span>
<span class="sd">        shape : string</span>
<span class="sd">             line style </span>
<span class="sd">        color : string</span>
<span class="sd">             color of line</span>
<span class="sd">        fig : string,float</span>
<span class="sd">             to name the plot figure       </span>

<span class="sd">        Examples</span>
<span class="sd">        ----------</span>
<span class="sd">        &gt;&gt;&gt; s.plot_totmasses()</span>


<span class="sd">        &#39;&#39;&#39;</span>

        <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>

        <span class="c">#if len(label)&lt;1:</span>
        <span class="c">#        label=mass+&#39;, &#39;+source</span>


        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">fsize</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">fsize</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

        <span class="c">#Assume isotope input</span>

	<span class="n">xaxis</span><span class="o">=</span><span class="s">&#39;age&#39;</span>
	<span class="k">if</span> <span class="n">source</span> <span class="o">==</span><span class="s">&#39;all&#39;</span><span class="p">:</span>
		<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">label</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
			<span class="n">label</span><span class="o">=</span><span class="s">&#39;All&#39;</span>
	<span class="k">if</span> <span class="n">source</span> <span class="o">==</span> <span class="s">&#39;agb&#39;</span><span class="p">:</span>
		<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">label</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
			<span class="n">label</span><span class="o">=</span><span class="s">&#39;AGB&#39;</span>
	<span class="k">if</span> <span class="n">source</span> <span class="o">==</span><span class="s">&#39;massive&#39;</span><span class="p">:</span>
		<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">label</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
			<span class="n">label</span><span class="o">=</span><span class="s">&#39;Massive&#39;</span>
	<span class="k">if</span> <span class="n">source</span> <span class="o">==</span><span class="s">&#39;sn1a&#39;</span><span class="p">:</span>
		<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">label</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
			<span class="n">label</span><span class="o">=</span><span class="s">&#39;SNIa&#39;</span>
	
	<span class="n">shape</span><span class="p">,</span><span class="n">marker</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__msc</span><span class="p">(</span><span class="n">source</span><span class="p">,</span><span class="n">shape</span><span class="p">,</span><span class="n">marker</span><span class="p">,</span><span class="n">color</span><span class="p">)</span>

	<span class="k">if</span> <span class="s">&#39;age&#39;</span> <span class="o">==</span> <span class="n">xaxis</span><span class="p">:</span>
	    <span class="n">x_all</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">age</span><span class="c">#[1:]</span>
	    <span class="n">plt</span><span class="o">.</span><span class="n">xscale</span><span class="p">(</span><span class="s">&#39;log&#39;</span><span class="p">)</span>
	    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;log-scaled &#39;</span><span class="o">+</span><span class="n">xaxis</span><span class="o">+</span><span class="s">&#39; [yrs]&#39;</span><span class="p">)</span>
	    <span class="c">#self.x=x</span>

	<span class="n">gas_mass</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">gas_mass</span>

	<span class="c">#to test the different contributions</span>
	<span class="k">if</span> <span class="n">source</span> <span class="o">==</span> <span class="s">&#39;all&#39;</span><span class="p">:</span>
            <span class="n">gas_evol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">gas_mass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">source</span> <span class="o">==</span><span class="s">&#39;agb&#39;</span><span class="p">:</span>
	        <span class="n">yields_evol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">ism_elem_yield_agb</span>
            <span class="k">elif</span> <span class="n">source</span> <span class="o">==</span> <span class="s">&#39;sn1a&#39;</span><span class="p">:</span>
	        <span class="n">yields_evol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">ism_elem_yield_1a</span>
            <span class="k">elif</span> <span class="n">source</span> <span class="o">==</span> <span class="s">&#39;massive&#39;</span><span class="p">:</span>
	        <span class="n">yields_evol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">ism_elem_yield_massive</span>
            <span class="n">gas_evol</span><span class="o">=</span><span class="p">[]</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">yields_evol</span><span class="p">)):</span>
	        <span class="n">gas_evol</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">yields_evol</span><span class="p">[</span><span class="n">k</span><span class="p">]))</span>

	<span class="n">ism_gasm</span><span class="o">=</span><span class="p">[]</span>
	<span class="n">star_m</span><span class="o">=</span><span class="p">[]</span>
	<span class="n">x</span><span class="o">=</span><span class="p">[]</span>
        <span class="c">#To prevent 0 +log scale</span>
        <span class="k">if</span> <span class="s">&#39;age&#39;</span> <span class="o">==</span> <span class="n">xaxis</span><span class="p">:</span>
                <span class="n">x_all</span><span class="o">=</span><span class="n">x_all</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
                <span class="n">gas_evol</span><span class="o">=</span><span class="n">gas_evol</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
		<span class="n">gas_mass</span><span class="o">=</span><span class="n">gas_mass</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
	<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">gas_evol</span><span class="p">)):</span>
	    <span class="k">if</span> <span class="p">(</span><span class="n">gas_evol</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">gas_mass</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">):</span>
		<span class="k">continue</span>
	    <span class="n">x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x_all</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">norm</span><span class="o">==</span><span class="s">&#39;ini&#39;</span><span class="p">:</span>
	        <span class="n">ism_gasm</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gas_evol</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">mgal</span><span class="p">)</span>
	        <span class="n">star_m</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">mgal</span><span class="o">-</span><span class="n">gas_evol</span><span class="p">[</span><span class="n">k</span><span class="p">])</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">mgal</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">norm</span> <span class="o">==</span> <span class="s">&#39;current&#39;</span><span class="p">:</span>
	        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">gas_mass</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span><span class="mf">0.</span><span class="p">:</span>
	              <span class="n">ism_gasm</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gas_evol</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">/</span><span class="n">gas_mass</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
	              <span class="n">star_m</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">mgal</span><span class="o">-</span><span class="n">gas_evol</span><span class="p">[</span><span class="n">k</span><span class="p">])</span><span class="o">/</span><span class="n">gas_mass</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
	    <span class="c">#else:</span>
	     <span class="c">#   ism_gasm.append(0.)</span>
	      <span class="c">#  star_m.append(0.)</span>
            <span class="k">elif</span> <span class="n">norm</span> <span class="o">==</span> <span class="s">&#39;no&#39;</span><span class="p">:</span>
	        <span class="n">ism_gasm</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gas_evol</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
	        <span class="n">star_m</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">mgal</span><span class="o">-</span><span class="n">gas_evol</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">mass</span> <span class="o">==</span> <span class="s">&#39;gas&#39;</span><span class="p">:</span>
	    <span class="n">y</span><span class="o">=</span><span class="n">ism_gasm</span>
        <span class="k">if</span> <span class="n">mass</span> <span class="o">==</span> <span class="s">&#39;stars&#39;</span><span class="p">:</span>
	    <span class="n">y</span><span class="o">=</span><span class="n">star_m</span>
	<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">,</span><span class="n">markevery</span><span class="o">=</span><span class="n">markevery</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>	
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">label</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
		<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">norm</span><span class="o">==</span><span class="s">&#39;current&#39;</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">1.2</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">norm</span><span class="o">==</span><span class="s">&#39;no&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">mass</span><span class="o">==</span><span class="s">&#39;gas&#39;</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;mass fraction&#39;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&#39;Gas mass as a fraction of total gas mass&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;mass fraction&#39;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&#39;Star mass as a fraction of total star mass&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">mass</span><span class="o">==</span><span class="s">&#39;gas&#39;</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;ISM gas mass [Msun]&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;mass locked in stars [Msun]&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">mass</span><span class="o">==</span><span class="s">&#39;gas&#39;</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;ISM gas mass [Msun]&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;Mass locked in stars [Msun]&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">log</span><span class="o">==</span><span class="bp">True</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">yscale</span><span class="p">(</span><span class="s">&#39;log&#39;</span><span class="p">)</span>
	    <span class="k">if</span> <span class="ow">not</span> <span class="n">norm</span><span class="o">==</span><span class="s">&#39;no&#39;</span><span class="p">:</span>
            	<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mf">1e-4</span><span class="p">,</span><span class="mf">1.2</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__fig_standard</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span><span class="n">labelsize</span><span class="o">=</span><span class="n">labelsize</span><span class="p">,</span><span class="n">rspace</span><span class="o">=</span><span class="n">rspace</span><span class="p">,</span> <span class="n">bspace</span><span class="o">=</span><span class="n">bspace</span><span class="p">,</span><span class="n">legend_fontsize</span><span class="o">=</span><span class="n">legend_fontsize</span><span class="p">)</span>
	<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">dt</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">tend</span><span class="p">)</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">save_data</span><span class="p">(</span><span class="n">header</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;age&#39;</span><span class="p">,</span><span class="s">&#39;mass&#39;</span><span class="p">],</span><span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">])</span>

</div>
<div class="viewcode-block" id="omega.plot_sn_distr"><a class="viewcode-back" href="../omega.html#omega.omega.plot_sn_distr">[docs]</a>    <span class="k">def</span> <span class="nf">plot_sn_distr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fig</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">rate</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">rate_only</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="n">xaxis</span><span class="o">=</span><span class="s">&#39;time&#39;</span><span class="p">,</span><span class="n">fraction</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">label1</span><span class="o">=</span><span class="s">&#39;SNIa&#39;</span><span class="p">,</span><span class="n">label2</span><span class="o">=</span><span class="s">&#39;SN2&#39;</span><span class="p">,</span><span class="n">shape1</span><span class="o">=</span><span class="s">&#39;:&#39;</span><span class="p">,</span><span class="n">shape2</span><span class="o">=</span><span class="s">&#39;--&#39;</span><span class="p">,</span><span class="n">marker1</span><span class="o">=</span><span class="s">&#39;o&#39;</span><span class="p">,</span><span class="n">marker2</span><span class="o">=</span><span class="s">&#39;s&#39;</span><span class="p">,</span><span class="n">color1</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">,</span><span class="n">color2</span><span class="o">=</span><span class="s">&#39;b&#39;</span><span class="p">,</span><span class="n">markevery</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">fsize</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mf">4.5</span><span class="p">],</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span><span class="n">rspace</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span><span class="n">bspace</span><span class="o">=</span><span class="mf">0.15</span><span class="p">,</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span><span class="n">legend_fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">	Plots the SN1a distribution:</span>
<span class="sd">	The evolution of the number of SN1a and SN2</span>
<span class="sd">	#Add numbers/dt numbers/year...</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">	rate : boolean</span>
<span class="sd">            if true, calculate rate [1/century] </span>
<span class="sd">            else calculate numbers</span>
<span class="sd">	fraction ; boolean</span>
<span class="sd">	    if true, ignorate rate and calculate number fraction of SNIa per WD</span>
<span class="sd">        rate_only : string</span>
<span class="sd">	    if empty string, plot both rates (default)</span>

<span class="sd">            if &#39;sn1a&#39;, plot only SN1a rate</span>

<span class="sd">            if &#39;sn2&#39;, plot only SN2 rate</span>
<span class="sd">	xaxis: string</span>
<span class="sd">	    if &#39;time&#39; : time evolution</span>
<span class="sd">	    if &#39;redshift&#39;: experimental! use with caution; redshift evolution</span>
<span class="sd">        label : string</span>
<span class="sd">             figure label</span>
<span class="sd">        marker : string</span>
<span class="sd">             figure marker</span>
<span class="sd">        shape : string</span>
<span class="sd">             line style </span>
<span class="sd">        color : string</span>
<span class="sd">             color of line</span>
<span class="sd">        fig : string,float</span>
<span class="sd">             to name the plot figure       </span>

<span class="sd">        Examples</span>
<span class="sd">        ----------</span>
<span class="sd">        &gt;&gt;&gt; s.plot_sn_distr()</span>
<span class="sd">        &#39;&#39;&#39;</span>
	<span class="c">#For Wiersma09</span>
	<span class="n">Hubble_0</span><span class="o">=</span><span class="mf">73.</span>
	<span class="n">Omega_lambda</span><span class="o">=</span><span class="mf">0.762</span>
	<span class="n">Omega_m</span><span class="o">=</span><span class="mf">0.238</span>

        <span class="n">figure</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">fsize</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">fsize</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">age</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">age</span>
        <span class="n">sn1anumbers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">sn1a_numbers</span><span class="c">#[:-1]</span>
        <span class="n">sn2numbers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">sn2_numbers</span>
	<span class="k">if</span> <span class="n">xaxis</span><span class="o">==</span><span class="s">&#39;redshift&#39;</span><span class="p">:</span>
		<span class="k">print</span> <span class="s">&#39;this features is not tested yet.&#39;</span>
		<span class="k">return</span> <span class="mi">0</span>
		<span class="n">age</span><span class="p">,</span><span class="n">idx</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__time_to_z</span><span class="p">(</span><span class="n">age</span><span class="p">,</span><span class="n">Hubble_0</span><span class="p">,</span><span class="n">Omega_lambda</span><span class="p">,</span><span class="n">Omega_m</span><span class="p">)</span>
		<span class="n">age</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">age</span>
		<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;Redshift z&#39;</span><span class="p">)</span>
		<span class="n">timesteps</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">timesteps</span><span class="p">[</span><span class="n">idx</span><span class="o">-</span><span class="mi">1</span><span class="p">:]</span>
		<span class="n">sn2numbers</span><span class="o">=</span><span class="n">sn2numbers</span><span class="p">[</span><span class="n">idx</span><span class="p">:]</span>
		<span class="n">sn1anumbers</span><span class="o">=</span><span class="n">sn1anumbers</span><span class="p">[</span><span class="n">idx</span><span class="p">:]</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;Log-scaled age [yrs]&#39;</span><span class="p">)</span>
		<span class="n">plt</span><span class="o">.</span><span class="n">xscale</span><span class="p">(</span><span class="s">&#39;log&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">rate</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">fraction</span><span class="p">:</span>
	    <span class="k">if</span> <span class="n">xaxis</span><span class="o">==</span><span class="s">&#39;redshift&#39;</span><span class="p">:</span>
			<span class="n">sn1a_rate</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sn1anumbers</span><span class="p">)</span><span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">timesteps</span><span class="p">)</span><span class="o">/</span><span class="mf">100.</span><span class="p">)</span>
			<span class="n">sn2_rate</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sn2numbers</span><span class="p">)</span><span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">timesteps</span><span class="p">)</span><span class="o">/</span><span class="mf">100.</span><span class="p">)</span>	
	    <span class="k">else</span><span class="p">:</span>
            		<span class="n">sn1a_rate</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sn1anumbers</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span><span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">timesteps</span><span class="p">)</span><span class="o">/</span><span class="mf">100.</span><span class="p">)</span>
            		<span class="n">sn2_rate</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sn2numbers</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span><span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">timesteps</span><span class="p">)</span><span class="o">/</span><span class="mf">100.</span><span class="p">)</span>
	    <span class="n">sn1a_rate1</span><span class="o">=</span><span class="p">[]</span>
	    <span class="n">sn2_rate1</span><span class="o">=</span><span class="p">[]</span>
	    <span class="n">age</span><span class="o">=</span><span class="n">age</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
	    <span class="n">age_sn1a</span><span class="o">=</span><span class="p">[]</span> <span class="c">#age[1:]</span>
	    <span class="n">age_sn2</span><span class="o">=</span><span class="p">[]</span>
	    <span class="c">#correct sn1a rate</span>
	    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sn1a_rate</span><span class="p">)):</span>
		<span class="k">if</span> <span class="n">sn1a_rate</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
			<span class="n">sn1a_rate1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sn1a_rate</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
			<span class="n">age_sn1a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">age</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
			
	    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sn2_rate</span><span class="p">)):</span>
		<span class="k">if</span> <span class="n">sn2_rate</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
			<span class="n">sn2_rate1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sn2_rate</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
			<span class="n">age_sn2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">age</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
	

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rate_only</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
		    <span class="n">x</span><span class="o">=</span><span class="p">[</span><span class="n">age_sn2</span><span class="p">,</span><span class="n">age_sn1a</span><span class="p">]</span>
		    <span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="n">sn1a_rate1</span><span class="p">,</span><span class="n">sn2_rate1</span><span class="p">]</span>
		    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">age_sn1a</span><span class="p">,</span><span class="n">sn1a_rate1</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="n">shape1</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">color1</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">label1</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="n">marker1</span><span class="p">,</span><span class="n">markevery</span><span class="o">=</span><span class="n">markevery</span><span class="p">)</span>
		    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">age_sn2</span><span class="p">,</span><span class="n">sn2_rate1</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="n">shape2</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">color2</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">label2</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="n">marker2</span><span class="p">,</span><span class="n">markevery</span><span class="o">=</span><span class="n">markevery</span><span class="p">)</span>
            	    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;SN rate [century$^{-1}$]&#39;</span><span class="p">)</span>
	    <span class="k">if</span> <span class="n">rate_only</span><span class="o">==</span><span class="s">&#39;sn1a&#39;</span><span class="p">:</span>
		    <span class="n">x</span><span class="o">=</span><span class="n">age_sn1a</span>
		    <span class="n">y</span><span class="o">=</span> <span class="n">sn1a_rate1</span>
		    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">age_sn1a</span><span class="p">,</span><span class="n">sn1a_rate1</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="n">shape1</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">color1</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">label1</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="n">marker1</span><span class="p">,</span><span class="n">markevery</span><span class="o">=</span><span class="n">markevery</span><span class="p">)</span>
		    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;SNIa rate [century$^{-1}$]&#39;</span><span class="p">)</span>
	    <span class="k">if</span> <span class="n">rate_only</span><span class="o">==</span><span class="s">&#39;sn2&#39;</span><span class="p">:</span>
		    <span class="n">x</span><span class="o">=</span><span class="n">age_sn2</span>
		    <span class="n">y</span><span class="o">=</span><span class="n">sn2_rate</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">age_sn2</span><span class="p">,</span><span class="n">sn2_rate1</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="n">shape2</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">color2</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">label2</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="n">marker2</span><span class="p">,</span><span class="n">markevery</span><span class="o">=</span><span class="n">markevery</span><span class="p">)</span>
		    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;SN2 rate [century$^{-1}$]&#39;</span><span class="p">)</span>


        <span class="k">else</span><span class="p">:</span>
            <span class="c">#if xaxis==&#39;redshift&#39;:</span>
		
                        <span class="c">#sn1_numbers=np.array(sn1anumbers)/ (np.array(timesteps)/100.)</span>
                        <span class="c">#sn2_numbers=np.array(sn2numbers)/ (np.array(timesteps)/100.)</span>
            <span class="c">#True: #else:</span>
                        <span class="c">#sn1a_rate=np.array(sn1anumbers[1:])/ (np.array(self.history.timesteps)/100.)</span>
                        <span class="c">#sn2_rate=np.array(sn2numbers[1:])/ (np.array(self.history.timesteps)/100.)</span>

	    <span class="n">sn1a_numbers</span><span class="o">=</span><span class="n">sn1anumbers</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
	    <span class="n">sn2_numbers</span><span class="o">=</span><span class="n">sn2numbers</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>	
            <span class="n">sn1a_numbers1</span><span class="o">=</span><span class="p">[]</span>
	    <span class="n">sn2_numbers1</span><span class="o">=</span><span class="p">[]</span>
            <span class="n">age_sn1a</span><span class="o">=</span><span class="p">[]</span>
	    <span class="n">age_sn2</span><span class="o">=</span><span class="p">[]</span>
            <span class="n">age</span><span class="o">=</span><span class="n">age</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sn1a_numbers</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">sn1a_numbers</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                        <span class="n">sn1a_numbers1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sn1a_numbers</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                        <span class="n">age_sn1a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">age</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
	    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sn2_numbers</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">sn2_numbers</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                        <span class="n">sn2_numbers1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sn2_numbers</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                        <span class="n">age_sn2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">age</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>

	    <span class="k">if</span> <span class="n">fraction</span><span class="p">:</span>
		<span class="n">age</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">age</span>
		<span class="n">ratio</span><span class="o">=</span><span class="p">[]</span>
		<span class="n">age1</span><span class="o">=</span><span class="p">[]</span>
		<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wd_sn1a_range1</span><span class="p">)):</span>
		    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">wd_sn1a_range1</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
			<span class="n">ratio</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">sn1a_numbers</span><span class="p">[</span><span class="mi">1</span><span class="p">:][</span><span class="n">k</span><span class="p">]</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">wd_sn1a_range1</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
			<span class="n">age1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">age</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
		<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">age1</span><span class="p">,</span><span class="n">ratio</span><span class="p">)</span>
		<span class="n">plt</span><span class="o">.</span><span class="n">yscale</span><span class="p">(</span><span class="s">&#39;log&#39;</span><span class="p">)</span>
		<span class="n">plt</span><span class="o">.</span><span class="n">xscale</span><span class="p">(</span><span class="s">&#39;log&#39;</span><span class="p">)</span>
		<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;Number of SNIa going off per WD born&#39;</span><span class="p">)</span>
		<span class="n">label</span><span class="o">=</span><span class="s">&#39;SNIafractionperWD&#39;</span><span class="p">;</span><span class="n">label</span><span class="o">=</span><span class="s">&#39;sn1a &#39;</span><span class="o">+</span><span class="n">label</span>
		<span class="n">x</span><span class="o">=</span><span class="n">age1</span>
		<span class="n">y</span><span class="o">=</span><span class="n">ratio</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">save_data</span><span class="p">(</span><span class="n">header</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;age&#39;</span><span class="p">,</span><span class="n">label</span><span class="p">],</span><span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">])</span>		
		<span class="k">return</span> 
	    <span class="k">else</span><span class="p">:</span>
		    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rate_only</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
			    <span class="n">x</span><span class="o">=</span><span class="p">[</span><span class="n">age_sn1a</span><span class="p">,</span><span class="n">age_sn2</span><span class="p">]</span>
			    <span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="n">sn1a_numbers</span><span class="p">,</span><span class="n">sn2_numbers</span><span class="p">]</span>
			    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">age_sn1a</span><span class="p">,</span><span class="n">sn1a_numbers1</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="n">shape1</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">color1</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">label1</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="n">marker1</span><span class="p">,</span><span class="n">markevery</span><span class="o">=</span><span class="n">markevery</span><span class="p">)</span>
			    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">age_sn2</span><span class="p">,</span><span class="n">sn2_numbers1</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="n">shape2</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">color2</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">label2</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="n">marker2</span><span class="p">,</span><span class="n">markevery</span><span class="o">=</span><span class="n">markevery</span><span class="p">)</span>
			    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;SN numbers&#39;</span><span class="p">)</span>
		    <span class="k">if</span> <span class="n">rate_only</span><span class="o">==</span><span class="s">&#39;sn1a&#39;</span><span class="p">:</span>
			    <span class="n">x</span><span class="o">=</span> <span class="n">age1</span>
			    <span class="n">y</span><span class="o">=</span> <span class="n">sn1anumbers1</span>
			    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">age_sn1a</span><span class="p">,</span><span class="n">sn1a_numbers1</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="n">shape1</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">color1</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">label1</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="n">marker1</span><span class="p">,</span><span class="n">markevery</span><span class="o">=</span><span class="n">markever</span><span class="p">)</span>
			    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;SN numbers&#39;</span><span class="p">)</span>
		    <span class="k">if</span> <span class="n">rate_only</span><span class="o">==</span><span class="s">&#39;sn2&#39;</span><span class="p">:</span>
			    <span class="n">x</span><span class="o">=</span> <span class="n">age</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
			    <span class="n">y</span><span class="o">=</span> <span class="n">sn2numbers</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
			    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">age_sn2</span><span class="p">,</span><span class="n">sn2_numbers1</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="n">shape2</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">color2</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">label2</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="n">marker2</span><span class="p">,</span><span class="n">markevery</span><span class="o">=</span><span class="n">markevery</span><span class="p">)</span>
			    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;SN numbers&#39;</span><span class="p">)</span>

	<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
	<span class="n">plt</span><span class="o">.</span><span class="n">yscale</span><span class="p">(</span><span class="s">&#39;log&#39;</span><span class="p">)</span>
	<span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__fig_standard</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span><span class="n">labelsize</span><span class="o">=</span><span class="n">labelsize</span><span class="p">,</span><span class="n">rspace</span><span class="o">=</span><span class="n">rspace</span><span class="p">,</span> <span class="n">bspace</span><span class="o">=</span><span class="n">bspace</span><span class="p">,</span><span class="n">legend_fontsize</span><span class="o">=</span><span class="n">legend_fontsize</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">rate</span><span class="p">:</span>
		<span class="n">label</span><span class="o">=</span><span class="s">&#39;rate&#39;</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="n">label</span><span class="o">=</span><span class="s">&#39;number&#39;</span>	
	<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rate_only</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">rate</span><span class="p">:</span>
			<span class="n">label</span><span class="o">=</span><span class="s">&#39;rate&#39;</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">label</span><span class="o">=</span><span class="s">&#39;number&#39;</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">save_data</span><span class="p">(</span><span class="n">header</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;age&#39;</span><span class="p">,</span><span class="s">&#39;SNIa &#39;</span><span class="o">+</span><span class="n">label</span><span class="p">,</span><span class="s">&#39;age&#39;</span><span class="p">,</span><span class="s">&#39;CCSN &#39;</span><span class="o">+</span><span class="n">label</span><span class="p">],</span><span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">rate_only</span><span class="o">==</span><span class="s">&#39;sn1a&#39;</span><span class="p">:</span>
			<span class="n">label</span><span class="o">=</span><span class="s">&#39;sn1a &#39;</span><span class="o">+</span><span class="n">label</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">label</span><span class="o">=</span><span class="s">&#39;ccsn &#39;</span><span class="o">+</span><span class="n">label</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">save_data</span><span class="p">(</span><span class="n">header</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;age&#39;</span><span class="p">,</span><span class="n">label</span><span class="p">],</span><span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">])</span>

</div>
<div class="viewcode-block" id="omega.save_data"><a class="viewcode-back" href="../omega.html#omega.omega.save_data">[docs]</a>    <span class="k">def</span> <span class="nf">save_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">header</span><span class="o">=</span><span class="p">[],</span><span class="n">data</span><span class="o">=</span><span class="p">[],</span><span class="n">filename</span><span class="o">=</span><span class="s">&#39;plot_data.txt&#39;</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Writes data into a text file. data entries</span>
<span class="sd">		can have different lengths</span>
<span class="sd">	&#39;&#39;&#39;</span>
	<span class="n">out</span><span class="o">=</span><span class="s">&#39; &#39;</span>
        <span class="c">#header</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">header</span><span class="p">)):</span>
            <span class="n">out</span><span class="o">+=</span> <span class="p">(</span><span class="s">&#39;&amp;&#39;</span><span class="o">+</span><span class="n">header</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="p">((</span><span class="mi">10</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">header</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span><span class="o">*</span><span class="s">&#39; &#39;</span><span class="p">))</span>
        <span class="c">#data</span>
	<span class="n">out</span><span class="o">+=</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
	<span class="n">max_data</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>
		<span class="n">max_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">t</span><span class="p">]))</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">max_data</span><span class="p">)):</span>
            <span class="c">#out+=(&#39;&amp;&#39;+&#39;{:.3E}&#39;.format(data[t]))</span>
            <span class="c">#out+=(&#39; &amp;&#39;+&#39;{:.3E}&#39;.format(frac_yields[t]))</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>
		<span class="k">if</span> <span class="n">t</span><span class="o">&gt;</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
			<span class="n">out</span><span class="o">+=</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span> <span class="s">&#39; &amp;&#39;</span><span class="o">+</span> <span class="s">&#39;{:.3E}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">0</span><span class="p">)))</span>
		<span class="k">else</span><span class="p">:</span>
                	<span class="n">out</span><span class="o">+=</span> <span class="p">(</span> <span class="s">&#39; &amp;&#39;</span><span class="o">+</span> <span class="s">&#39;{:.3E}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">t</span><span class="p">]))</span>
            <span class="c">#out+=( &#39; &amp;&#39;+ &#39;{:.3E}&#39;.format(mtot_gas[t]))</span>
            <span class="n">out</span><span class="o">+=</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
	<span class="c">#import os.path</span>
	<span class="c">#if os.path.isfile(filename) </span>
	<span class="c">#overwrite existing file for now</span>
	<span class="n">f1</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="s">&#39;w&#39;</span><span class="p">)</span>
	<span class="n">f1</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
	<span class="n">f1</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>



    <span class="c">##############################################</span>
    <span class="c">#          Plot Star Formation Rate          #</span>
    <span class="c">##############################################</span></div>
<div class="viewcode-block" id="omega.plot_star_formation_rate"><a class="viewcode-back" href="../omega.html#omega.omega.plot_star_formation_rate">[docs]</a>    <span class="k">def</span> <span class="nf">plot_star_formation_rate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fig</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span><span class="n">fraction</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">source</span><span class="o">=</span><span class="s">&#39;all&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="n">shape</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="n">abs_unit</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">fsize</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mf">4.5</span><span class="p">],</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span><span class="n">rspace</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span><span class="n">bspace</span><span class="o">=</span><span class="mf">0.15</span><span class="p">,</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span><span class="n">legend_fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">	Plots the star formation rate over time.</span>
<span class="sd">	Shows fraction of ISM mass which transforms into stars.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">	fraction : boolean</span>
<span class="sd">		if true: fraction of ISM which transforms into stars;</span>
<span class="sd">		else: mass of ISM which goes into stars</span>

<span class="sd">	source : string</span>
<span class="sd">		either &#39;all&#39; for total star formation rate; &#39;agb&#39; for AGB and &#39;massive&#39; for massive stars</span>

<span class="sd">	marker : string</span>
<span class="sd">		marker type</span>
<span class="sd">	shape : string</span>
<span class="sd">		line shape type</span>
<span class="sd">	fig: figure id</span>
<span class="sd">	</span>
<span class="sd">        Examples</span>
<span class="sd">        ----------</span>
<span class="sd">        &gt;&gt;&gt; s.star_formation_rate()</span>
<span class="sd">	</span>
<span class="sd">	&#39;&#39;&#39;</span>

	<span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">marker</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">color</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
		<span class="n">shape</span><span class="p">,</span><span class="n">marker</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__msc</span><span class="p">(</span><span class="n">source</span><span class="p">,</span><span class="n">shape</span><span class="p">,</span><span class="n">marker</span><span class="p">,</span><span class="n">color</span><span class="p">)</span>
	<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">fsize</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">fsize</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
	<span class="c">#maybe a histogram for display the SFR?</span>
	<span class="k">if</span> <span class="bp">False</span><span class="p">:</span>
		<span class="n">age</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">age</span>
		<span class="c">#age=[0.1]+self.history.age[1:-1]</span>
		<span class="n">sfr</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">sfr</span>
		<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;Log-scaled age [yrs]&#39;</span><span class="p">)</span>
		<span class="c">#plt.xscale(&#39;log&#39;)</span>
		<span class="n">mean_age</span><span class="o">=</span><span class="p">[]</span>
		<span class="n">color</span><span class="o">=</span><span class="s">&#39;r&#39;</span>
		<span class="n">label</span><span class="o">=</span><span class="s">&#39;aa&#39;</span>
		<span class="n">age_bdy</span><span class="o">=</span><span class="p">[]</span>
		<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">age</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
			<span class="n">mean_age</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="c">#age[k+1]-age[k])</span>
		<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">age</span><span class="p">)):</span>
			<span class="n">age_bdy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">age</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>	
		<span class="k">print</span> <span class="s">&#39;age&#39;</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">mean_age</span><span class="p">)</span>
		<span class="k">print</span> <span class="s">&#39;weights&#39;</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">sfr</span><span class="p">)</span>
		<span class="k">print</span> <span class="s">&#39;bdy&#39;</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">age_bdy</span><span class="p">)</span>
		<span class="k">print</span> <span class="n">sfr</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span>
	        <span class="n">p1</span> <span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">mean_age</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">age_bdy</span><span class="p">,</span><span class="n">weights</span><span class="o">=</span><span class="n">sfr</span><span class="p">,</span><span class="n">facecolor</span><span class="o">=</span><span class="n">color</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>

        <span class="c">#Plot the SFR in [Mo yr^-1]</span>
        <span class="k">if</span> <span class="n">abs_unit</span><span class="p">:</span>

            <span class="c">#Define visual aspects</span>
            <span class="n">shape</span><span class="p">,</span><span class="n">marker</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__msc</span><span class="p">(</span><span class="n">source</span><span class="p">,</span><span class="n">shape</span><span class="p">,</span><span class="n">marker</span><span class="p">,</span><span class="n">color</span><span class="p">)</span>

            <span class="c">#Recover the SFR by dividing the mass locked into stars, at</span>
            <span class="c">#each timestep, by the duration of the timestep</span>
            <span class="n">age</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">age</span>
            <span class="c">#sfr_plot = self.history.m_locked / self.history.timesteps</span>
            <span class="n">sfr_plot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">sfr_abs</span>
            
            <span class="c">#Label and display axis</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;Age [yrs]&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;SFR [Mo/yr]&#39;</span><span class="p">)</span>	

            <span class="c">#Plot</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">age</span><span class="p">,</span><span class="n">sfr_plot</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="n">shape</span><span class="p">)</span>

            <span class="c">#self.save_data(header=[&#39;age&#39;,&#39;SFR&#39;],data=[age,sfr_plot])</span>

        <span class="c">#Plot the mass fraction of gas available converted into stars</span>
	<span class="k">elif</span> <span class="n">fraction</span><span class="p">:</span>
		<span class="n">sfr</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">sfr</span>
                <span class="k">if</span> <span class="n">source</span><span class="o">==</span><span class="s">&#39;all&#39;</span><span class="p">:</span>
                        <span class="n">label</span><span class="o">=</span><span class="s">&#39;all&#39;</span>
                <span class="k">elif</span> <span class="n">source</span><span class="o">==</span><span class="s">&#39;agb&#39;</span><span class="p">:</span>
			<span class="n">sfr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sfr</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">m_locked_agb</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">m_locked</span><span class="p">)</span>
                        <span class="n">label</span><span class="o">=</span><span class="s">&#39;AGB&#39;</span>
                <span class="k">elif</span> <span class="n">source</span><span class="o">==</span><span class="s">&#39;massive&#39;</span><span class="p">:</span>
                        <span class="n">masslocked</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">m_locked_massive</span>
			<span class="n">sfr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sfr</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">m_locked_massive</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">m_locked</span><span class="p">)</span>
                        <span class="n">label</span><span class="o">=</span><span class="s">&#39;Massive&#39;</span>
		<span class="n">age</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">age</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
		<span class="k">print</span> <span class="nb">len</span><span class="p">(</span><span class="n">age</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">sfr</span><span class="p">)</span>
		<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;Age [yrs]&#39;</span><span class="p">)</span>
		<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">age</span><span class="p">,</span><span class="n">sfr</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="n">shape</span><span class="p">)</span>
		<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;Fraction of current gas mass into stars&#39;</span><span class="p">)</span>	
        	<span class="bp">self</span><span class="o">.</span><span class="n">save_data</span><span class="p">(</span><span class="n">header</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;age&#39;</span><span class="p">,</span><span class="s">&#39;SFR&#39;</span><span class="p">],</span><span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">age</span><span class="p">,</span><span class="n">sfr</span><span class="p">])</span>

        <span class="c">#Plot the mass converted into stars</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">source</span><span class="o">==</span><span class="s">&#39;all&#39;</span><span class="p">:</span>
			<span class="n">masslocked</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">m_locked</span>
			<span class="n">label</span><span class="o">=</span><span class="s">&#39;all&#39;</span>
		<span class="k">elif</span> <span class="n">source</span><span class="o">==</span><span class="s">&#39;agb&#39;</span><span class="p">:</span>
			<span class="n">masslocked</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">m_locked_agb</span>
			<span class="n">label</span><span class="o">=</span><span class="s">&#39;AGB&#39;</span>
		<span class="k">elif</span> <span class="n">source</span><span class="o">==</span><span class="s">&#39;massive&#39;</span><span class="p">:</span>
			<span class="n">masslocked</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">m_locked_massive</span>
			<span class="n">label</span><span class="o">=</span><span class="s">&#39;Massive&#39;</span>
		<span class="n">age</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">age</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
		<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">age</span><span class="p">,</span><span class="n">masslocked</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>
		<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;Age [yrs]&#39;</span><span class="p">)</span>
		<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;ISM Mass transformed into stars&#39;</span><span class="p">)</span>
		<span class="n">plt</span><span class="o">.</span><span class="n">xscale</span><span class="p">(</span><span class="s">&#39;log&#39;</span><span class="p">);</span><span class="n">plt</span><span class="o">.</span><span class="n">yscale</span><span class="p">(</span><span class="s">&#39;log&#39;</span><span class="p">)</span>
		<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

        <span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__fig_standard</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span><span class="n">labelsize</span><span class="o">=</span><span class="n">labelsize</span><span class="p">,</span><span class="n">rspace</span><span class="o">=</span><span class="n">rspace</span><span class="p">,</span> <span class="n">bspace</span><span class="o">=</span><span class="n">bspace</span><span class="p">,</span><span class="n">legend_fontsize</span><span class="o">=</span><span class="n">legend_fontsize</span><span class="p">)</span>

	<span class="c">#print &#39;Total mass transformed in stars, total mass transformed in AGBs, total mass transformed in massive stars:&#39;</span>
	<span class="c">#print sum(self.history.m_locked),sum(self.history.m_locked_agb),sum(self.history.m_locked_massive)</span>


</div>
    <span class="k">def</span> <span class="nf">__time_to_z</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">time</span><span class="p">,</span><span class="n">Hubble_0</span><span class="p">,</span><span class="n">Omega_lambda</span><span class="p">,</span><span class="n">Omega_m</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">	Time to redshift conversion</span>

<span class="sd">	&#39;&#39;&#39;</span>
	<span class="kn">import</span> <span class="nn">time_to_redshift</span> <span class="kn">as</span> <span class="nn">tz</span>
	<span class="c">#transform into Gyr</span>
	<span class="n">time_new</span><span class="o">=</span><span class="p">[]</span>
	<span class="n">firstidx</span><span class="o">=</span><span class="bp">True</span>
	<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">time</span><span class="p">)):</span>
		<span class="k">if</span> <span class="n">time</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">&gt;=</span><span class="mf">8e8</span><span class="p">:</span>
			<span class="n">time_new</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">time</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">/</span><span class="mf">1e9</span><span class="p">)</span>
			<span class="k">if</span> <span class="n">firstidx</span><span class="p">:</span>
				<span class="n">index</span><span class="o">=</span><span class="n">k</span>
				<span class="n">firstidx</span><span class="o">=</span><span class="bp">False</span>	
	<span class="k">return</span> <span class="n">tz</span><span class="o">.</span><span class="n">t_to_z</span><span class="p">(</span><span class="n">time_new</span><span class="p">,</span><span class="n">Hubble_0</span><span class="p">,</span><span class="n">Omega_lambda</span><span class="p">,</span><span class="n">Omega_m</span><span class="p">),</span><span class="n">index</span>

    <span class="k">def</span> <span class="nf">__msc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">source</span><span class="p">,</span><span class="n">shape</span><span class="p">,</span><span class="n">marker</span><span class="p">,</span><span class="n">color</span><span class="p">):</span>

	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">	Function checks if either of shape,color,marker</span>
<span class="sd">	is set. If not then assign in each case</span>
<span class="sd">	a unique property related to the source (&#39;agb&#39;,&#39;massive&#39;..)</span>
<span class="sd">	to the variable and returns all three</span>
<span class="sd">	&#39;&#39;&#39;</span>

	<span class="k">if</span> <span class="n">source</span><span class="o">==</span><span class="s">&#39;all&#39;</span><span class="p">:</span>
		<span class="n">shape1</span><span class="o">=</span><span class="s">&#39;-&#39;</span>
		<span class="n">marker1</span><span class="o">=</span><span class="s">&#39;o&#39;</span>
		<span class="n">color1</span><span class="o">=</span><span class="s">&#39;k&#39;</span>
	<span class="k">elif</span> <span class="n">source</span><span class="o">==</span><span class="s">&#39;agb&#39;</span><span class="p">:</span>
		<span class="n">shape1</span><span class="o">=</span><span class="s">&#39;--&#39;</span>
		<span class="n">marker1</span><span class="o">=</span><span class="s">&#39;s&#39;</span>
		<span class="n">color1</span><span class="o">=</span><span class="s">&#39;r&#39;</span>
	<span class="k">elif</span> <span class="n">source</span><span class="o">==</span><span class="s">&#39;massive&#39;</span><span class="p">:</span>
		<span class="n">shape1</span><span class="o">=</span><span class="s">&#39;-.&#39;</span>
		<span class="n">marker1</span><span class="o">=</span><span class="s">&#39;D&#39;</span>
		<span class="n">color1</span><span class="o">=</span><span class="s">&#39;b&#39;</span>
	<span class="k">elif</span> <span class="n">source</span> <span class="o">==</span><span class="s">&#39;sn1a&#39;</span><span class="p">:</span>
		<span class="n">shape1</span><span class="o">=</span><span class="s">&#39;:&#39;</span>
		<span class="n">marker1</span><span class="o">=</span><span class="s">&#39;x&#39;</span>
		<span class="n">color1</span><span class="o">=</span><span class="s">&#39;g&#39;</span>
	
	<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
		<span class="n">shape</span><span class="o">=</span><span class="n">shape1</span>
	<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">marker</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
		<span class="n">marker</span><span class="o">=</span><span class="n">marker1</span>
	<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">color</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
		<span class="n">color</span><span class="o">=</span><span class="n">color1</span>

	<span class="k">return</span> <span class="n">shape</span><span class="p">,</span><span class="n">marker</span><span class="p">,</span><span class="n">color</span>


    <span class="c">##############################################</span>
    <span class="c">#                Fig Standard                #</span>
    <span class="c">##############################################</span>
    <span class="k">def</span> <span class="nf">__fig_standard</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ax</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span><span class="n">lwtickboth</span><span class="o">=</span><span class="p">[</span><span class="mi">6</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span><span class="n">lwtickmajor</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span><span class="n">markersize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span><span class="n">rspace</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span><span class="n">bspace</span><span class="o">=</span><span class="mf">0.15</span><span class="p">,</span> <span class="n">legend_fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">	Internal function in order to get standardized figure font sizes.</span>
<span class="sd">	It is used in the plotting functions.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">prop</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="n">legend_fontsize</span><span class="p">})</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s">&#39;font.size&#39;</span><span class="p">:</span> <span class="n">fontsize</span><span class="p">})</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">set_size</span><span class="p">(</span><span class="n">labelsize</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">set_size</span><span class="p">(</span><span class="n">labelsize</span><span class="p">)</span>
	<span class="c">#ax.xaxis.set_tick_params(width=2)</span>
	<span class="c">#ax.yaxis.set_tick_params(width=2)		</span>
	<span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">length</span><span class="o">=</span><span class="n">lwtickboth</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">width</span><span class="o">=</span><span class="n">lwtickboth</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">which</span><span class="o">=</span><span class="s">&#39;both&#39;</span><span class="p">)</span>
	<span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">length</span><span class="o">=</span><span class="n">lwtickmajor</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">width</span><span class="o">=</span><span class="n">lwtickmajor</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">which</span><span class="o">=</span><span class="s">&#39;major&#39;</span><span class="p">)</span>
	<span class="c">#Add that line below at some point</span>
	<span class="c">#ax.xaxis.set_tick_params(width=2)</span>
	<span class="c">#ax.yaxis.set_tick_params(width=2)</span>
	<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">lines</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
		<span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">lines</span><span class="p">)):</span>
			<span class="n">ax</span><span class="o">.</span><span class="n">lines</span><span class="p">[</span><span class="n">h</span><span class="p">]</span><span class="o">.</span><span class="n">set_markersize</span><span class="p">(</span><span class="n">markersize</span><span class="p">)</span>
	<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s">&#39;center left&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.01</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span><span class="n">markerscale</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">legend_fontsize</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">right</span><span class="o">=</span><span class="n">rspace</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="n">bspace</span><span class="p">)</span>


    <span class="c">##############################################</span>
    <span class="c">#              Plot Mass-Loading             #</span>
    <span class="c">##############################################</span>
<div class="viewcode-block" id="omega.plot_mass_loading"><a class="viewcode-back" href="../omega.html#omega.omega.plot_mass_loading">[docs]</a>    <span class="k">def</span> <span class="nf">plot_mass_loading</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fig</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="n">shape</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span>\
            <span class="n">color</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s">&#39;Mass-loading&#39;</span><span class="p">,</span><span class="n">fsize</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mf">4.5</span><span class="p">],</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span><span class="n">rspace</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span>\
            <span class="n">bspace</span><span class="o">=</span><span class="mf">0.15</span><span class="p">,</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span><span class="n">legend_fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">	This function plots the mass-loading factor, which is the ratio</span>
<span class="sd">	between the mass outflow rate and the star formation rate, as a</span>
<span class="sd">	function of time.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        fig : string, float</span>
<span class="sd">	     Figure name.</span>
<span class="sd">	marker : string</span>
<span class="sd">	     Figure marker.</span>
<span class="sd">	shape : string</span>
<span class="sd">	     Line style.</span>
<span class="sd">	color : string</span>
<span class="sd">	     Line color.</span>
<span class="sd">	label : string</span>
<span class="sd">	     Figure label.</span>
<span class="sd">	fsize : 2D float array</span>
<span class="sd">	     Figure dimension/size.</span>
<span class="sd">	fontsize : integer</span>
<span class="sd">	     Font size of the numbers on the X and Y axis.</span>
<span class="sd">	rspace : float</span>
<span class="sd">	     Extra space on the right for the legend.</span>
<span class="sd">	bspace : float</span>
<span class="sd">	     Extra space at the bottom for the Y axis label.</span>
<span class="sd">	labelsize : integer</span>
<span class="sd">	     Font size of the X and Y axis labels.</span>
<span class="sd">	legend_fontsize : integer</span>
<span class="sd"> 	       Font size of the legend.</span>

<span class="sd">        Examples</span>
<span class="sd">	----------</span>

<span class="sd">	&gt;&gt;&gt; o1.plot_mass_loading(label=&#39;Mass-Loading Factor&#39;)</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c"># Define variable only used for plot visual</span>
        <span class="n">source</span><span class="o">=</span><span class="s">&#39;all&#39;</span>

        <span class="c">#Plot only if in the open box scenario</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">open_box</span><span class="p">:</span>
 
            <span class="c">#Define visual aspects</span>
            <span class="n">shape</span><span class="p">,</span><span class="n">marker</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__msc</span><span class="p">(</span><span class="n">source</span><span class="p">,</span><span class="n">shape</span><span class="p">,</span><span class="n">marker</span><span class="p">,</span><span class="n">color</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">fsize</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">fsize</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

            <span class="c">#Display axis labels</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;Age [yrs]&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;Mass-loading factor&#39;</span><span class="p">)</span>	

            <span class="c">#Copy data for x and y axis</span>
            <span class="n">age</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">age</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">mass_lo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">eta_outflow_t</span>

            <span class="c">#Plot data</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">age</span><span class="p">,</span><span class="n">mass_lo</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>\
                     <span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="n">shape</span><span class="p">)</span>

            <span class="c">#Save plot</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save_data</span><span class="p">(</span><span class="n">header</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;age&#39;</span><span class="p">,</span><span class="s">&#39;mass-loading&#39;</span><span class="p">],</span><span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">age</span><span class="p">,</span><span class="n">mass_lo</span><span class="p">])</span>

            <span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__fig_standard</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span><span class="n">labelsize</span><span class="o">=</span><span class="n">labelsize</span><span class="p">,</span>\
                <span class="n">rspace</span><span class="o">=</span><span class="n">rspace</span><span class="p">,</span> <span class="n">bspace</span><span class="o">=</span><span class="n">bspace</span><span class="p">,</span><span class="n">legend_fontsize</span><span class="o">=</span><span class="n">legend_fontsize</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&#39;Not available with a closed box.&#39;</span>


    <span class="c">##############################################</span>
    <span class="c">#              Plot Outflow Rate             #</span>
    <span class="c">##############################################</span></div>
<div class="viewcode-block" id="omega.plot_outflow_rate"><a class="viewcode-back" href="../omega.html#omega.omega.plot_outflow_rate">[docs]</a>    <span class="k">def</span> <span class="nf">plot_outflow_rate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fig</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="n">shape</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span>\
            <span class="n">color</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s">&#39;Outflow&#39;</span><span class="p">,</span><span class="n">fsize</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mf">4.5</span><span class="p">],</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span><span class="n">rspace</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span>\
            <span class="n">bspace</span><span class="o">=</span><span class="mf">0.15</span><span class="p">,</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span><span class="n">legend_fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">	This function plots the mass outflow rate as a function of time</span>
<span class="sd">        in units of [Mo/yr].</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        fig : string, float</span>
<span class="sd">	     Figure name.</span>
<span class="sd">	marker : string</span>
<span class="sd">	     Figure marker.</span>
<span class="sd">	shape : string</span>
<span class="sd">	     Line style.</span>
<span class="sd">	color : string</span>
<span class="sd">	     Line color.</span>
<span class="sd">	label : string</span>
<span class="sd">	     Figure label.</span>
<span class="sd">	fsize : 2D float array</span>
<span class="sd">	     Figure dimension/size.</span>
<span class="sd">	fontsize : integer</span>
<span class="sd">	     Font size of the numbers on the X and Y axis.</span>
<span class="sd">	rspace : float</span>
<span class="sd">	     Extra space on the right for the legend.</span>
<span class="sd">	bspace : float</span>
<span class="sd">	     Extra space at the bottom for the Y axis label.</span>
<span class="sd">	labelsize : integer</span>
<span class="sd">	     Font size of the X and Y axis labels.</span>
<span class="sd">	legend_fontsize : integer</span>
<span class="sd"> 	       Font size of the legend.</span>

<span class="sd">        Examples</span>
<span class="sd">	----------</span>

<span class="sd">	&gt;&gt;&gt; o1.plot_outflow_rate(label=&#39;Outflow Rate&#39;)</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c"># Define variable only used for plot visual</span>
        <span class="n">source</span><span class="o">=</span><span class="s">&#39;all&#39;</span>

        <span class="c">#Plot only if in the open box scenario</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">open_box</span><span class="p">:</span>

            <span class="c">#Define visual aspects</span>
            <span class="n">shape</span><span class="p">,</span><span class="n">marker</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__msc</span><span class="p">(</span><span class="n">source</span><span class="p">,</span><span class="n">shape</span><span class="p">,</span><span class="n">marker</span><span class="p">,</span><span class="n">color</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">fsize</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">fsize</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

            <span class="c">#Display axis labels</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;Age [yrs]&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;Outflow rate [Mo/yr]&#39;</span><span class="p">)</span>	

            <span class="c">#Copy data for x and y axis</span>
            <span class="n">age</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">age</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">outflow_plot</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i_op</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">age</span><span class="p">)):</span>
                <span class="n">outflow_plot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">m_outflow_t</span><span class="p">[</span><span class="n">i_op</span><span class="p">]</span> <span class="o">/</span> \
                    <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">timesteps</span><span class="p">[</span><span class="n">i_op</span><span class="p">])</span>
            <span class="n">outflow_plot</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>

            <span class="c">#Plot data</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">age</span><span class="p">,</span><span class="n">outflow_plot</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">,</span>\
                     <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="n">shape</span><span class="p">)</span>

            <span class="c">#Save plot</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save_data</span><span class="p">(</span><span class="n">header</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;age&#39;</span><span class="p">,</span><span class="s">&#39;outflow rate&#39;</span><span class="p">],</span><span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">age</span><span class="p">,</span><span class="n">outflow_plot</span><span class="p">])</span>

            <span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__fig_standard</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span><span class="n">labelsize</span><span class="o">=</span><span class="n">labelsize</span><span class="p">,</span>\
                <span class="n">rspace</span><span class="o">=</span><span class="n">rspace</span><span class="p">,</span> <span class="n">bspace</span><span class="o">=</span><span class="n">bspace</span><span class="p">,</span><span class="n">legend_fontsize</span><span class="o">=</span><span class="n">legend_fontsize</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&#39;Not available with a closed box.&#39;</span>


    <span class="c">##############################################</span>
    <span class="c">#              Plot Inflow Rate              #</span>
    <span class="c">##############################################</span></div>
<div class="viewcode-block" id="omega.plot_inflow_rate"><a class="viewcode-back" href="../omega.html#omega.omega.plot_inflow_rate">[docs]</a>    <span class="k">def</span> <span class="nf">plot_inflow_rate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fig</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="n">shape</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span>\
            <span class="n">label</span><span class="o">=</span><span class="s">&#39;Inflow&#39;</span><span class="p">,</span><span class="n">fsize</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mf">4.5</span><span class="p">],</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span><span class="n">rspace</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span><span class="n">bspace</span><span class="o">=</span><span class="mf">0.15</span><span class="p">,</span>\
            <span class="n">labelsize</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span><span class="n">legend_fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">	This function plots the mass inflow rate as a function of time</span>
<span class="sd">        in units of [Mo/yr].</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        fig : string, float</span>
<span class="sd">	     Figure name.</span>
<span class="sd">	marker : string</span>
<span class="sd">	     Figure marker.</span>
<span class="sd">	shape : string</span>
<span class="sd">	     Line style.</span>
<span class="sd">	color : string</span>
<span class="sd">	     Line color.</span>
<span class="sd">	label : string</span>
<span class="sd">	     Figure label.</span>
<span class="sd">	fsize : 2D float array</span>
<span class="sd">	     Figure dimension/size.</span>
<span class="sd">	fontsize : integer</span>
<span class="sd">	     Font size of the numbers on the X and Y axis.</span>
<span class="sd">	rspace : float</span>
<span class="sd">	     Extra space on the right for the legend.</span>
<span class="sd">	bspace : float</span>
<span class="sd">	     Extra space at the bottom for the Y axis label.</span>
<span class="sd">	labelsize : integer</span>
<span class="sd">	     Font size of the X and Y axis labels.</span>
<span class="sd">	legend_fontsize : integer</span>
<span class="sd"> 	       Font size of the legend.</span>

<span class="sd">        Examples</span>
<span class="sd">	----------</span>

<span class="sd">	&gt;&gt;&gt; o1.plot_inflow_rate(label=&#39;Inflow Rate&#39;)</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c"># Define variable only used for plot visual</span>
        <span class="n">source</span><span class="o">=</span><span class="s">&#39;all&#39;</span>

        <span class="c">#Plot only if in the open box scenario</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">open_box</span><span class="p">:</span>

            <span class="c">#Define visual aspects</span>
            <span class="n">shape</span><span class="p">,</span><span class="n">marker</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__msc</span><span class="p">(</span><span class="n">source</span><span class="p">,</span><span class="n">shape</span><span class="p">,</span><span class="n">marker</span><span class="p">,</span><span class="n">color</span><span class="p">)</span>
	    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">fsize</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">fsize</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

            <span class="c">#Display axis labels</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;Age [yrs]&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;Inflow rate [Mo/yr]&#39;</span><span class="p">)</span>	

            <span class="c">#Copy data for x and y axis</span>
            <span class="n">age</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">age</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">inflow_plot</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i_op</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">age</span><span class="p">)):</span>
                <span class="n">inflow_plot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">m_inflow_t</span><span class="p">[</span><span class="n">i_op</span><span class="p">]</span> <span class="o">/</span> \
                    <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">timesteps</span><span class="p">[</span><span class="n">i_op</span><span class="p">])</span>

            <span class="c">#Plot data</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">age</span><span class="p">,</span><span class="n">inflow_plot</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">,</span>\
                     <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="n">shape</span><span class="p">)</span>

            <span class="c">#Save plot</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save_data</span><span class="p">(</span><span class="n">header</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;age&#39;</span><span class="p">,</span><span class="s">&#39;inflow rate&#39;</span><span class="p">],</span><span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">age</span><span class="p">,</span><span class="n">inflow_plot</span><span class="p">])</span>

            <span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__fig_standard</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span><span class="n">labelsize</span><span class="o">=</span><span class="n">labelsize</span><span class="p">,</span>\
                <span class="n">rspace</span><span class="o">=</span><span class="n">rspace</span><span class="p">,</span> <span class="n">bspace</span><span class="o">=</span><span class="n">bspace</span><span class="p">,</span><span class="n">legend_fontsize</span><span class="o">=</span><span class="n">legend_fontsize</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&#39;Not available with a closed box.&#39;</span>


    <span class="c">##############################################</span>
    <span class="c">#              Plot Dark Matter              #</span>
    <span class="c">##############################################</span></div>
<div class="viewcode-block" id="omega.plot_dark_matter"><a class="viewcode-back" href="../omega.html#omega.omega.plot_dark_matter">[docs]</a>    <span class="k">def</span> <span class="nf">plot_dark_matter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fig</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="n">shape</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span>\
            <span class="n">color</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s">&#39;Dark matter&#39;</span><span class="p">,</span><span class="n">fsize</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mf">4.5</span><span class="p">],</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span><span class="n">rspace</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> \
            <span class="n">bspace</span><span class="o">=</span><span class="mf">0.15</span><span class="p">,</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span><span class="n">legend_fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">	This function plots the dark matter halo mass of the galaxy as a </span>
<span class="sd">	function of time.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        fig : string, float</span>
<span class="sd">	     Figure name.</span>
<span class="sd">	marker : string</span>
<span class="sd">	     Figure marker.</span>
<span class="sd">	shape : string</span>
<span class="sd">	     Line style.</span>
<span class="sd">	color : string</span>
<span class="sd">	     Line color.</span>
<span class="sd">	label : string</span>
<span class="sd">	     Figure label.</span>
<span class="sd">	fsize : 2D float array</span>
<span class="sd">	     Figure dimension/size.</span>
<span class="sd">	fontsize : integer</span>
<span class="sd">	     Font size of the numbers on the X and Y axis.</span>
<span class="sd">	rspace : float</span>
<span class="sd">	     Extra space on the right for the legend.</span>
<span class="sd">	bspace : float</span>
<span class="sd">	     Extra space at the bottom for the Y axis label.</span>
<span class="sd">	labelsize : integer</span>
<span class="sd">	     Font size of the X and Y axis labels.</span>
<span class="sd">	legend_fontsize : integer</span>
<span class="sd"> 	       Font size of the legend.</span>

<span class="sd">        Examples</span>
<span class="sd">	----------</span>

<span class="sd">	&gt;&gt;&gt; o1.plot_dark_matter(label=&#39;Dark Matter&#39;)</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c"># Define variable only used for plot visual</span>
        <span class="n">source</span><span class="o">=</span><span class="s">&#39;all&#39;</span>

        <span class="c"># Plot only if in the open box scenario</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">open_box</span><span class="p">:</span>

            <span class="c"># Define visual aspects</span>
            <span class="n">shape</span><span class="p">,</span><span class="n">marker</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__msc</span><span class="p">(</span><span class="n">source</span><span class="p">,</span><span class="n">shape</span><span class="p">,</span><span class="n">marker</span><span class="p">,</span><span class="n">color</span><span class="p">)</span>
	    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">fsize</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">fsize</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

            <span class="c">#Display axis labels</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;Age [yrs]&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;Dark matter halo mass [Mo]&#39;</span><span class="p">)</span>	

            <span class="c">#Copy data for x and y axis</span>
            <span class="n">age</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">age</span>
            <span class="n">DM_plot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">m_DM_t</span>

            <span class="c">#Plot data</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">age</span><span class="p">,</span><span class="n">DM_plot</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">,</span>\
                     <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="n">shape</span><span class="p">)</span>

            <span class="c">#Save plot</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save_data</span><span class="p">(</span><span class="n">header</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;age&#39;</span><span class="p">,</span><span class="s">&#39;dark matter halo mass&#39;</span><span class="p">],</span>\
                           <span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">age</span><span class="p">,</span><span class="n">DM_plot</span><span class="p">])</span>

            <span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__fig_standard</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span><span class="n">labelsize</span><span class="o">=</span><span class="n">labelsize</span><span class="p">,</span>\
                <span class="n">rspace</span><span class="o">=</span><span class="n">rspace</span><span class="p">,</span> <span class="n">bspace</span><span class="o">=</span><span class="n">bspace</span><span class="p">,</span><span class="n">legend_fontsize</span><span class="o">=</span><span class="n">legend_fontsize</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&#39;Not available with a closed box.&#39;</span>


    <span class="c">##############################################</span>
    <span class="c">#             Plot SF Timescale              #</span>
    <span class="c">##############################################</span></div>
<div class="viewcode-block" id="omega.plot_sf_timescale"><a class="viewcode-back" href="../omega.html#omega.omega.plot_sf_timescale">[docs]</a>    <span class="k">def</span> <span class="nf">plot_sf_timescale</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fig</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="n">shape</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span>\
            <span class="n">label</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="n">fsize</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mf">4.5</span><span class="p">],</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span><span class="n">rspace</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span><span class="n">bspace</span><span class="o">=</span><span class="mf">0.15</span><span class="p">,</span>\
            <span class="n">labelsize</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span><span class="n">legend_fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">	This function plots the star formation timescale as a function of time</span>
<span class="sd">        in units of [yr].</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        fig : string, float</span>
<span class="sd">	     Figure name.</span>
<span class="sd">	marker : string</span>
<span class="sd">	     Figure marker.</span>
<span class="sd">	shape : string</span>
<span class="sd">	     Line style.</span>
<span class="sd">	color : string</span>
<span class="sd">	     Line color.</span>
<span class="sd">	label : string</span>
<span class="sd">	     Figure label.</span>
<span class="sd">	fsize : 2D float array</span>
<span class="sd">	     Figure dimension/size.</span>
<span class="sd">	fontsize : integer</span>
<span class="sd">	     Font size of the numbers on the X and Y axis.</span>
<span class="sd">	rspace : float</span>
<span class="sd">	     Extra space on the right for the legend.</span>
<span class="sd">	bspace : float</span>
<span class="sd">	     Extra space at the bottom for the Y axis label.</span>
<span class="sd">	labelsize : integer</span>
<span class="sd">	     Font size of the X and Y axis labels.</span>
<span class="sd">	legend_fontsize : integer</span>
<span class="sd"> 	       Font size of the legend.</span>

<span class="sd">        Examples</span>
<span class="sd">	----------</span>

<span class="sd">	&gt;&gt;&gt; o1.plot_sf_timescale(label=&#39;Star Formation Timescale&#39;)</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c"># Define variable only used for plot visual</span>
        <span class="n">source</span><span class="o">=</span><span class="s">&#39;all&#39;</span>

        <span class="c">#Plot only if in the open box scenario</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">open_box</span><span class="p">:</span>

            <span class="c">#Define visual aspects</span>
            <span class="n">shape</span><span class="p">,</span><span class="n">marker</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__msc</span><span class="p">(</span><span class="n">source</span><span class="p">,</span><span class="n">shape</span><span class="p">,</span><span class="n">marker</span><span class="p">,</span><span class="n">color</span><span class="p">)</span>
	    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">fsize</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">fsize</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

            <span class="c">#Display axis labels</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;Age [yrs]&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;Star formation timescale [yr]&#39;</span><span class="p">)</span>	

            <span class="c">#print len(self.history.age)</span>
            <span class="c">#print len(self.history.t_SF_t)</span>

            <span class="c">#Copy data for x and y axis</span>
            <span class="n">age</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">age</span>
            <span class="n">t_SF_plot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">t_SF_t</span>

            <span class="c">#Plot data</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">age</span><span class="p">,</span><span class="n">t_SF_plot</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">,</span>\
                     <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="n">shape</span><span class="p">)</span>

            <span class="c">#Save plot</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save_data</span><span class="p">(</span><span class="n">header</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;age&#39;</span><span class="p">,</span><span class="s">&#39;star formation timescale&#39;</span><span class="p">],</span>\
                                   <span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">age</span><span class="p">,</span><span class="n">t_SF_plot</span><span class="p">])</span>

            <span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__fig_standard</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span><span class="n">labelsize</span><span class="o">=</span><span class="n">labelsize</span><span class="p">,</span>\
                <span class="n">rspace</span><span class="o">=</span><span class="n">rspace</span><span class="p">,</span> <span class="n">bspace</span><span class="o">=</span><span class="n">bspace</span><span class="p">,</span><span class="n">legend_fontsize</span><span class="o">=</span><span class="n">legend_fontsize</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&#39;Not available with a closed box.&#39;</span>


    <span class="c">##############################################</span>
    <span class="c">#               Plot Redshift                #</span>
    <span class="c">##############################################</span></div>
<div class="viewcode-block" id="omega.plot_redshift"><a class="viewcode-back" href="../omega.html#omega.omega.plot_redshift">[docs]</a>    <span class="k">def</span> <span class="nf">plot_redshift</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fig</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="n">shape</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span>\
            <span class="n">color</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s">&#39;Redshift&#39;</span><span class="p">,</span><span class="n">fsize</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mf">4.5</span><span class="p">],</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span><span class="n">rspace</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span>\
            <span class="n">bspace</span><span class="o">=</span><span class="mf">0.15</span><span class="p">,</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span><span class="n">legend_fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">	This function plots the redshift a function of time.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        fig : string, float</span>
<span class="sd">	     Figure name.</span>
<span class="sd">	marker : string</span>
<span class="sd">	     Figure marker.</span>
<span class="sd">	shape : string</span>
<span class="sd">	     Line style.</span>
<span class="sd">	color : string</span>
<span class="sd">	     Line color.</span>
<span class="sd">	label : string</span>
<span class="sd">	     Figure label.</span>
<span class="sd">	fsize : 2D float array</span>
<span class="sd">	     Figure dimension/size.</span>
<span class="sd">	fontsize : integer</span>
<span class="sd">	     Font size of the numbers on the X and Y axis.</span>
<span class="sd">	rspace : float</span>
<span class="sd">	     Extra space on the right for the legend.</span>
<span class="sd">	bspace : float</span>
<span class="sd">	     Extra space at the bottom for the Y axis label.</span>
<span class="sd">	labelsize : integer</span>
<span class="sd">	     Font size of the X and Y axis labels.</span>
<span class="sd">	legend_fontsize : integer</span>
<span class="sd"> 	       Font size of the legend.</span>

<span class="sd">        Examples</span>
<span class="sd">	----------</span>

<span class="sd">	&gt;&gt;&gt; o1.plot_redshift(label=&#39;Redshift&#39;)</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c"># Define variable only used for plot visual</span>
        <span class="n">source</span><span class="o">=</span><span class="s">&#39;all&#39;</span>

        <span class="c">#Plot only if in the open box scenario</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">open_box</span><span class="p">:</span>

            <span class="c">#Define visual aspects</span>
            <span class="n">shape</span><span class="p">,</span><span class="n">marker</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__msc</span><span class="p">(</span><span class="n">source</span><span class="p">,</span><span class="n">shape</span><span class="p">,</span><span class="n">marker</span><span class="p">,</span><span class="n">color</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">fsize</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">fsize</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

            <span class="c">#Display axis labels</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;Age [yrs]&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;Redshift&#39;</span><span class="p">)</span>	

            <span class="c">#Copy data for x and y axis</span>
            <span class="n">age</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">age</span>
            <span class="n">redshift_plot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">redshift_t</span>

            <span class="c">#Plot data</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">age</span><span class="p">,</span><span class="n">redshift_plot</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">,</span>\
                     <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="n">shape</span><span class="p">)</span>

            <span class="c">#Save plot</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save_data</span><span class="p">(</span><span class="n">header</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;age&#39;</span><span class="p">,</span><span class="s">&#39;redshift&#39;</span><span class="p">],</span><span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">age</span><span class="p">,</span><span class="n">redshift_plot</span><span class="p">])</span>

            <span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__fig_standard</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span><span class="n">labelsize</span><span class="o">=</span><span class="n">labelsize</span><span class="p">,</span>\
                <span class="n">rspace</span><span class="o">=</span><span class="n">rspace</span><span class="p">,</span> <span class="n">bspace</span><span class="o">=</span><span class="n">bspace</span><span class="p">,</span><span class="n">legend_fontsize</span><span class="o">=</span><span class="n">legend_fontsize</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&#39;Not available with a closed box.&#39;</span>


    <span class="c">###################################################</span>
    <span class="c">#                  Plot Iso Ratio                 #</span>
    <span class="c">###################################################</span></div>
<div class="viewcode-block" id="omega.plot_iso_ratio"><a class="viewcode-back" href="../omega.html#omega.omega.plot_iso_ratio">[docs]</a>    <span class="k">def</span> <span class="nf">plot_iso_ratio</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">return_x_y</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
        <span class="n">xaxis</span><span class="o">=</span><span class="s">&#39;age&#39;</span><span class="p">,</span><span class="n">yaxis</span><span class="o">=</span><span class="s">&#39;C-12/C-13&#39;</span><span class="p">,</span>\
        <span class="n">solar_ab</span><span class="o">=</span><span class="s">&#39;yield_tables/iniabu/iniab2.0E-02GN93.ppn&#39;</span><span class="p">,</span>\
        <span class="n">solar_iso</span><span class="o">=</span><span class="s">&#39;solar_normalization/Asplund_et_al_2009_iso.txt&#39;</span><span class="p">,</span>\
        <span class="n">fig</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span><span class="n">source</span><span class="o">=</span><span class="s">&#39;all&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="n">shape</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span>\
        <span class="n">color</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="n">fsize</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mf">4.5</span><span class="p">],</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span><span class="n">rspace</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span>\
        <span class="n">bspace</span><span class="o">=</span><span class="mf">0.15</span><span class="p">,</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span><span class="n">legend_fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">	This function plots the evolution of an isotopic ratio as a function</span>
<span class="sd">	of time, as a function of an abundance ratio, or as a function of</span>
<span class="sd">	another isotopic ratio.  Isotopic ratios are given in the</span>
<span class="sd">	delta notation and abundances ratios are given in spectroscopic notation.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">	return_x_y : boolean</span>
<span class="sd">	     If False, show the plot.  If True, return two arrays containing</span>
<span class="sd">	     the X and Y axis data, respectively.</span>
<span class="sd">	xaxis : string</span>
<span class="sd">	     X axis, either &#39;age&#39;, an abundance ratio such as &#39;[Fe/H]&#39;, or an</span>
<span class="sd">	     isotopic ratio such as &#39;C-12/C-13&#39;.</span>
<span class="sd">	yaxis : string</span>
<span class="sd">	     Y axis, isotopic ratio such as &#39;C-12/C-13&#39;.</span>
<span class="sd">	solar_ab : string</span>
<span class="sd">	     Path to the solar abundances used to normalize abundance ratios.</span>
<span class="sd">	solar_iso : string</span>
<span class="sd">	     Path to the solar isotopes used to normalize the isotopic ratios.</span>
<span class="sd">        fig : string, float</span>
<span class="sd">	     Figure name.</span>
<span class="sd">        source : string</span>
<span class="sd">            Specificies if yields come from</span>
<span class="sd">	    all sources (&#39;all&#39;) or from</span>
<span class="sd">	    distinctive sources:</span>
<span class="sd">	    only AGB stars (&#39;agb&#39;), only</span>
<span class="sd">	    SN Ia (&#39;sn1a&#39;), or only massive stars</span>
<span class="sd">	    (&#39;massive&#39;)</span>
<span class="sd">	marker : string</span>
<span class="sd">	     Figure marker.</span>
<span class="sd">	shape : string</span>
<span class="sd">	     Line style.</span>
<span class="sd">	color : string</span>
<span class="sd">	     Line color.</span>
<span class="sd">	label : string</span>
<span class="sd">	     Figure label.</span>
<span class="sd">	fsize : 2D float array</span>
<span class="sd">	     Figure dimension/size.</span>
<span class="sd">	fontsize : integer</span>
<span class="sd">	     Font size of the numbers on the X and Y axis.</span>
<span class="sd">	rspace : float</span>
<span class="sd">	     Extra space on the right for the legend.</span>
<span class="sd">	bspace : float</span>
<span class="sd">	     Extra space at the bottom for the Y axis label.</span>
<span class="sd">	labelsize : integer</span>
<span class="sd">	     Font size of the X and Y axis labels.</span>
<span class="sd">	legend_fontsize : integer</span>
<span class="sd"> 	       Font size of the legend.</span>

<span class="sd">        Examples</span>
<span class="sd">	----------</span>

<span class="sd">	&gt;&gt;&gt; o1.plot_iso_ratio(xaxis=&#39;[Fe/H]&#39;, yaxis=&#39;C-12/C-13&#39;)</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c"># Marker on the plots</span>
        <span class="n">markevery</span><span class="o">=</span><span class="mi">500</span>

        <span class="c"># Declaration of the array to plot</span>
        <span class="n">x</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c">#Access solar abundance</span>
        <span class="n">iniabu</span><span class="o">=</span><span class="n">ry</span><span class="o">.</span><span class="n">iniabu</span><span class="p">(</span><span class="n">global_path</span><span class="o">+</span><span class="n">solar_ab</span><span class="p">)</span>
        <span class="n">x_ini_iso</span><span class="o">=</span><span class="n">iniabu</span><span class="o">.</span><span class="n">iso_abundance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">isotopes</span><span class="p">)</span>
        <span class="n">elements</span><span class="p">,</span><span class="n">x_ini</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_iso_abu_to_elem</span><span class="p">(</span><span class="n">x_ini_iso</span><span class="p">)</span>

        <span class="c"># Get the wanted source</span>
        <span class="k">if</span> <span class="n">source</span> <span class="o">==</span> <span class="s">&#39;all&#39;</span><span class="p">:</span>
            <span class="n">yields_evol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">ism_iso_yield</span>
            <span class="n">yields_evol_el</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">ism_elem_yield</span>
        <span class="k">elif</span> <span class="n">source</span> <span class="o">==</span><span class="s">&#39;agb&#39;</span><span class="p">:</span>
            <span class="n">yields_evol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">ism_iso_yield_agb</span>
            <span class="n">yields_evol_el</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">ism_elem_yield_agb</span>
        <span class="k">elif</span> <span class="n">source</span> <span class="o">==</span> <span class="s">&#39;sn1a&#39;</span><span class="p">:</span>
            <span class="n">yields_evol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">ism_iso_yield_1a</span>
            <span class="n">yields_evol_el</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">ism_elem_yield_1a</span>
        <span class="k">elif</span> <span class="n">source</span> <span class="o">==</span> <span class="s">&#39;massive&#39;</span><span class="p">:</span>
            <span class="n">yields_evol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">ism_iso_yield_massive</span>
            <span class="n">yields_evol_el</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">ism_elem_yield_massive</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&#39;!! Source not valid !!&#39;</span>
            <span class="k">return</span>

        <span class="c"># Verify the X-axis</span>
        <span class="n">xaxis_ratio</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="n">xaxis</span> <span class="o">==</span> <span class="s">&#39;age&#39;</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">age</span>
        <span class="k">elif</span> <span class="n">xaxis</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;[&#39;</span> <span class="ow">and</span> <span class="n">xaxis</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;]&#39;</span><span class="p">:</span>
            <span class="n">xaxis_elem1</span> <span class="o">=</span><span class="n">xaxis</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span>
            <span class="n">xaxis_elem2</span> <span class="o">=</span><span class="n">xaxis</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">xaxis_elem1</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">elements</span> <span class="ow">and</span> \
               <span class="ow">not</span> <span class="n">xaxis_elem2</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">elements</span><span class="p">:</span>
                 <span class="k">print</span> <span class="s">&#39;!! Elements in xaxis are not valid !!&#39;</span>
                 <span class="k">return</span>

            <span class="c">#X-axis ini values</span>
            <span class="n">x_elem1_ini</span><span class="o">=</span><span class="n">x_ini</span><span class="p">[</span><span class="n">elements</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">xaxis_elem1</span><span class="p">)]</span>
            <span class="n">x_elem2_ini</span><span class="o">=</span><span class="n">x_ini</span><span class="p">[</span><span class="n">elements</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">xaxis_elem2</span><span class="p">)]</span>

            <span class="c">#X-axis gce values</span>
            <span class="n">elem_idx1</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">elements</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">xaxis_elem1</span><span class="p">)</span>
            <span class="n">elem_idx2</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">elements</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">xaxis_elem2</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">yields_evol_el</span><span class="p">)):</span>
                <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="n">yields_evol_el</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="c">#in case no contribution during timestep</span>
                <span class="n">x1</span><span class="o">=</span><span class="n">yields_evol_el</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">elem_idx1</span><span class="p">]</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">yields_evol_el</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                <span class="n">x2</span><span class="o">=</span><span class="n">yields_evol_el</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">elem_idx2</span><span class="p">]</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">yields_evol_el</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                <span class="n">spec</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">x1</span><span class="o">/</span><span class="n">x2</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">x_elem1_ini</span><span class="o">/</span><span class="n">x_elem2_ini</span><span class="p">)</span>
                <span class="n">x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">xaxis_ratio</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="n">x_1</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
            <span class="n">x_2</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
            <span class="n">is_x_1</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">for</span> <span class="n">ix</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">xaxis</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">xaxis</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;/&#39;</span> <span class="ow">and</span> <span class="n">is_x_1</span><span class="p">:</span>
                    <span class="n">is_x_1</span> <span class="o">=</span> <span class="bp">False</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">is_x_1</span><span class="p">:</span>
                        <span class="n">x_1</span> <span class="o">+=</span> <span class="n">xaxis</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">x_2</span> <span class="o">+=</span> <span class="n">xaxis</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">print</span> <span class="s">&#39;!! xaxis not valid.  Need to be </span><span class="se">\&#39;</span><span class="s">age</span><span class="se">\&#39;</span><span class="s"> or a ratio !!&#39;</span>
                <span class="k">return</span>

        <span class="c"># Verify the Y-axis</span>
        <span class="n">y_1</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="n">y_2</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="n">is_y_1</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">for</span> <span class="n">iy</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">yaxis</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">yaxis</span><span class="p">[</span><span class="n">iy</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;/&#39;</span> <span class="ow">and</span> <span class="n">is_y_1</span><span class="p">:</span>
                <span class="n">is_y_1</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">is_y_1</span><span class="p">:</span>
                    <span class="n">y_1</span> <span class="o">+=</span> <span class="n">yaxis</span><span class="p">[</span><span class="n">iy</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">y_2</span> <span class="o">+=</span> <span class="n">yaxis</span><span class="p">[</span><span class="n">iy</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&#39;!! yaxis not valid.  Need to be a ratio !!&#39;</span>
            <span class="k">return</span>

        <span class="c"># Get the isotopes for X-axis</span>
        <span class="k">if</span> <span class="n">xaxis_ratio</span><span class="p">:</span>
          <span class="k">if</span> <span class="n">x_1</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">isotopes</span> <span class="ow">and</span> <span class="n">x_2</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">isotopes</span><span class="p">:</span>
            <span class="n">idx_1</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">isotopes</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">x_1</span><span class="p">)</span>
            <span class="n">idx_2</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">isotopes</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">x_2</span><span class="p">)</span>
            <span class="n">x1_elem</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">x_1</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;-&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">x2_elem</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">x_2</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;-&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">x1_at_nb</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">x_1</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;-&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">x2_at_nb</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">x_2</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;-&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
          <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&#39;!! Isotopes in xaxis are not valid !!&#39;</span>
            <span class="k">return</span>

        <span class="c"># Get the isotopes for Y-axis</span>
        <span class="k">if</span> <span class="n">y_1</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">isotopes</span> <span class="ow">and</span> <span class="n">y_2</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">isotopes</span><span class="p">:</span>
            <span class="n">idy_1</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">isotopes</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">y_1</span><span class="p">)</span>
            <span class="n">idy_2</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">isotopes</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">y_2</span><span class="p">)</span>
            <span class="n">y1_elem</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">y_1</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;-&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">y2_elem</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">y_2</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;-&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">y1_at_nb</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">y_1</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;-&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">y2_at_nb</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">y_2</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;-&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&#39;!! Isotopes in yaxis are not valid !!&#39;</span>
            <span class="k">return</span>

        <span class="c"># Set the default label .. if not defined</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">label</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">label</span><span class="o">=</span><span class="n">yaxis</span>
            <span class="k">if</span> <span class="n">source</span><span class="o">==</span><span class="s">&#39;agb&#39;</span><span class="p">:</span>
                <span class="n">label</span><span class="o">=</span><span class="n">yaxis</span><span class="o">+</span><span class="s">&#39;, AGB&#39;</span>
            <span class="k">elif</span> <span class="n">source</span><span class="o">==</span><span class="s">&#39;massive&#39;</span><span class="p">:</span>
                <span class="n">label</span><span class="o">=</span><span class="n">yaxis</span><span class="o">+</span><span class="s">&#39;, Massive&#39;</span>
            <span class="k">elif</span> <span class="n">source</span><span class="o">==</span><span class="s">&#39;sn1a&#39;</span><span class="p">:</span>
                <span class="n">label</span><span class="o">=</span><span class="n">yaxis</span><span class="o">+</span><span class="s">&#39;, SNIa&#39;</span>

        <span class="c"># Get the solar values</span>
        <span class="k">if</span> <span class="n">xaxis_ratio</span><span class="p">:</span>
            <span class="n">x1_sol</span><span class="p">,</span> <span class="n">x2_sol</span><span class="p">,</span> <span class="n">y1_sol</span><span class="p">,</span> <span class="n">y2_sol</span> <span class="o">=</span> \
              <span class="bp">self</span><span class="o">.</span><span class="n">__read_solar_iso</span><span class="p">(</span><span class="n">solar_iso</span><span class="p">,</span> <span class="n">x_1</span><span class="p">,</span> <span class="n">x_2</span><span class="p">,</span> <span class="n">y_1</span><span class="p">,</span> <span class="n">y_2</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">x1_sol</span><span class="p">,</span> <span class="n">x2_sol</span><span class="p">,</span> <span class="n">y1_sol</span><span class="p">,</span> <span class="n">y2_sol</span> <span class="o">=</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">__read_solar_iso</span><span class="p">(</span><span class="n">solar_iso</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">y_1</span><span class="p">,</span> <span class="n">y_2</span><span class="p">)</span>

        <span class="c"># Calculate the isotope ratios (delta notation)</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">yields_evol</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">xaxis_ratio</span><span class="p">:</span>
                <span class="n">ratio_sample</span> <span class="o">=</span> <span class="p">(</span><span class="n">yields_evol</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">idx_1</span><span class="p">]</span><span class="o">/</span><span class="n">yields_evol</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">idx_2</span><span class="p">])</span><span class="o">*</span>\
                               <span class="p">(</span><span class="n">x2_at_nb</span> <span class="o">/</span> <span class="n">x1_at_nb</span><span class="p">)</span>
                <span class="n">ratio_std</span> <span class="o">=</span> <span class="n">x1_sol</span> <span class="o">/</span> <span class="n">x2_sol</span>
                <span class="n">x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">((</span><span class="n">ratio_sample</span><span class="o">/</span><span class="n">ratio_std</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span>
            <span class="n">ratio_sample</span> <span class="o">=</span> <span class="p">(</span><span class="n">yields_evol</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">idy_1</span><span class="p">]</span><span class="o">/</span><span class="n">yields_evol</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">idy_2</span><span class="p">])</span><span class="o">*</span>\
                           <span class="p">(</span><span class="n">y2_at_nb</span> <span class="o">/</span> <span class="n">y1_at_nb</span><span class="p">)</span>
            <span class="n">ratio_std</span> <span class="o">=</span> <span class="n">y1_sol</span> <span class="o">/</span> <span class="n">y2_sol</span>
            <span class="n">y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">((</span><span class="n">ratio_sample</span><span class="o">/</span><span class="n">ratio_std</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span>
  
        <span class="c"># Make sure the length of array are the same when xaxis = &#39;[X/Y]&#39;</span>
        <span class="n">too_much</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">too_much</span><span class="p">:]</span>

        <span class="c">#Reserved for plotting</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">return_x_y</span><span class="p">:</span>
            <span class="n">shape</span><span class="p">,</span><span class="n">marker</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__msc</span><span class="p">(</span><span class="n">source</span><span class="p">,</span><span class="n">shape</span><span class="p">,</span><span class="n">marker</span><span class="p">,</span><span class="n">color</span><span class="p">)</span>

        <span class="c">#Reserved for plotting</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">return_x_y</span><span class="p">:</span>
           <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">fsize</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">fsize</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
               <span class="c">#if xaxis == &#39;age&#39;:</span>
               <span class="c">#plt.xscale(&#39;log&#39;)</span>
           <span class="c">#plt.yscale(&#39;log&#39;)</span>
           <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&quot;$\delta$($^{&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">y1_at_nb</span><span class="p">))</span><span class="o">+</span><span class="s">&quot;}$&quot;</span><span class="o">+</span><span class="n">y1_elem</span><span class="o">+</span><span class="s">&quot;/$^{&quot;</span><span class="o">+</span>\
                           <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">y2_at_nb</span><span class="p">))</span><span class="o">+</span><span class="s">&quot;}$&quot;</span><span class="o">+</span><span class="n">y2_elem</span><span class="o">+</span><span class="s">&quot;)&quot;</span><span class="p">)</span>
           <span class="k">if</span> <span class="n">xaxis</span> <span class="o">==</span> <span class="s">&#39;age&#39;</span><span class="p">:</span>
               <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;Age [yr]&#39;</span><span class="p">)</span>
           <span class="k">elif</span> <span class="n">xaxis_ratio</span><span class="p">:</span>
               <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&quot;$\delta$($^{&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">x1_at_nb</span><span class="p">))</span><span class="o">+</span><span class="s">&quot;}$&quot;</span><span class="o">+</span><span class="n">x1_elem</span><span class="o">+</span><span class="s">&quot;/$^{&quot;</span><span class="o">+</span>\
                           <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">x2_at_nb</span><span class="p">))</span><span class="o">+</span><span class="s">&quot;}$&quot;</span><span class="o">+</span><span class="n">x2_elem</span><span class="o">+</span><span class="s">&quot;)&quot;</span><span class="p">)</span>
           <span class="k">else</span><span class="p">:</span>
               <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">xaxis</span><span class="p">)</span>

        <span class="c">#If x and y need to be returned ...</span>
        <span class="k">if</span> <span class="n">return_x_y</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">,</span>\
                     <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span><span class="n">markevery</span><span class="o">=</span><span class="n">markevery</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
            <span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__fig_standard</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span><span class="n">labelsize</span><span class="o">=</span><span class="n">labelsize</span><span class="p">,</span>\
                  <span class="n">rspace</span><span class="o">=</span><span class="n">rspace</span><span class="p">,</span> <span class="n">bspace</span><span class="o">=</span><span class="n">bspace</span><span class="p">,</span><span class="n">legend_fontsize</span><span class="o">=</span><span class="n">legend_fontsize</span><span class="p">)</span>
	    <span class="c">#plt.xlim(self.history.dt,self.history.tend)	</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">save_data</span><span class="p">(</span><span class="n">header</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;Iso mass ratio&#39;</span><span class="p">,</span><span class="n">yaxis</span><span class="p">],</span><span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">])</span>


    <span class="c">##############################################</span>
    <span class="c">#               Read Solar Iso               #</span>
    <span class="c">##############################################</span></div>
    <span class="k">def</span> <span class="nf">__read_solar_iso</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">xx1</span><span class="p">,</span> <span class="n">xx2</span><span class="p">,</span> <span class="n">yy1</span><span class="p">,</span> <span class="n">yy2</span><span class="p">):</span>

        <span class="c"># Initialisation of the variable to be returned</span>
        <span class="n">x1_rsi</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">x2_rsi</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">y1_rsi</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">y2_rsi</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

        <span class="c"># Open the data file</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">global_path</span><span class="o">+</span><span class="n">file_path</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">data_file</span><span class="p">:</span>

            <span class="c"># For every line (for each isotope) ...</span>
            <span class="k">for</span> <span class="n">line_1_str</span> <span class="ow">in</span> <span class="n">data_file</span><span class="p">:</span>

                <span class="c"># Split the line</span>
                <span class="n">split</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">line_1_str</span><span class="o">.</span><span class="n">split</span><span class="p">()]</span>

                <span class="c"># Copy the number fraction of the isotopes (if found)</span>
                <span class="k">if</span> <span class="n">split</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">xx1</span><span class="p">:</span>
                    <span class="n">x1_rsi</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">split</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">split</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">xx2</span><span class="p">:</span>
                    <span class="n">x2_rsi</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">split</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">split</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">yy1</span><span class="p">:</span>
                    <span class="n">y1_rsi</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">split</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">split</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">yy2</span><span class="p">:</span>
                    <span class="n">y2_rsi</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">split</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="c"># Close the file</span>
        <span class="n">data_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="c"># Return the number fractions</span>
        <span class="k">return</span> <span class="n">x1_rsi</span><span class="p">,</span> <span class="n">x2_rsi</span><span class="p">,</span> <span class="n">y1_rsi</span><span class="p">,</span> <span class="n">y2_rsi</span>


    <span class="c">##############################################</span>
    <span class="c">#                  Plot MDF                  #</span>
    <span class="c">##############################################</span>
<div class="viewcode-block" id="omega.plot_mdf"><a class="viewcode-back" href="../omega.html#omega.omega.plot_mdf">[docs]</a>    <span class="k">def</span> <span class="nf">plot_mdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fig</span><span class="o">=</span><span class="mi">19</span><span class="p">,</span> <span class="n">return_x_y</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">axis_mdf</span> <span class="o">=</span> <span class="s">&#39;[Fe/H]&#39;</span><span class="p">,</span>\
        <span class="n">dx</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">,</span> <span class="n">solar_ab</span><span class="o">=</span><span class="s">&#39;yield_tables/iniabu/iniab2.0E-02GN93.ppn&#39;</span><span class="p">,</span>\
        <span class="n">sigma_gauss</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">nb_sigma</span> <span class="o">=</span> <span class="mf">3.0</span><span class="p">,</span>\
        <span class="n">marker</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="n">shape</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span>\
        <span class="n">color</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="n">fsize</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mf">4.5</span><span class="p">],</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span><span class="n">rspace</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span>\
        <span class="n">bspace</span><span class="o">=</span><span class="mf">0.15</span><span class="p">,</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span><span class="n">legend_fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">	This function plots the stellar metallicity distribution function (MDF),</span>
<span class="sd">	or the distribution function of any other abundance ratio.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">	return_x_y : boolean</span>
<span class="sd">	     If False, show the plot.  If True, return two arrays containing</span>
<span class="sd">	     the X and Y axis data, respectively.</span>
<span class="sd">	axis_mdf : string</span>
<span class="sd">	     Abundance ratio for the distribution such as &#39;[Fe/H]&#39; or &#39;[Mg/H]&#39;.</span>
<span class="sd">	dx : float</span>
<span class="sd">	     Bin resolution of the distribution.</span>
<span class="sd">	solar_ab : string</span>
<span class="sd">	     Path to the solar abundances used to normalize abundance ratios.</span>
<span class="sd">	sigma_gauss : float</span>
<span class="sd">	     Each point in the MDF can be associated with a gaussian. This implies</span>
<span class="sd">	     that in reality, the metallicity should have a certain dispersion </span>
<span class="sd">	     when stars form at each timestep (instead of using only a single</span>
<span class="sd">	     average value).  The sigma_guass parameter sets the sigma value eac</span>
<span class="sd">	     gaussian function.</span>
<span class="sd">	nb_sigma : float</span>
<span class="sd">	     When sigma_gauss is greater than zero, nb_sigma is the number of</span>
<span class="sd">	     sigma by which the X axis range is expanded.</span>
<span class="sd">        fig : string, float</span>
<span class="sd">	     Figure name.</span>
<span class="sd">	marker : string</span>
<span class="sd">	     Figure marker.</span>
<span class="sd">	shape : string</span>
<span class="sd">	     Line style.</span>
<span class="sd">	color : string</span>
<span class="sd">	     Line color.</span>
<span class="sd">	label : string</span>
<span class="sd">	     Figure label.</span>
<span class="sd">	fsize : 2D float array</span>
<span class="sd">	     Figure dimension/size.</span>
<span class="sd">	fontsize : integer</span>
<span class="sd">	     Font size of the numbers on the X and Y axis.</span>
<span class="sd">	rspace : float</span>
<span class="sd">	     Extra space on the right for the legend.</span>
<span class="sd">	bspace : float</span>
<span class="sd">	     Extra space at the bottom for the Y axis label.</span>
<span class="sd">	labelsize : integer</span>
<span class="sd">	     Font size of the X and Y axis labels.</span>
<span class="sd">	legend_fontsize : integer</span>
<span class="sd"> 	       Font size of the legend.</span>

<span class="sd">        Examples</span>
<span class="sd">	----------</span>

<span class="sd">	&gt;&gt;&gt; o1.plot_mdf(axis_mdf=&#39;[Fe/H]&#39;, sigma_gauss=0.2)</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c"># Define variable only used for plot visual</span>
        <span class="n">source</span><span class="o">=</span><span class="s">&#39;all&#39;</span>
        <span class="n">markevery</span> <span class="o">=</span> <span class="mi">10000</span>

        <span class="c"># Get the [X/Y] values</span>
        <span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">,</span> <span class="n">x_all</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_XY</span><span class="p">(</span><span class="n">axis_mdf</span><span class="p">,</span> <span class="n">solar_ab</span><span class="p">)</span>

        <span class="c"># Construct the x axis for the MDF (lower boundary of the bin)</span>
        <span class="n">mdf_x</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">mdf_y</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">x_i</span> <span class="o">=</span> <span class="n">x_min</span>
        <span class="k">while</span> <span class="n">x_i</span> <span class="o">&lt;=</span> <span class="n">x_max</span><span class="p">:</span>
            <span class="n">mdf_x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x_i</span><span class="p">)</span>
            <span class="n">mdf_y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
            <span class="n">x_i</span> <span class="o">+=</span> <span class="n">dx</span>
        <span class="n">mdf_x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x_i</span><span class="p">)</span>
        <span class="n">mdf_y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>

        <span class="c"># For each step in the simulation ...</span>
        <span class="c"># len(x_all)-1 because we move by [low,up] using i_sim and i_sim+1</span>
        <span class="k">for</span> <span class="n">i_sim</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_all</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>

          <span class="c"># Check if the values are ok</span>
          <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">x_all</span><span class="p">[</span><span class="n">i_sim</span><span class="p">])</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">x_all</span><span class="p">[</span><span class="n">i_sim</span><span class="o">+</span><span class="mi">1</span><span class="p">]):</span>

            <span class="c"># Calculate delta X / Mlocked</span>
            <span class="n">f_mlocked</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">m_locked</span><span class="p">[</span><span class="n">i_sim</span><span class="p">]</span> <span class="o">/</span> \
              <span class="p">(</span><span class="n">x_all</span><span class="p">[</span><span class="n">i_sim</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">x_all</span><span class="p">[</span><span class="n">i_sim</span><span class="p">])</span>

            <span class="c"># For each MDF x bin ...</span>
            <span class="c"># len(mdf_x)-1 because mdf_x[-1] = last upper lim</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">mdf_x</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>

              <span class="c"># If there is an overlap, add the corresponding mass in the bin</span>
              <span class="c"># Bin is overlaping the lower-boundary of the simulation</span>
              <span class="k">if</span> <span class="n">mdf_x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">x_all</span><span class="p">[</span><span class="n">i_sim</span><span class="p">]</span> <span class="ow">and</span> \
                 <span class="n">x_all</span><span class="p">[</span><span class="n">i_sim</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">mdf_x</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> \
                 <span class="n">mdf_x</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">x_all</span><span class="p">[</span><span class="n">i_sim</span><span class="o">+</span><span class="mi">1</span><span class="p">]:</span>
                  <span class="n">mdf_y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="p">(</span><span class="n">mdf_x</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">x_all</span><span class="p">[</span><span class="n">i_sim</span><span class="p">])</span> <span class="o">*</span> <span class="n">f_mlocked</span>

              <span class="c"># Bin is totaly within the boundarie of the simulation </span>
              <span class="k">elif</span> <span class="n">x_all</span><span class="p">[</span><span class="n">i_sim</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">mdf_x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">and</span> \
                <span class="n">mdf_x</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">x_all</span><span class="p">[</span><span class="n">i_sim</span><span class="o">+</span><span class="mi">1</span><span class="p">]:</span>
                  <span class="n">mdf_y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="p">(</span><span class="n">mdf_x</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">mdf_x</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="n">f_mlocked</span> 

              <span class="c"># Bin is overlaping the uper-boundary of the simulation</span>
              <span class="k">elif</span> <span class="n">x_all</span><span class="p">[</span><span class="n">i_sim</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">mdf_x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">and</span> \
                <span class="n">mdf_x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">x_all</span><span class="p">[</span><span class="n">i_sim</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> \
                <span class="n">x_all</span><span class="p">[</span><span class="n">i_sim</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">mdf_x</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]:</span>
                  <span class="n">mdf_y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="p">(</span><span class="n">x_all</span><span class="p">[</span><span class="n">i_sim</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">mdf_x</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="n">f_mlocked</span>

              <span class="c"># Bin is totaly overlaping the simulation</span>
              <span class="k">elif</span> <span class="n">mdf_x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">x_all</span><span class="p">[</span><span class="n">i_sim</span><span class="p">]</span> <span class="ow">and</span> \
                <span class="n">x_all</span><span class="p">[</span><span class="n">i_sim</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">mdf_x</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]:</span>
                  <span class="n">mdf_y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="p">(</span><span class="n">x_all</span><span class="p">[</span><span class="n">i_sim</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">x_all</span><span class="p">[</span><span class="n">i_sim</span><span class="p">])</span> <span class="o">*</span> <span class="n">f_mlocked</span>

        <span class="c"># Correct the x axis to use the middle value of each bin</span>
        <span class="n">x_cor</span> <span class="o">=</span> <span class="n">dx</span><span class="o">/</span><span class="mf">2.0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">mdf_x</span><span class="p">)):</span>
            <span class="n">mdf_x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">x_cor</span>

        <span class="c"># Normalisation to 1.0 (max value)</span>
        <span class="n">cte</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="nb">max</span><span class="p">(</span><span class="n">mdf_y</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">mdf_y</span><span class="p">)):</span>
            <span class="n">mdf_y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">mdf_y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">cte</span>

        <span class="c"># If the gaussian approximation is wanted ...</span>
        <span class="k">if</span> <span class="n">sigma_gauss</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">mdf_x</span><span class="p">,</span> <span class="n">mdf_y</span> <span class="o">=</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">__gauss_approx</span><span class="p">(</span><span class="n">mdf_x</span><span class="p">,</span> <span class="n">mdf_y</span><span class="p">,</span> <span class="n">sigma_gauss</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">nb_sigma</span><span class="p">)</span>

        <span class="c"># Reserved for plotting</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">return_x_y</span><span class="p">:</span>
            <span class="n">shape</span><span class="p">,</span><span class="n">marker</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__msc</span><span class="p">(</span><span class="n">source</span><span class="p">,</span><span class="n">shape</span><span class="p">,</span><span class="n">marker</span><span class="p">,</span><span class="n">color</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">fsize</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">fsize</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">axis_mdf</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;$N_\star$&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">mdf_x</span><span class="p">,</span><span class="n">mdf_y</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">,</span>\
                     <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span><span class="n">markevery</span><span class="o">=</span><span class="n">markevery</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
            <span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__fig_standard</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span><span class="n">labelsize</span><span class="o">=</span><span class="n">labelsize</span><span class="p">,</span>\
                  <span class="n">rspace</span><span class="o">=</span><span class="n">rspace</span><span class="p">,</span> <span class="n">bspace</span><span class="o">=</span><span class="n">bspace</span><span class="p">,</span><span class="n">legend_fontsize</span><span class="o">=</span><span class="n">legend_fontsize</span><span class="p">)</span>

        <span class="c"># If the MDF should be returned ...</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="k">return</span> <span class="n">mdf_x</span><span class="p">,</span> <span class="n">mdf_y</span>


    <span class="c">##############################################</span>
    <span class="c">#                 Get [X/Y]                  #</span>
    <span class="c">##############################################</span></div>
    <span class="k">def</span> <span class="nf">__get_XY</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis_mdf</span> <span class="o">=</span> <span class="s">&#39;[Fe/H]&#39;</span><span class="p">,</span> \
             <span class="n">solar_ab</span><span class="o">=</span><span class="s">&#39;yield_tables/iniabu/iniab2.0E-02GN93.ppn&#39;</span><span class="p">):</span>

        <span class="c"># Access solar abundance</span>
        <span class="n">iniabu</span> <span class="o">=</span> <span class="n">ry</span><span class="o">.</span><span class="n">iniabu</span><span class="p">(</span><span class="n">global_path</span><span class="o">+</span><span class="n">solar_ab</span><span class="p">)</span>
        <span class="n">x_ini_iso</span> <span class="o">=</span> <span class="n">iniabu</span><span class="o">.</span><span class="n">iso_abundance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">isotopes</span><span class="p">)</span>

        <span class="c"># Access </span>
        <span class="n">elements</span><span class="p">,</span> <span class="n">x_ini</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iso_abu_to_elem</span><span class="p">(</span><span class="n">x_ini_iso</span><span class="p">)</span>
        <span class="n">yields_evol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">ism_elem_yield</span>

        <span class="c"># Isolate the X and Y in [X/Y]</span>
        <span class="n">xaxis_elem1</span> <span class="o">=</span> <span class="n">axis_mdf</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span>
        <span class="n">xaxis_elem2</span> <span class="o">=</span> <span class="n">axis_mdf</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="c"># Get the solar values</span>
        <span class="n">x_elem1_ini</span> <span class="o">=</span> <span class="n">x_ini</span><span class="p">[</span><span class="n">elements</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">xaxis_elem1</span><span class="p">)]</span>
        <span class="n">x_elem2_ini</span> <span class="o">=</span> <span class="n">x_ini</span><span class="p">[</span><span class="n">elements</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">xaxis_elem2</span><span class="p">)]</span>

        <span class="c"># Get the simulation values</span>
        <span class="n">elem_idx1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">elements</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">xaxis_elem1</span><span class="p">)</span>
        <span class="n">elem_idx2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">elements</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">xaxis_elem2</span><span class="p">)</span>

        <span class="n">x</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">x_no_inf</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c"># Calculate [X/Y] at each timestep</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">yields_evol</span><span class="p">)):</span>
            <span class="n">x1</span> <span class="o">=</span> <span class="n">yields_evol</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">elem_idx1</span><span class="p">]</span> <span class="o">/</span> <span class="nb">sum</span><span class="p">(</span><span class="n">yields_evol</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
            <span class="n">x2</span> <span class="o">=</span> <span class="n">yields_evol</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">elem_idx2</span><span class="p">]</span> <span class="o">/</span> <span class="nb">sum</span><span class="p">(</span><span class="n">yields_evol</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
            <span class="n">spec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">x1</span><span class="o">/</span><span class="n">x2</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">x_elem1_ini</span><span class="o">/</span><span class="n">x_elem2_ini</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">spec</span><span class="p">):</span>
                <span class="n">x_no_inf</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>
            <span class="n">x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>

        <span class="c"># Return [X/Y]_min, [X/Y]_max, and the [X/Y] array</span>
        <span class="n">x_no_inf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">x_no_inf</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">x_no_inf</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x_no_inf</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">x</span>


    <span class="c">##############################################</span>
    <span class="c">#               Gauss Approx.                #</span>
    <span class="c">##############################################</span>
    <span class="k">def</span> <span class="nf">__gauss_approx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mdf_x</span><span class="p">,</span> <span class="n">mdf_y</span><span class="p">,</span> <span class="n">sigma_gauss</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">nb_sigma</span><span class="p">):</span>

        <span class="c"># Declaration of the MDF after the gaussian approximation</span>
        <span class="n">mdf_y_ga</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c"># Number of bins</span>
        <span class="n">nb_bin_ga</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">mdf_x</span><span class="p">)</span>

        <span class="c"># Constant in the gaussian</span>
        <span class="n">cte_ga</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">sigma_gauss</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

        <span class="c"># For each bin on the x axis ...</span>
        <span class="k">for</span> <span class="n">i_ga</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nb_bin_ga</span><span class="p">):</span>

            <span class="c"># Add the contribution of all the other bins</span>
            <span class="n">mdf_y_ga</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">j_ga</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nb_bin_ga</span><span class="p">):</span>
                <span class="n">mdf_y_ga</span><span class="p">[</span><span class="n">i_ga</span><span class="p">]</span> <span class="o">+=</span> <span class="n">mdf_y</span><span class="p">[</span><span class="n">j_ga</span><span class="p">]</span> <span class="o">*</span> \
                    <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">cte_ga</span> <span class="o">*</span> <span class="p">(</span><span class="n">mdf_x</span><span class="p">[</span><span class="n">i_ga</span><span class="p">]</span><span class="o">-</span><span class="n">mdf_x</span><span class="p">[</span><span class="n">j_ga</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

        <span class="c"># Add a few sigma at higher Z ...</span>
        <span class="n">x_ga</span> <span class="o">=</span> <span class="n">mdf_x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">dx</span>
        <span class="n">x_ga_max</span> <span class="o">=</span> <span class="n">x_ga</span> <span class="o">+</span> <span class="n">nb_sigma</span> <span class="o">*</span> <span class="n">sigma_gauss</span>
        <span class="n">i_ga</span> <span class="o">=</span> <span class="n">nb_bin_ga</span>
        <span class="k">while</span> <span class="n">x_ga</span> <span class="o">&lt;</span> <span class="n">x_ga_max</span><span class="p">:</span>
            <span class="n">mdf_x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x_ga</span><span class="p">)</span>
            <span class="n">mdf_y_ga</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">j_ga</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nb_bin_ga</span><span class="p">):</span>
                <span class="n">mdf_y_ga</span><span class="p">[</span><span class="n">i_ga</span><span class="p">]</span> <span class="o">+=</span> <span class="n">mdf_y</span><span class="p">[</span><span class="n">j_ga</span><span class="p">]</span> <span class="o">*</span> \
                    <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">cte_ga</span> <span class="o">*</span> <span class="p">(</span><span class="n">mdf_x</span><span class="p">[</span><span class="n">i_ga</span><span class="p">]</span><span class="o">-</span><span class="n">mdf_x</span><span class="p">[</span><span class="n">j_ga</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">i_ga</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">x_ga</span> <span class="o">+=</span> <span class="n">dx</span>

        <span class="c"># Renormalization to one (max value)</span>
        <span class="n">cte</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="nb">max</span><span class="p">(</span><span class="n">mdf_y_ga</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">mdf_y_ga</span><span class="p">)):</span>
            <span class="n">mdf_y_ga</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">mdf_y_ga</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">cte</span>       

        <span class="k">return</span> <span class="n">mdf_x</span><span class="p">,</span> <span class="n">mdf_y_ga</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">SYGMA DOC v1.0 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2014, Christian Ritter.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.1.
    </div>
  </body>
</html>